{"version":3,"sources":["src/Typescript/Math.ts","src/Typescript/DataView.ts","src/Typescript/DataStream.ts","src/Typescript/webgl.ts","src/Typescript/Sound.ts","src/Typescript/Pig.ts","src/Typescript/Ham.ts","src/Typescript/PowerupTypes.ts","src/Typescript/Player.ts","src/Typescript/Controls.ts","src/Typescript/Item.ts","src/Typescript/BinaryHeap.ts","src/Typescript/Level.ts","src/Typescript/Visibility_worker.ts"],"names":[],"mappings":"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","file":"Visibility_worker.js","sourcesContent":["\"use strict\";\n\ninterface Array<T> {\n\tcheckIndex(i: number): void;\n\tmapConcat(callback: any, thisArg: any): any[];\n\tremoveAt(i: number): T;\n\tswapOut(i: number): T;\n}\ninterface Math {\n\tround(value: number, digits: number): number;\n\tmod(a: number, b: number): number;\n}\n((Math: any, Array: any) => {\n\tconst _round = Math.round;\n\tconst _rgPowers = new Float32Array(10);\n\n\tMath.round = (value: number, digits?: number) => {\n\t\tif (digits == null) {\n\t\t\treturn _round(value);\n\t\t}\n\n\t\tif (digits >= 0 || digits < 10) {\n\t\t\tlet scale = _rgPowers[digits];\n\t\t\tif (!scale) {\n\t\t\t\tscale = _rgPowers[digits] = Math.pow(10, digits);\n\t\t\t}\n\t\t\treturn _round(value * scale) / scale;\n\t\t} else {\n\t\t\tthrow new Error(\"invalid precision: \" + digits);\n\t\t}\n\t};\n\tMath.mod = (a: number, b: number) => {\n\t\treturn a - b * Math.floor(a / b);\n\t};\n})(Math, Array);\n\nfunction assert(f: boolean) {\n\tif (!f) {\n\t\tthrow new Error(\"assertion failed\");\n\t}\n}\n\nfunction notNull<T>(f: T | null | undefined): T {\n\tif (f == null) {\n\t\tthrow new Error(\"unexpected null|undefined\");\n\t}\n\treturn f;\n}\n\nArray.prototype.mapConcat = function(callback: any, thisArg: any): any[] {\n\tconst rg: any[] = [];\n\tconst push = Array.prototype.push;\n\tfor (let i = 0; i < this.length; ++i) {\n\t\tpush.apply(rg, callback.call(thisArg, this[i], i, this));\n\t}\n\treturn rg;\n};\nArray.prototype.checkIndex = function(i: number) {\n\tif (i < 0 || i >= this.length) {\n\t\tthrow new Error(\"index out of range: \" + i);\n\t}\n};\nArray.prototype.removeAt = function(i: number) {\n\tthis.checkIndex(i);\n\tconst old = this[i];\n\tthis.splice(i, 1);\n\treturn old;\n};\nArray.prototype.swapOut = function(i: number): any {\n\tthis.checkIndex(i);\n\tconst old = this[i];\n\tconst other: any = this.pop();\n\tif (this.length && old !== other) {\n\t\tthis[i] = other;\n\t}\n\treturn old;\n};\nfunction Array_iterate(count: number, callback: (i: number) => any) {\n\tconst rg: any[] = [];\n\tfor (let i = 0; i < count; ++i) {\n\t\tconst value = callback(i);\n\t\tif (typeof value !== \"undefined\") {\n\t\t\trg.push(value);\n\t\t}\n\t}\n\treturn rg;\n}\nlet __unique = 1;\n\nfunction fix(v: number) { return v / 65536; }\nfunction fix2(v: number) { return v / 256; }\n\nclass Vec2 {\n\tstatic Zero = new Vec2(0, 0);\n\tstatic One = new Vec2(1, 1);\n\tstatic X = new Vec2(1, 0);\n\tstatic Y = new Vec2(0, 1);\n\n\tprivate _flattened: number[];\n\n\tconstructor(public x: number, public y: number) {\n\t\tif (isNaN(x) || isNaN(y)) {\n\t\t\tthrow new Error(\"invalid value\");\n\t\t}\n\t}\n\tadd(v: Vec2) {\n\t\treturn new Vec2(this.x + v.x, this.y + v.y);\n\t}\n\taddScale(v: Vec2, scale: number) {\n\t\treturn new Vec2(this.x + v.x * scale, this.y + v.y * scale);\n\t}\n\tsub(v: Vec2) {\n\t\treturn new Vec2(this.x - v.x, this.y - v.y);\n\t}\n\tscale(s: number) {\n\t\tif (s === 0) {\n\t\t\treturn Vec2.Zero;\n\t\t}\n\t\tif (s === 1) {\n\t\t\treturn this;\n\t\t}\n\t\treturn new Vec2(this.x * s, this.y * s);\n\t}\n\tunit() {\n\t\tconst len = this.len2();\n\t\tif (len === 1) {\n\t\t\treturn this;\n\t\t}\n\t\treturn this.scale(1 / Math.sqrt(len));\n\t}\n\tlen2() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n\tlen() {\n\t\treturn Math.sqrt(this.len2());\n\t}\n\tdot(v: Vec2) {\n\t\treturn this.x * v.x + this.y * v.y;\n\t}\n\tprojectOnTo(n: Vec2) {\n\t\treturn n.scale(n.dot(this) / n.len());\n\t}\n\tpushTo(array: number[]) {\n\t\tarray.push(this.x, this.y);\n\t}\n\n\tflatten() {\n\t\tlet flattened = this._flattened;\n\t\tif (!flattened) {\n\t\t\tflattened = this._flattened = [this.x, this.y];\n\t\t}\n\t\treturn flattened;\n\t}\n\ttoString() {\n\t\treturn \"(\" + Math.round(this.x, 3) + \", \" + Math.round(this.y, 3) + \")\";\n\t}\n}\nclass Vec3 {\n\tstatic Zero = new Vec3(0, 0, 0);\n\tstatic One = new Vec3(1, 1, 1);\n\tstatic X = new Vec3(1, 0, 0);\n\tstatic Y = new Vec3(0, 1, 0);\n\tstatic Z = new Vec3(0, 0, 1);\n\n\tprivate _len: number;\n\tprivate _flattened: number[];\n\n\tconstructor(public x: number, public y: number, public z: number) {\n\t\tif (isNaN(x) || isNaN(y) || isNaN(z)) {\n\t\t\tthrow new Error(\"invalid value\");\n\t\t}\n\t}\n\tadd(v: Vec3) {\n\t\treturn new Vec3(this.x + v.x, this.y + v.y, this.z + v.z);\n\t}\n\taddScale(v: Vec3, scale: number) {\n\t\treturn new Vec3(this.x + v.x * scale, this.y + v.y * scale, this.z + v.z * scale);\n\t}\n\tsub(v: Vec3) {\n\t\treturn new Vec3(this.x - v.x, this.y - v.y, this.z - v.z);\n\t}\n\tscale(s: number) {\n\t\tif (s === 0) {\n\t\t\treturn Vec3.Zero;\n\t\t}\n\t\tif (s === 1) {\n\t\t\treturn this;\n\t\t}\n\t\treturn new Vec3(this.x * s, this.y * s, this.z * s);\n\t}\n\tunit() {\n\t\tconst len = this.len2();\n\t\tif (len === 1) {\n\t\t\treturn this;\n\t\t}\n\t\treturn this.scale(1 / Math.sqrt(len));\n\t}\n\tlen2() {\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\n\t}\n\tlen() {\n\t\tlet len = this._len;\n\t\tif (!len) {\n\t\t\tlen = this._len = Math.sqrt(this.len2());\n\t\t}\n\t\treturn len;\n\t}\n\tdot(v: Vec3) {\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\n\t}\n\tneg() {\n\t\treturn new Vec3(-this.x, -this.y, -this.z);\n\t}\n\tcross(v: Vec3) {\n\t\treturn new Vec3(\n\t\t\tthis.y * v.z - v.y * this.z,\n\t\t\tthis.z * v.x - v.z * this.x,\n\t\t\tthis.x * v.y - v.x * this.y,\n\t\t);\n\t}\n\tprojectOnTo(n: Vec3) {\n\t\treturn n.scale(n.dot(this) / n.len());\n\t}\n\tprojectOnToPlane(normal: Vec3) {\n\t\treturn this.sub(this.projectOnTo(normal));\n\t}\n\tplaneNormal(p1: Vec3, p2: Vec3) {\n\t\tconst v1 = p1.sub(this);\n\t\tconst v2 = p2.sub(this);\n\t\treturn v1.cross(v2).unit();\n\t}\n\tdistanceTo(p: Vec3) {\n\t\treturn Math.sqrt(this.distanceTo2(p));\n\t}\n\tdistanceTo2(p: Vec3) {\n\t\tconst dx = this.x - p.x;\n\t\tconst dy = this.y - p.y;\n\t\tconst dz = this.z - p.z;\n\t\treturn dx * dx + dy * dy + dz * dz;\n\t}\n\tdistanceToPlane(p: Vec3, n: Vec3) {\n\t\treturn this.sub(p).dot(n);\n\t}\n\tpushTo(array: number[]) {\n\t\tarray.push(this.x, this.y, this.z);\n\t}\n\tflatten() {\n\t\tlet flattened = this._flattened;\n\t\tif (!flattened) {\n\t\t\tflattened = this._flattened = [this.x, this.y, this.z];\n\t\t}\n\t\treturn flattened;\n\t}\n\t/*\n\ttoV3()\n\t{\n\t\treturn $V([this.x, this.y, this.z]);\n\t}\n\ttoV4()\n\t{\n\t\treturn $V([this.x, this.y, this.z, 1]);\n\t}\n\t*/\n\n\ttoString() {\n\t\treturn \"(\" + Math.round(this.x, 3) + \", \" + Math.round(this.y, 3) + \", \" + Math.round(this.z, 3) + \")\";\n\t}\n}\nclass Line3 {\n\tconstructor(public start: Vec3, public direction: Vec3) {\n\t}\n\tdistanceToPlane(plane: Plane3) {\n\t\tconst dotprod = this.direction.dot(plane.normal.unit());\n\t\tif (dotprod <= 0) {\n\t\t\treturn null;\n\t\t}\t// wrong direction\n\n\t\treturn plane.anchor.sub(this.start).dot(plane.normal) / dotprod;\n\t}\n\tintersectPlane(plane: Plane3) {\n\t\tconst distance = this.distanceToPlane(plane);\n\t\tif (!distance) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.proceed(distance);\n\t}\n\tinteresctTriangle(tri: Triangle) {\n\t\tconst pt = this.intersectPlane(tri);\n\t\tif (pt && tri.containsPoint(pt)) {\n\t\t\treturn pt;\n\t\t}\n\t\treturn null;\n\t}\n\tproceed(distance: number): Vec3 {\n\t\treturn this.start.addScale(this.direction, distance / this.direction.len());\n\t}\n\n}\nclass LineSegment extends Line3 {\n\tlength: number;\n\tend: Vec3;\n\n\tprivate _flattened: number[];\n\n\tconstructor(start: Vec3, end: Vec3) {\n\t\tconst direction = end.sub(start);\n\t\tconst length = direction.len();\n\t\tsuper(start, direction.scale(1 / length));\n\n\t\tthis.length = length;\n\t\tthis.end = end;\n\t}\n\tcenter() {\n\t\treturn this.proceed(this.length / 2);\n\t}\n\tdistanceToSphere(center: Vec3, radius: number): number {\n\t\tconst c = center.sub(this.start);\n\t\tconst l = this.direction;\n\n\t\tconst A = l.dot(c);\n\t\tconst B = l.dot(l);\n\t\tconst Q = A * A - B * (c.dot(c) - radius * radius);\n\n\t\tif (Q <= 0.0) {\n\t\t\treturn NaN;\n\t\t}\n\n\t\tconst d = (A - Math.sqrt(Q)) / B;\n\t\tif (d <= 0.0) {\n\t\t\treturn NaN;\n\t\t}\n\t\treturn d;\n\t\t/*\n\n\t\tconst d = this.direction;\n\n\t\tconst a = d.dot(d);\n\t\tconst b = 2.0 * d.dot(this.start.sub(center));\n\t\tconst c = center.dot(center) + this.start.dot(this.start) - 2.0 * center.dot(this.start) - radius * radius;\n\n\t\tconst test = b * b - 4.0 * a * c;\n\t\tif (test <= 0.0)\n\t\t\treturn;\n\n\t\t// Hit\n\t\tconst u = (-b - Math.sqrt(test)) / (2.0 * a);\n\t\treturn u / d.len();\n\t\t*/\n\t}\n\n\tflatten() {\n\t\tlet flattened = this._flattened;\n\t\tif (!flattened) {\n\t\t\tflattened = this._flattened = [this.start.x, this.start.y, this.start.z, this.end.x, this.end.y, this.end.z];\n\t\t}\n\t\treturn flattened;\n\t}\n\tintersectPlane(plane: Plane3) {\n\t\tconst distance = this.distanceToPlane(plane);\n\t\tif (!distance) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (distance > this.length) {\n\t\t\treturn null;\n\t\t}\t// too far away\n\n\t\treturn this.proceed(distance);\n\t}\n}\nclass Plane3 {\n\tstatic fromPoints(v0: Vec3, v1: Vec3, v2: Vec3) {\n\t\tconst u = v1.sub(v0);\n\t\tconst v = v2.sub(v0);\n\t\tconst normal = u.cross(v);\n\t\treturn new Plane3(v0, normal);\n\t}\n\n\tconstructor(public anchor: Vec3, public normal: Vec3) {\n\t}\n\tdistanceTo(pt: Vec3) {\n\t\tconst n = this.normal;\n\t\tconst a = this.anchor;\n\n\t\treturn n.x * (pt.x - a.x) + n.y * (pt.y - a.y) + n.z * (pt.z - a.z);\n\t}\n\treverse() {\n\t\treturn new Plane3(this.anchor, this.normal.scale(-1));\n\t}\n\tpointClosestTo(vec: Vec3) {\n\t\treturn vec.addScale(this.normal, -vec.dot(this.normal));\n\t}\n\treflectVector(vec: Vec3) {\n\t\treturn vec.addScale(this.normal, -2 * vec.dot(this.normal));\n\t}\n\treflectPoint(pt: Vec3) {\n\t\treturn this.anchor.add(this.reflectVector(pt.sub(this.anchor)));\n\t}\n\ttoString() {\n\t\treturn this.anchor.toString() + \"/\" + this.normal.toString();\n\t}\n\ttoReflectionMatrix() {\n\t\tconst x = this.normal.x;\n\t\tconst y = this.normal.y;\n\t\tconst z = this.normal.z;\n\n\t\treturn new Mat3(\n\t\t\tnew Vec3(1 - 2 * x * x, -2 * x * y, -2 * x * z),\n\t\t\tnew Vec3(-2 * x * y, 1 - 2 * y * y, -2 * y * z),\n\t\t\tnew Vec3(-2 * z * x, -2 * z * y, 1 - 2 * z * z),\n\t\t);\n\t}\n}\nclass Bounce extends Plane3 {\n\tiTri: number;\n\ttri: Triangle;\n\tperpendicularDistance: number;\n\tdistance: number;\n\tcube: Cube;\n\tside: Side;\n\n\tgetTextureCoords(): Vec2 {\n\t\tconst side = this.side;\n\t\tconst rgUV = side.rgUV;\n\n\t\tconst uv0 = rgUV[0];\n\t\tlet uv1: Vec2;\n\t\tlet uv2: Vec2;\n\t\tif (this.iTri === 0) {\n\t\t\tuv1 = rgUV[1].sub(uv0);\n\t\t\tuv2 = rgUV[2].sub(uv0);\n\t\t} else {\n\t\t\tuv1 = rgUV[2].sub(uv0);\n\t\t\tuv2 = rgUV[3].sub(uv0);\n\t\t}\n\n\t\tconst uv = this.tri.getParametricCoords(this.anchor);\n\t\tconst v = uv0.addScale(uv1, uv.x).addScale(uv2, uv.y);\n\t\treturn v;\n\t}\n}\nclass Triangle extends Plane3 {\n\trgPoints: Vec3[];\n\tu: Vec3;\n\tv: Vec3;\n\tuu: number;\n\tuv: number;\n\tvv: number;\n\tD: number;\n\n\tcenter: Vec3;\n\n\tconstructor(v0: Vec3, v1: Vec3, v2: Vec3) {\n\t\tconst u = v1.sub(v0);\n\t\tconst v = v2.sub(v0);\n\t\tconst normal = u.cross(v).unit();\n\n\t\tsuper(v0, normal);\n\t\tthis.rgPoints = [v0, v1, v2];\n\n\t\tthis.u = u;\n\t\tthis.v = v;\n\n\t\tthis.uu = u.dot(u);\n\t\tthis.uv = u.dot(v);\n\t\tthis.vv = v.dot(v);\n\t\tthis.D = this.uv * this.uv - this.uu * this.vv;\n\n\t}\n\tcontainsPoint(pt: Vec3) {\n\t\tconst w = pt.sub(this.anchor);\n\t\tconst wu = w.dot(this.u);\n\t\tconst wv = w.dot(this.v);\n\n\t\t// get and test parametric coords\n\t\tconst s = (this.uv * wv - this.vv * wu) / this.D;\n\t\tif (s < 0.0 || s > 1.0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst t = (this.uv * wu - this.uu * wv) / this.D;\n\t\tif (t < 0.0 || (s + t) > 1.0) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\tgetParametricCoords(pt: Vec3) {\n\t\tconst w = pt.sub(this.anchor);\n\n\t\t// Compute dot products\n\t\tconst uw = this.u.dot(w);\n\t\tconst vw = this.v.dot(w);\n\n\t\t// Compute barycentric coordinates\n\t\tconst u = (this.uv * vw - this.vv * uw) / this.D;\n\t\tconst v = (this.uv * uw - this.uu * vw) / this.D;\n\n\t\treturn new Vec2(u, v);\n\t}\n\t/*\n\tgetProjectionMatrix()\n\t{\n\t\tconst mat = Matrix.create([\n\t\t\tthis.u.toV3(),\n\t\t\tthis.v.projectOnTo(this.u.cross(this.normal)).toV3(),\n\t\t\tthis.normal.scale(this.u.len()).toV3()\n\t\t]);\n\n\t\tmat = mat.ensure4x4();\n\n\t\tmat = mat.inverse();\n\t\tmat = mat.transpose();\n\n\t\tconst mt = Matrix.Translation(Vec3.Zero.sub(this.anchor).toV3());\n\t\tmat = mat.multiply(mt);\n\n\t\treturn mat;\n\t}\n\t*/\n\n\tgetCenter() {\n\t\tif (!this.center) {\n\t\t\tthis.center = this.rgPoints[0]\n\t\t\t\t.add(this.rgPoints[1])\n\t\t\t\t.add(this.rgPoints[2])\n\t\t\t\t.scale(1 / 3);\n\t\t}\n\t\treturn this.center;\n\t}\n\tbounce(line: LineSegment, size: number) {\n\t\tconst dotProduct = -this.normal.dot(line.direction);\n\t\tif (dotProduct <= 0) {\n\t\t\treturn;\n\t\t}\t// triangle faces the wrong direction\n\n\t\t// the perpendicular distance from the start of the line to the plane\n\t\tconst perpendicularDistanceToStart = this.distanceTo(line.start);\n\n\t\t// the distance from the start of the line to the point of collision\n\t\tconst perpendicularDistanceToCollision = perpendicularDistanceToStart - size;\n\n\t\t// the distance along the line from the start to the collision\n\t\tconst distanceToCollision = perpendicularDistanceToCollision / dotProduct;\n\t\tif (distanceToCollision > line.length) {\n\t\t\treturn;\n\t\t}\t// too far away\n\n\t\tconst contactPoint = line.proceed(distanceToCollision);\n\t\tif (!this.containsPoint(contactPoint)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst bounce = new Bounce(contactPoint, this.normal);\n\t\tbounce.tri = this;\n\t\tbounce.perpendicularDistance = perpendicularDistanceToCollision;\n\t\tbounce.distance = distanceToCollision;\n\t\treturn bounce;\n\n\t\t/*\n\t\tconst perpendicularDistance = this.distanceTo(line.end);\n\n\t\t// the distance perpendicular to the plane that we've overshot\n\t\tconst perpendicularPenetration = size - perpendicularDistance;\n\n\t\tif (perpendicularPenetration < 1e-13)\n\t\t\treturn;\t// too far away\n\n\t\t// the distance along the line that we've overshot\n\t\tconst penetration = -perpendicularPenetration / dotProduct;\n\n\t\t// the point at which contact occurred\n\t\tconst contactPoint = line.end.addScale(line.direction, -penetration);\n\t\tif (!this.containsPoint(contactPoint))\n\t\t\treturn;\n\n\t\tconst bounce = new Plane3(contactPoint, this.normal);\n\t\tbounce.tri = this;\n\t\tbounce.perpendicularDistance = perpendicularDistance;\n\t\tbounce.distance = line.length - penetration;\n\t\treturn bounce;\n\t\t*/\n\t}\n}\nclass Mat3 {\n\tstatic I = new Mat3(Vec3.X, Vec3.Y, Vec3.Z);\n\n\tstatic createRotation2d(angle: number) {\n\t\tconst c = Math.cos(angle);\n\t\tconst s = Math.sin(angle);\n\t\treturn new Mat3(\n\t\t\tnew Vec3(c, -s, 0),\n\t\t\tnew Vec3(s, c, 0),\n\t\t\tVec3.Z,\n\t\t);\n\t}\n\tstatic createTranslation2d(x: Vec2): Mat3;\n\tstatic createTranslation2d(x: number, y: number): Mat3;\n\tstatic createTranslation2d(x: any, y?: number): Mat3 {\n\t\tif (x instanceof Vec2) {\n\t\t\ty = x.y;\n\t\t\tx = x.x;\n\t\t}\n\n\t\treturn new Mat3(\n\t\t\tnew Vec3(1, 0, x),\n\t\t\tnew Vec3(0, 1, notNull(y)),\n\t\t\tVec3.Z,\n\t\t);\n\t}\n\tstatic fromEuler(p: Vec3): Mat3;\n\tstatic fromEuler(p: number, h: number, b: number): Mat3;\n\n\tstatic fromEuler(p: any, h?: any, b?: any): Mat3 {\n\t\tif (p instanceof Vec3) {\n\t\t\tb = p.z;\n\t\t\th = p.y;\n\t\t\tp = p.x;\n\t\t}\n\n\t\tconst\tsinp = Math.sin(p);\n\t\tconst\tcosp = Math.cos(p);\n\t\tconst\tsinb = Math.sin(b);\n\t\tconst\tcosb = Math.cos(b);\n\t\tconst\tsinh = Math.sin(h);\n\t\tconst\tcosh = Math.cos(h);\n\n\t\tconst sbsh = sinb * sinh;\n\t\tconst cbch = cosb * cosh;\n\t\tconst cbsh = cosb * sinh;\n\t\tconst sbch = sinb * cosh;\n\n\t\treturn new Mat3(\n\t\t\tnew Vec3(cbch + sinp * sbsh, sinb * cosp, sinp * sbch - cbsh),\n\t\t\tnew Vec3(sinp * cbsh - sbch, cosb * cosp, sbsh + sinp * cbch),\n\t\t\tnew Vec3(sinh * cosp, -sinp, cosh * cosp),\n\t\t);\n\t}\n\tstatic createLook = (forward: Vec3, up?: Vec3, right?: Vec3) => {\n\t\tlet x: Vec3, y: Vec3;\n\t\tconst z: Vec3 = forward.unit();\n\n\t\tif (up) {\n\t\t\ty = up.unit();\n\t\t\tx = y.cross(z);\n\t\t} else {\n\t\t\tif (right) {\n\t\t\t\tx = right.unit();\n\t\t\t} else {\n\t\t\t\tx = new Vec3(z.z, 0, -z.x).unit();\n\t\t\t}\n\t\t\ty = z.cross(x);\n\t\t}\n\t\treturn new Mat3(x, y, z);\n\t}\n\tstatic createRotation(angles: Vec3): Mat3 {\n\t\tconst sinp = Math.sin(angles.x);\n\t\tconst cosp = Math.cos(angles.x);\n\t\tconst sinb = Math.sin(angles.z);\n\t\tconst cosb = Math.cos(angles.z);\n\t\tconst sinh = Math.sin(angles.y);\n\t\tconst cosh = Math.cos(angles.y);\n\n\t\tconst sbsh = sinb * sinh;\n\t\tconst cbch = cosb * cosh;\n\t\tconst cbsh = cosb * sinh;\n\t\tconst sbch = sinb * cosh;\n\n\t\treturn new Mat3(\n\t\t\tnew Vec3(cbch + sinp * sbsh, sinb * cosp, sinp * sbch - cbsh),\n\t\t\tnew Vec3(sinp * cbsh - sbch, cosb * cosp, sbsh + sinp * cbch),\n\t\t\tnew Vec3(sinh * cosp, -sinp, cosh * cosp),\n\t\t);\n\n\t}\n\n\t_: Vec3[];\n\tprivate _flattened: number[];\n\n\tconstructor(rows: Vec3[]);\n\tconstructor(r0: Vec3, r1: Vec3, r2: Vec3);\n\tconstructor(r0: any, r1?: Vec3, r2?: Vec3) {\n\t\tif (r0 instanceof Array) {\n\t\t\tif (r0.length !== 3) {\n\t\t\t\tthrow new Error(\"wrong length: \" + r0.length);\n\t\t\t}\n\t\t\tif (typeof r1 !== \"undefined\" || typeof r2 !== \"undefined\") {\n\t\t\t\tthrow new Error(\"can't pass additional arguments here\");\n\t\t\t}\n\t\t\tthis._ = r0;\n\t\t} else {\n\t\t\tthis._ = [r0, r1, r2];\n\t\t}\n\n\t\t// Object.freeze(this);\n\t}\n\tadd(other: Mat3) {\n\t\treturn new Mat3(\n\t\t\tthis._[0].add(other._[0]),\n\t\t\tthis._[1].add(other._[1]),\n\t\t\tthis._[2].add(other._[2]),\n\t\t);\n\t}\n\tsub(other: Mat3) {\n\t\treturn new Mat3(\n\t\t\tthis._[0].sub(other._[0]),\n\t\t\tthis._[1].sub(other._[1]),\n\t\t\tthis._[2].sub(other._[2]),\n\t\t);\n\t}\n\tscale(value: number) {\n\t\treturn new Mat3(\n\t\t\tthis._[0].scale(value),\n\t\t\tthis._[1].scale(value),\n\t\t\tthis._[2].scale(value),\n\t\t);\n\t}\n\tmultiply(other: Vec3): Vec3;\n\tmultiply(other: Mat3): Mat3;\n\n\tmultiply(other: any): any {\n\t\tif (other instanceof Vec3) {\n\t\t\treturn this._[0].scale(other.x)\n\t\t\t\t.addScale(this._[1], other.y)\n\t\t\t\t.addScale(this._[2], other.z);\n\t\t}\n\n\t\tconst rows: Vec3[] = [];\n\n\t\tfor (let i = 0; i < 3; ++i) {\n\t\t\tconst vx =\n\t\t\t\tthis._[i].x * other._[0].x +\n\t\t\t\tthis._[i].y * other._[1].x +\n\t\t\t\tthis._[i].z * other._[2].x;\n\n\t\t\tconst vy =\n\t\t\t\tthis._[i].x * other._[0].y +\n\t\t\t\tthis._[i].y * other._[1].y +\n\t\t\t\tthis._[i].z * other._[2].y;\n\n\t\t\tconst vz =\n\t\t\t\tthis._[i].x * other._[0].z +\n\t\t\t\tthis._[i].y * other._[1].z +\n\t\t\t\tthis._[i].z * other._[2].z;\n\n\t\t\trows.push(new Vec3(vx, vy, vz));\n\t\t}\n\n\t\treturn new Mat3(rows);\n\t}\n\ttranspose() {\n\t\treturn new Mat3([\n\t\t\tnew Vec3(this._[0].x, this._[1].x, this._[2].x),\n\t\t\tnew Vec3(this._[0].y, this._[1].y, this._[2].y),\n\t\t\tnew Vec3(this._[0].z, this._[1].z, this._[2].z),\n\t\t]);\n\t}\n\trotate(v: Vec3) {\n\t\treturn new Vec3(\n\t\t\tthis._[0].dot(v),\n\t\t\tthis._[1].dot(v),\n\t\t\tthis._[2].dot(v),\n\t\t);\n\t}\n\trotate2d(angle: number) {\n\t\treturn Mat3.createRotation2d(angle).multiply(this);\n\t}\n\ttranslate2d(x: number, y: number) {\n\t\treturn Mat3.createTranslation2d(x, y).multiply(this);\n\t}\n\tflatten() {\n\t\tlet flattened = this._flattened;\n\t\tif (!flattened) {\n\t\t\tflattened = this._flattened = [];\n\t\t\tthis._[0].pushTo(flattened);\n\t\t\tthis._[1].pushTo(flattened);\n\t\t\tthis._[2].pushTo(flattened);\n\t\t}\n\t\treturn flattened;\n\t}\n\n\ttoMat4(): Mat4 {\n\t\treturn new Mat4([\n\t\t\t[this._[0].x, this._[0].y, this._[0].z, 0],\n\t\t\t[this._[1].x, this._[1].y, this._[1].z, 0],\n\t\t\t[this._[2].x, this._[2].y, this._[2].z, 0],\n\t\t\t[0, 0, 0, 1],\n\t\t]);\n\t}\n\n}\nclass Mat4 {\n\n\tstatic I: Mat4 = new Mat4([\n\t\t[1, 0, 0, 0],\n\t\t[0, 1, 0, 0],\n\t\t[0, 0, 1, 0],\n\t\t[0, 0, 0, 1],\n\t]);\n\n\tstatic createPerspective(fovy: number, aspect: number, znear: number, zfar: number): Mat4 {\n\t\tconst ymax = znear * Math.tan(fovy * Math.PI / 360.0);\n\t\tconst ymin = -ymax;\n\t\tconst xmin = ymin * aspect;\n\t\tconst xmax = ymax * aspect;\n\n\t\treturn Mat4.createFrustum(xmin, xmax, ymin, ymax, znear, zfar);\n\t}\n\n\tstatic createPerspective2(fovy: number, aspect: number, near: number, far: number): Mat4 {\n\t\tconst out = new Float32Array(16);\n\n\t\tconst f = 1.0 / Math.tan(fovy / 2);\n\t\tconst nf = 1 / (near - far);\n\n\t\tout[0] = f / aspect;\n\t\tout[1] = 0;\n\t\tout[2] = 0;\n\t\tout[3] = 0;\n\t\tout[4] = 0;\n\t\tout[5] = f;\n\t\tout[6] = 0;\n\t\tout[7] = 0;\n\t\tout[8] = 0;\n\t\tout[9] = 0;\n\t\tout[10] = (far + near) * nf;\n\t\tout[11] = -1;\n\t\tout[12] = 0;\n\t\tout[13] = 0;\n\t\tout[14] = (2 * far * near) * nf;\n\t\tout[15] = 0;\n\n\t\treturn new Mat4(out);\n\t}\n\n\tstatic createLookAt(cameraPosition: Vec3, cameraTarget: Vec3, cameraUpVector: Vec3): Mat4 {\n\t\tconst vz = cameraPosition.sub(cameraTarget).unit();\n\t\tconst vx = cameraUpVector.cross(vz).unit();\n\t\tconst vy = vz.cross(vx);\n\n\t\tconst tx = -vx.dot(cameraPosition);\n\t\tconst ty = -vy.dot(cameraPosition);\n\t\tconst tz = -vz.dot(cameraPosition);\n\n\t\treturn new Mat4([\n\t\t\t[vx.x, vy.x, vz.x, 0],\n\t\t\t[vx.y, vy.y, vz.y, 0],\n\t\t\t[vx.z, vy.z, vz.z, 0],\n\t\t\t[tx, ty, tz, 1],\n\t\t]);\n\t}\n\n\tstatic createTranslation(t: Vec3): Mat4 {\n\t\treturn new Mat4([\n\t\t\t[1, 0, 0, t.x],\n\t\t\t[0, 1, 0, t.y],\n\t\t\t[0, 0, 1, t.z],\n\t\t\t[0, 0, 0, 1],\n\t\t]);\n\t}\n\t// from http://en.wikibooks.org/wiki/GLSL_Programming/Vertex_Transformations\n\tstatic createFrustum(l: number, r: number, b: number, t: number, n: number, f: number): Mat4 {\n\t\tconst dx = r - l;\n\t\tconst dy = t - b;\n\t\tconst dz = f - n;\n\n\t\tconst X = 2 * n / dx;\n\t\tconst Y = 2 * n / dy;\n\t\tconst A = (r + l) / dx;\n\t\tconst B = (t + b) / dy;\n\t\tconst C = -(f + n) / dz;\n\t\tconst D = -2 * n * f / dz;\n\n\t\treturn new Mat4([\n\t\t\t[X, 0, A, 0],\n\t\t\t[0, Y, B, 0],\n\t\t\t[0, 0, C, -D],\n\t\t\t[0, 0, 1, 0],\n\t\t]);\n\t}\n\n\telements: Float32Array;\n\n\tconstructor(rows: number[][] | Float32Array);\n\tconstructor(arg: any) {\n\t\tif (arg[0].length) {\n\t\t\tthis.elements = new Float32Array(16);\n\t\t\tfor (let col = 4; col--;) {\n\t\t\t\tfor (let row = 4; row--;) {\n\t\t\t\t\tthis.elements[row + col * 4] = arg[row][col];\n\t\t\t}\n\t\t\t\t}\n\t\t} else {\n\t\t\tthis.elements = arg;\n\t\t}\n\t}\n\n\tmultiply(m: Mat4): Mat4 {\n\t\tconst eltsL = this.elements;\n\t\tconst eltsR = m.elements;\n\n\t\tconst res = new Float32Array(16);\n\n\t\tfor (let row = 4; row--;) {\n\t\t\tfor (let col = 4; col--;) {\n\t\t\t\tres[row + col * 4] =\n\t\t\t\t\teltsL[row + 0 * 4] * eltsR[0 + col * 4] +\n\t\t\t\t\teltsL[row + 1 * 4] * eltsR[1 + col * 4] +\n\t\t\t\t\teltsL[row + 2 * 4] * eltsR[2 + col * 4] +\n\t\t\t\t\teltsL[row + 3 * 4] * eltsR[3 + col * 4];\n\t\t\t}\n\t\t}\n\n\t\treturn new Mat4(res);\n\t}\n\tflatten() { return this.elements; }\n\n\tgetRow(row: number): number[] {\n\t\treturn [\n\t\t\tthis.elements[row + 0 * 4],\n\t\t\tthis.elements[row + 1 * 4],\n\t\t\tthis.elements[row + 2 * 4],\n\t\t\tthis.elements[row + 3 * 4],\n\t\t];\n\t}\n\n}\n","/*\n * DataView.js:\n * An implementation of the DataView class on top of typed arrays.\n * Useful for Firefox 4 which implements TypedArrays but not DataView.\n *\n * Copyright 2011, David Flanagan\n *\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *\n *   Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n *\n *   Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE\n * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\n * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\"use strict\";\n\nnamespace DataView_ {\n\t// If DataView already exists, do nothing\n\t// if (DataView)\n\t// \treturn;\n\n\t// If ArrayBuffer is not supported, fail with an error\n\tif (!ArrayBuffer) {\n\t\tthrow new Error(\"ArrayBuffer not supported\");\n\t}\n\n\t// If ES5 is not supported, fail\n\tif (!Object.defineProperties) {\n\t\tthrow new Error(\"This module requires ECMAScript 5\");\n\t}\n\n\t// A temporary array for copying or reversing bytes into.\n\t// Since js is single-threaded, we only need this one static copy\n\n\t// The DataView() constructor\n\tclass DataView {\n\t\t// Figure if the platform is natively little-endian.\n\t\t// If the integer 0x00000001 is arranged in memory as 01 00 00 00 then\n\t\t// we're on a little endian platform. On a big-endian platform we'd get\n\t\t// get bytes 00 00 00 01 instead.\n\t\tstatic nativele: boolean = new Int8Array(new Int32Array([1]).buffer)[0] === 1;\n\n\t\tstatic temp = new Uint8Array(8);\n\n\t\tbuffer: ArrayBuffer;\n\t\tbyteOffset: number;\n\t\tbyteLength: number;\n\n\t\t_typedViews: { [index: string]: any } = {};\n\t\t_typedTempViews: { [index: string]: any } = {};\n\t\t_bytes: Uint8Array;\n\n\t\tgetInt8: (type: any, size: number, offset?: number, le?: boolean) => number;\n\t\tgetInt16: (type: any, size: number, offset?: number, le?: boolean) => number;\n\t\tgetInt32: (type: any, size: number, offset?: number, le?: boolean) => number;\n\n\t\tgetUint8: (type: any, size: number, offset?: number, le?: boolean) => number;\n\t\tgetUint16: (type: any, size: number, offset?: number, le?: boolean) => number;\n\t\tgetUint32: (type: any, size: number, offset?: number, le?: boolean) => number;\n\n\t\tgetFloat32: (type: any, size: number, offset?: number, le?: boolean) => number;\n\t\tgetFloat64: (type: any, size: number, offset?: number, le?: boolean) => number;\n\n\t\tsetInt8: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\t\tsetInt16: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\t\tsetInt32: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\n\t\tsetUint8: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\t\tsetUint16: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\t\tsetUint32: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\n\t\tsetFloat32: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\t\tsetFloat64: (type: any, size: number, offset: number, value: number, le?: boolean) => void;\n\n\t\tconstructor(buffer: ArrayBuffer, offset = 0, length: number = buffer.byteLength - offset) {\n\t\t\tif (!(buffer instanceof ArrayBuffer)) {\n\t\t\t\tthrow new Error(\"Bad ArrayBuffer\");\n\t\t\t}\n\n\t\t\tif (offset < 0 || length < 0 || offset + length > buffer.byteLength) {\n\t\t\t\tthrow new Error(\"Illegal offset and/or length\");\n\t\t\t}\n\n\t\t\tthis._bytes = new Uint8Array(buffer, offset, length);\n\n\t\t\t// Define the 3 read-only, non-enumerable ArrayBufferView properties\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tbuffer: {\n\t\t\t\t\tvalue: buffer,\n\t\t\t\t\tenumerable: false, writable: false, configurable: false,\n\t\t\t\t},\n\t\t\t\tbyteOffset: {\n\t\t\t\t\tvalue: offset,\n\t\t\t\t\tenumerable: false, writable: false, configurable: false,\n\t\t\t\t},\n\t\t\t\tbyteLength: {\n\t\t\t\t\tvalue: length,\n\t\t\t\t\tenumerable: false, writable: false, configurable: false,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.getInt8 = this._get.bind(this, Int8Array, 1) as any;\n\t\t\tthis.getUint8 = this._get.bind(this, Uint8Array, 1) as any;\n\n\t\t\tthis.getInt16 = this._get.bind(this, Int16Array, 2) as any;\n\t\t\tthis.getUint16 = this._get.bind(this, Uint16Array, 2) as any;\n\n\t\t\tthis.getInt32 = this._get.bind(this, Int32Array, 4) as any;\n\t\t\tthis.getUint32 = this._get.bind(this, Uint32Array, 4) as any;\n\n\t\t\tthis.getFloat32 = this._get.bind(this, Float32Array, 8) as any;\n\t\t\tthis.getFloat64 = this._get.bind(this, Float64Array, 8) as any;\n\n\t\t\tthis.setInt8 = this._set.bind(this, Int8Array, 1) as any;\n\t\t\tthis.setUint8 = this._set.bind(this, Uint8Array, 1) as any;\n\n\t\t\tthis.setInt16 = this._set.bind(this, Int16Array, 2) as any;\n\t\t\tthis.setUint16 = this._set.bind(this, Uint16Array, 2) as any;\n\n\t\t\tthis.setInt32 = this._set.bind(this, Int32Array, 4) as any;\n\t\t\tthis.setUint32 = this._set.bind(this, Uint32Array, 4) as any;\n\n\t\t\tthis.setFloat32 = this._set.bind(this, Float32Array, 8) as any;\n\t\t\tthis.setFloat64 = this._set.bind(this, Float64Array, 8) as any;\n\t\t}\n\n\t\t// The get() utility function used by the get methods\n\t\t_get(type: any, size: number, offset?: number, le?: boolean) {\n\t\t\tif (offset === undefined) {\n\t\t\t\tthrow new Error(\"Missing required offset argument\");\n\t\t\t}\n\n\t\t\tif (offset < 0 || offset + size > this.byteLength) {\n\t\t\t\tthrow new Error(\"Invalid index: \" + offset);\n\t\t\t}\n\n\t\t\tconst key = type.toString();\n\t\t\tconst temp = DataView.temp;\n\t\t\tconst bytes = this._bytes;\n\n\t\t\tif (size === 1 || !!le === DataView.nativele) {\n\t\t\t\t// This is the easy case: the desired endianness\n\t\t\t\t// matches the native endianness.\n\n\t\t\t\t// Typed arrays require proper alignment.  DataView does not.\n\t\t\t\tif ((this.byteOffset + offset) % size === 0) {\n\t\t\t\t\tlet typedView = this._typedViews[key];\n\t\t\t\t\tif (!typedView) {\n\t\t\t\t\t\ttypedView = this._typedViews[key] = new type(this.buffer, 0, Math.floor(this.buffer.byteLength / size));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn typedView[(this.byteOffset + offset) / size];\n\t\t\t\t}\n\n\t\t\t\t// Copy bytes into the temp array, to fix alignment\n\t\t\t\tfor (let i = 0; i < size; ++i) {\n\t\t\t\t\ttemp[i] = bytes[offset + i];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the native endianness doesn't match the desired, then\n\t\t\t\t// we have to reverse the bytes\n\t\t\t\tfor (let i = 0; i < size; ++i) {\n\t\t\t\t\ttemp[size - i - 1] = bytes[offset + i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet typedTempView = this._typedTempViews[key];\n\t\t\tif (!typedTempView) {\n\t\t\t\ttypedTempView = this._typedTempViews[key] = new type(temp.buffer, 0, 1);\n\t\t\t}\n\n\t\t\treturn typedTempView[0];\n\t\t}\n\n\t\t// The set() utility function used by the set methods\n\t\t_set(type: any, size: number, offset: number, value: number, le?: boolean) {\n\t\t\tif (offset === undefined) { throw new Error(\"Missing required offset argument\"); }\n\t\t\tif (value === undefined) { throw new Error(\"Missing required value argument\"); }\n\n\t\t\tif (offset < 0 || offset + size > this.byteLength) {\n\t\t\t\tthrow new Error(\"Invalid index: \" + offset);\n\t\t\t}\n\n\t\t\tconst temp = DataView.temp;\n\t\t\tconst bytes = this._bytes;\n\n\t\t\tif (size === 1 || !!le === DataView.nativele) {\n\t\t\t\t// This is the easy case: the desired endianness\n\t\t\t\t// matches the native endianness.\n\t\t\t\tif ((this.byteOffset + offset) % size === 0) {\n\t\t\t\t\t(new type(this.buffer, this.byteOffset + offset, 1))[0] = value;\n\t\t\t\t} else {\n\t\t\t\t\t(new type(temp.buffer))[0] = value;\n\t\t\t\t\t// Now copy the bytes into the this's buffer\n\t\t\t\t\tfor (let i = 0; i < size; ++i) {\n\t\t\t\t\t\tbytes[i + offset] = temp[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// If the native endianness doesn't match the desired, then\n\t\t\t\t// we have to reverse the bytes\n\n\t\t\t\t// Store the value into our temporary buffer\n\t\t\t\t(new type(temp.buffer))[0] = value;\n\n\t\t\t\t// Now copy the bytes, in reverse order, into the this's buffer\n\t\t\t\tfor (let i = 0; i < size; ++i) {\n\t\t\t\t\tbytes[offset + i] = temp[size - 1 - i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n}\n","/// <areference path=\"DataView.ts\" />\n\"use strict\";\n\nif (typeof ArrayBuffer === \"undefined\") {\n\tthrow new Error(\"ArrayBuffer not supported\");\n}\n\nif (typeof DataView === \"undefined\") {\n\tthrow new Error(\"DataView not supported\");\n}\n\nif (typeof Object.defineProperties === \"undefined\") {\n\tthrow new Error(\"This module requires ECMAScript 5\");\n}\n\nclass DataStream {\n\tposition = 0;\n\n\tlittleEndian = false;\n\tview: any;\n\tbyteLength: any;\n\n\tconstructor(view: ArrayBuffer|DataView, littleEndian?: boolean);\n\n\t// The DataStream() constructor\n\tconstructor(view: any, littleEndian = true) {\n\t\tif (view instanceof ArrayBuffer) {\n\t\t\tview = new DataView(view);\n\t\t} else if (!(view instanceof DataView)) {\n\t\t\tthrow new Error(\"Bad DataView\");\n\t\t\t\t\t\t\t}\n\n\t\tObject.defineProperties(this, {\n\t\t\tview: {\n\t\t\t\tvalue: view,\n\t\t\t\tenumerable: false, writable: false, configurable: false,\n\t\t\t},\n\t\t\tbyteLength: {\n\t\t\t\tvalue: view.byteLength,\n\t\t\t\tenumerable: false, writable: false, configurable: false,\n\t\t\t},\n\t\t\tlittleEndian: {\n\t\t\t\tvalue: !!littleEndian,\n\t\t\t\tenumerable: false, writable: false, configurable: false,\n\t\t\t},\n\t\t});\n\t}\n\tgetInt8(): number {\n\t\tconst value = this.view.getInt8(this.position);\n\t\tthis.position++;\n\t\treturn value;\n\t}\n\tgetUint8(): number {\n\t\tconst value = this.view.getUint8(this.position);\n\t\tthis.position++;\n\t\treturn value;\n\t}\n\tgetInt16(): number {\n\t\tconst value = this.view.getInt16(this.position, this.littleEndian);\n\t\tthis.position += 2;\n\t\treturn value;\n\t}\n\tgetUint16(): number {\n\t\tconst value = this.view.getUint16(this.position, this.littleEndian);\n\t\tthis.position += 2;\n\t\treturn value;\n\t}\n\tgetInt32(): number {\n\t\tconst value = this.view.getInt32(this.position, this.littleEndian);\n\t\tthis.position += 4;\n\t\treturn value;\n\t}\n\tgetUint32(): number {\n\t\tconst value = this.view.getUint32(this.position, this.littleEndian);\n\t\tthis.position += 4;\n\t\treturn value;\n\t}\n\tgetFloat32(): number {\n\t\tconst value = this.view.getFloat32(this.position, this.littleEndian);\n\t\tthis.position += 4;\n\t\treturn value;\n\t}\n\tgetFloat64(): number {\n\t\tconst value = this.view.getFloat64(this.position, this.littleEndian);\n\t\tthis.position += 8;\n\t\treturn value;\n\t}\n\tgetString(length: number): string {\n\t\tif (typeof length !== \"number\") {\n\t\t\tthrow new Error(\"bad type for length: \" + typeof length);\n\t\t}\n\n\t\tif (length < 0 || this.position + length > this.byteLength) {\n\t\t\tthrow new Error(\"INDEX_SIZE_ERR: DOM Exception 1\");\n\t\t}\n\n\t\tlet value = \"\";\n\t\tfor (let i = 0; i < length; ++i) {\n\t\t\tlet b = this.getUint8();\n\t\t\tif (b > 127) {\n\t\t\t\tb = 0xfffd;\n\t\t\t}\n\t\t\tvalue += String.fromCharCode(b);\n\t\t}\n\t\treturn value;\n\t}\n\tgetTerminatedString(terminators: string[], length?: number): string {\n\t\tlet value = \"\";\n\t\tconst start = this.position;\n\t\twhile (true) {\n\t\t\tif (length && value.length >= length) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet b = this.getUint8();\n\t\t\tif (b > 127) {\n\t\t\t\tb = 0xfffd;\n\t\t\t}\n\n\t\t\tconst ch = String.fromCharCode(b);\n\t\t\tif (terminators.indexOf(ch) >= 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvalue += ch;\n\t\t}\n\t\tif (length) {\n\t\t\tthis.position = start + length;\n\t\t}\n\t\treturn value;\n\t}\n\tgetFixed() {\n\t\treturn fix(this.getInt32());\n\t}\n\tgetFixed2() {\n\t\treturn fix2(this.getInt16());\n\t}\n\tgetVector() {\n\t\tconst x = this.getFixed();\n\t\tconst y = this.getFixed();\n\t\tconst z = this.getFixed();\n\n\t\tif (x === 0 && y === 0 && z === 0) {\n\t\t\treturn Vec3.Zero;\n\t\t}\n\n\t\treturn new Vec3(x, y, z);\n\t}\n\tgetVector2() {\n\t\tconst x = this.getFixed2();\n\t\tconst y = this.getFixed2();\n\t\tconst z = this.getFixed2();\n\n\t\tif (x === 0 && y === 0 && z === 0) {\n\t\t\treturn Vec3.Zero;\n\t\t}\n\n\t\treturn new Vec3(x, y, z);\n\t}\n\tgetMatrix() {\n\t\treturn new Mat3(\n\t\t\tthis.getVector(),\n\t\t\tthis.getVector(),\n\t\t\tthis.getVector(),\n\t\t);\n\t}\n\tgetRGB(): number {\n\t\tconst r = this.getUint8();\n\t\tconst g = this.getUint8();\n\t\tconst b = this.getUint8();\n\n\t\treturn (r << 16) | (g << 8) | b;\n\t}\n\tgetColor15() {\n\t\tconst rgb = this.getUint16();\n\n\t\tconst r = ((rgb >> 10) & 31) / 31;\n\t\tconst g = ((rgb >> 5) & 31) / 31;\n\t\tconst b = (rgb & 31) / 31;\n\n\t\treturn new Vec3(r, g, b);\n\t}\n\tgetInt8Array(count: number): number[] { return Array_iterate(count, this.getInt8.bind(this) as (i: number) => any); }\n\tgetInt16Array(count: number): number[] { return Array_iterate(count, this.getInt16.bind(this) as (i: number) => any); }\n\tgetInt32Array(count: number): number[] { return Array_iterate(count, this.getInt32.bind(this) as (i: number) => any); }\n\n\tgetUint8Array(count: number): number[] { return Array_iterate(count, this.getUint8.bind(this) as (i: number) => any); }\n\tgetUint16Array(count: number): number[] { return Array_iterate(count, this.getUint16.bind(this) as (i: number) => any); }\n\tgetUint32Array(count: number): number[] { return Array_iterate(count, this.getUint32.bind(this) as (i: number) => any); }\n\n\tgetVectorArray(count: number): Vec3[] { return Array_iterate(count, this.getVector.bind(this) as (i: number) => any); }\n\tgetVector2Array(count: number): Vec3[] { return Array_iterate(count, this.getVector2.bind(this) as (i: number) => any); }\n\tgetRGBArray(count: number): number[] { return Array_iterate(count, this.getRGB.bind(this) as (i: number) => any); }\n\tgetFixedArray(count: number): number[] { return Array_iterate(count, this.getFixed.bind(this) as (i: number) => any); }\n}\ninterface DataView {\n\tgetVector(): Vec3;\n\tslice(offset: number, length: number): DataView;\n}\n\ninterface DataStream {\n\t[index: string]: any;\n}\n\nDataView.prototype.slice = function(offset: number, length: number) {\n\tif (!(offset >= 0 && offset + length <= this.byteLength)) {\n\t\tthrow new Error(\"Invalid index: \" + offset);\n\t}\n\treturn new DataView(this.buffer, this.byteOffset + offset, length);\n};\n","/// <reference path=\"Math.ts\" />\n\n//// <reference path=\"jquery.d.ts\" />\n\"use strict\";\n\ndeclare class WebGLDebugUtils {\n\tstatic makeDebugContext(gl: WebGLRenderingContext): WebGLRenderingContext;\n}\n\ninterface WebGLObject {\n\t[index: string]: any;\n}\n\nlet gl: WebGLRenderingContext;\n\ninterface JQuery {\n\teach(func: (index: number, elem: any) => any): JQuery;\n}\n\nfunction createProgram(name: string, attrs: string[], uniforms: string[]) {\n\tfunction compileShader(shaderType: number, str: string) {\n\t\tconst shader = gl.createShader(shaderType);\n\t\tgl.shaderSource(shader, str);\n\t\tgl.compileShader(shader);\n\n\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n\t\t\tconst error = gl.getShaderInfoLog(shader);\n\t\t\tthrow new Error(`Error compiling ${shaderType}:\\n${error}`);\n\t\t}\n\n\t\treturn shader;\n\t}\n\n\treturn $.when(\n\t\t$.get(`assets/shaders/${name}.vs.glsl`),\n\t\t$.get(`assets/shaders/${name}.fs.glsl`),\n\t).then((vsArgs: any[], fsArgs: any[]) => {\n\t\tconst program = notNull(gl.createProgram());\n\t\tgl.attachShader(program, compileShader(gl.VERTEX_SHADER, vsArgs[0] + \"\\n//\" + name + \".vs\"));\n\t\tgl.attachShader(program, compileShader(gl.FRAGMENT_SHADER, fsArgs[0] + \"\\n//\" + name + \".fs\"));\n\t\tgl.linkProgram(program);\n\n\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n\t\t\talert(\"LINK: Could not initialise shaders\");\n\t\t}\n\n\t\tuseProgram(program);\n\n\t\t$.each(attrs, (i: number, e: string): void => {\n\t\t\tconst loc = gl.getAttribLocation(program, e);\n\t\t\tif (!(loc >= 0)) {\n\t\t\t\tthrow new Error(`${name}: attribute '${e}' not found!`);\n\t\t\t}\n\t\t\tprogram[e] = loc;\n\t\t\t// console.log(vs + \" ATTR \" + e + \" = \" + loc);\n\t\t\t// gl.enableVertexAttribArray(loc);\n\t\t});\n\n\t\t$.each(uniforms, (i: number, e: string): void => {\n\t\t\tconst loc = gl.getUniformLocation(program, e);\n\t\t\tif (!loc) {\n\t\t\t\tthrow new Error(`${name}: uniform '${e}' not found!`);\n\t\t\t}\n\t\t\tprogram[e] = loc;\n\t\t});\n\n\t\treturn program;\n\t});\n}\n\nlet programDouble: WebGLProgram;\nlet programSingle: WebGLProgram;\nlet programFlat: WebGLProgram;\nlet programBillboard: WebGLProgram;\nlet programBillboardX: WebGLProgram;\nlet programLit: WebGLProgram;\n\nlet rgPrograms: WebGLProgram[];\n\ninterface JQuery {\n\tmap(callback: (index: number, domElement: any) => any): any[];\n}\n\nfunction initShaders() {\n\tconst rgBillboardVertexPositions = [\n\t\tnew Vec2(0, 0),\n\t\tnew Vec2(0, 1),\n\t\tnew Vec2(1, 1),\n\t\tnew Vec2(1, 0),\n\t];\n\n\treturn $.when(\n\t\tcreateProgram(\n\t\t\t\"double\",\n\t\t\t[\n\t\t\t\t\"aVertexPosition\",\n\t\t\t\t\"aVertexTextureCoord\",\n\t\t\t\t\"aVertexLight\",\n\t\t\t\t\"aVertexBrightness\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"matProjection\",\n\t\t\t\t\"matModelView\",\n\t\t\t\t\"slide\",\n\t\t\t\t\"alpha\",\n\t\t\t\t\"sampPalette\",\n\n\t\t\t\t\"matOrientTex2\",\n\t\t\t\t\"sampTexture1\",\n\t\t\t\t\"sampTexture2\",\n\t\t\t\t// \"sampVertexPositions\",\n\t\t\t\t// \"matTriView\",\n\t\t\t\t// \"xMin\", \"xMax\", \"yMin\", \"yMax\",\n\t\t\t],\n\t\t).done((program: WebGLProgram) => {\n\t\t\tprogramDouble = program;\n\t\t\tgl.uniform1i(programDouble.sampPalette, 0);\n\t\t\tgl.uniform1i(programDouble.sampTexture1, 1);\n\t\t\tgl.uniform1i(programDouble.sampTexture2, 2);\n\t\t\tgl.uniform1f(programDouble.alpha, 1.0);\n\t\t}),\n\n\t\tcreateProgram(\n\t\t\t\"single\",\n\t\t\t[\n\t\t\t\t\"aVertexPosition\",\n\t\t\t\t\"aVertexTextureCoord\",\n\t\t\t\t\"aVertexLight\",\n\t\t\t\t\"aVertexBrightness\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"matProjection\",\n\t\t\t\t\"matModelView\",\n\t\t\t\t\"sampPalette\",\n\t\t\t\t\"slide\",\n\t\t\t\t\"alpha\",\n\n\t\t\t\t\"sampTexture\",\n\t\t\t\t/*\n\t\t\t\t\"leftPlaneAnchor\", \"leftPlaneNormal\",\n\t\t\t\t\"rightPlaneAnchor\", \"rightPlaneNormal\",\n\t\t\t\t\"bottomPlaneAnchor\", \"bottomPlaneNormal\",\n\t\t\t\t\"topPlaneAnchor\", \"topPlaneNormal\",\n\t\t\t\t*/\n\t\t\t],\n\t\t).done((program: WebGLProgram) => {\n\t\t\tprogramSingle = program;\n\t\t\tgl.uniform1i(programSingle.sampPalette, 0);\n\t\t\tgl.uniform1i(programSingle.sampTexture, 1);\n\t\t\tgl.uniform1f(programSingle.alpha, 1.0);\n\t\t}),\n\n\t\tcreateProgram(\n\t\t\t\"lit\",\n\t\t\t[\n\t\t\t\t\"aVertexPosition\",\n\t\t\t\t\"aVertexTextureCoord\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"matProjection\",\n\t\t\t\t\"matModelView\",\n\t\t\t\t\"sampTexture\",\n\t\t\t\t\"sampPalette\",\n\t\t\t\t\"light\",\n\t\t\t],\n\t\t).done((program: WebGLProgram) => {\n\t\t\tprogramLit = program;\n\t\t\tgl.uniform1i(programLit.sampPalette, 0);\n\t\t\tgl.uniform1i(programLit.sampTexture, 1);\n\t\t}),\n\n\t\tcreateProgram(\n\t\t\t\"flat\",\n\t\t\t[\n\t\t\t\t\"aVertexPosition\",\n\t\t\t\t\"aVertexColor\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"matProjection\",\n\t\t\t\t\"matModelView\",\n\t\t\t\t\"light\",\n\t\t\t],\n\t\t).done((program: WebGLProgram) => {\n\t\t\tprogramFlat = program;\n\t\t}),\n\n\t\tcreateProgram(\n\t\t\t\"billboard\",\n\t\t\t[\n\t\t\t\t\"aVertexPosition\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"matProjection\",\n\t\t\t\t\"matModelView\",\n\t\t\t\t\"sampTexture\",\n\t\t\t\t\"sampPalette\",\n\t\t\t\t\"sizeTexture\",\n\t\t\t\t\"scale\",\n\t\t\t\t// \"alpha\",\n\t\t\t\t\"pos\",\n\t\t\t],\n\t\t).done((program: WebGLProgram) => {\n\t\t\tprogramBillboard = program;\n\t\t\tgl.uniform1i(programBillboard.sampPalette, 0);\n\t\t\tgl.uniform1i(programBillboard.sampTexture, 1);\n\n\t\t\tprogramBillboard.bufferVertexPosition = createBuffer(Array.prototype.concat.apply([], rgBillboardVertexPositions.map((v) => v.flatten())), 2);\n\t\t\tloadAttribBuffer(programBillboard.aVertexPosition, programBillboard.bufferVertexPosition);\n\t\t}),\n\n\t\tcreateProgram(\n\t\t\t\"billboard-x\",\n\t\t\t[\n\t\t\t\t\"aVertexPosition\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"matProjection\",\n\t\t\t\t\"matModelView\",\n\t\t\t\t\"sampTexture\",\n\t\t\t\t\"sampPalette\",\n\t\t\t\t\"sizeTexture\",\n\t\t\t\t\"scale\",\n\t\t\t\t// \"alpha\",\n\t\t\t\t\"pos\",\n\t\t\t\t\"eye\",\n\t\t\t],\n\t\t).done((program: WebGLProgram) => {\n\t\t\tprogramBillboardX = program;\n\t\t\tgl.uniform1i(programBillboardX.sampPalette, 0);\n\t\t\tgl.uniform1i(programBillboardX.sampTexture, 1);\n\n\t\t\tprogramBillboardX.bufferVertexPosition = createBuffer(Array.prototype.concat.apply([], rgBillboardVertexPositions.map((v) => v.flatten())), 2);\n\t\t\tloadAttribBuffer(programBillboardX.aVertexPosition, programBillboardX.bufferVertexPosition);\n\t\t}),\n\t).done(function() {\n\t\trgPrograms = $.makeArray(arguments);\n\t});\n}\n\nconst _rgTextures = new Array<WebGLTexture>(5);\n\nlet _activeTexture: number | null;\nfunction bindTexture(iUnit: number, tex: WebGLTexture) {\n\tif (_rgTextures[iUnit] === tex) {\n\t\treturn;\n\t}\n\t_rgTextures[iUnit] = tex;\n\tif (_activeTexture !== iUnit) {\n\t\t_activeTexture = iUnit;\n\t\tgl.activeTexture(gl.TEXTURE0 + iUnit);\n\t}\n\tgl.bindTexture(gl.TEXTURE_2D, tex);\n}\n\n// create an image from an array of single-byte values\nfunction createTexture(iUnit: number, filter?: number) {\n\tconst texImage = gl.createTexture();\n\tif (!texImage) {\n\t\tthrow new Error(\"failed to create texture\");\n\t}\n\n\tbindTexture(iUnit || 0, texImage);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter || gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter || gl.NEAREST);\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\t// gl.generateMipmap(gl.TEXTURE_2D);\n\treturn texImage;\n}\n\nfunction initPalette(rgColors: number[]) {\n\tconst tex = createTexture(0);\n\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n\tupdatePalette(tex, rgColors);\n\treturn tex;\n}\n\nfunction updatePalette(tex: WebGLTexture, rgColors: number[]) {\n\t// WebGL needs an unpacked array of RGB values\n\tconst rgb = new Uint8Array(256 * 4);\n\tlet ib = 0;\n\tfor (let i = 0; i < 256; ++i) {\n\t\tconst color = rgColors[i];\n\t\trgb[ib++] = 4 * (color >> 16) & 0xff;\t// R\n\t\trgb[ib++] = 4 * (color >> 8) & 0xff;\t// G\n\t\trgb[ib++] = 4 * (color >> 0) & 0xff;\t// B\n\t\trgb[ib++] = (i >= 254) ? 0 : 255;\t\t// A\n\t}\n\n\t// update the palette\n\tbindTexture(0, tex);\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 256, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, rgb);\n\t// gl.bindTexture(gl.TEXTURE_2D, null);\n}\n\nfunction createBuffer(rgItems: number[], cValuesPerItem: number, flags?: number) {\n\tif (!rgItems) {\n\t\tthrow new Error(\"invalid item array\");\n\t}\n\n\tconst cItems = rgItems.length;\n\tif (!cItems || (cItems % cValuesPerItem) !== 0) {\n\t\tthrow new Error(\"invalid #items\");\n\t}\n\n\tif (flags == null) {\n\t\tflags = gl.STATIC_DRAW;\n\t}\n\n\tconst items = new Float32Array(rgItems);\n\tconst buffer = gl.createBuffer();\n\tif (!buffer) {\n\t\tthrow new Error(\"failed to create buffer\");\n\t}\n\n\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\tgl.bufferData(gl.ARRAY_BUFFER, items, flags);\n\tbuffer.itemSize = cValuesPerItem;\n\tbuffer.numItems = cItems / cValuesPerItem;\n\treturn buffer;\n}\n\nfunction createDynamicBuffer(rgItems: number[], cValuesPerItem: number) {\n\tif (!rgItems) {\n\t\tthrow new Error(\"invalid item array\");\n\t}\n\n\tconst cItems = rgItems.length;\n\tif (!cItems || (cItems % cValuesPerItem) !== 0) {\n\t\tthrow new Error(\"invalid #items\");\n\t}\n\n\tconst items = new Float32Array(rgItems);\n\tconst buffer = gl.createBuffer();\n\tif (!buffer) {\n\t\tthrow new Error(\"failed to create buffer\");\n\t}\n\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\tgl.bufferData(gl.ARRAY_BUFFER, items, gl.DYNAMIC_DRAW);\n\tbuffer.itemSize = cValuesPerItem;\n\tbuffer.numItems = cItems / cValuesPerItem;\n\tbuffer.items = items;\n\treturn buffer;\n}\n\nfunction updateDynamicBuffer(buffer: WebGLBuffer, offset: number, items: Float32Array) {\n\tif (!buffer) {\n\t\tthrow new Error(\"buffer\");\n\t}\n\n\tif (offset === undefined) {\n\t\toffset = 0;\n\t}\n\n\tif (!items) {\n\t\tthrow new Error(\"invalid buffer items\");\n\t}\n\n\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\tgl.bufferSubData(gl.ARRAY_BUFFER, offset, items);\n}\n\nlet _cHits = 0;\nlet _cCalls = 0;\nconst _mapAttribBuffers: WebGLBuffer[] = [];\nfunction loadAttribBuffer(attrib: number, buffer: WebGLBuffer) {\n\tif (attrib === undefined) {\n\t\tthrow new Error(\"invalid attibute\");\n\t}\n\tif (!buffer) {\n\t\tthrow new Error(\"invalid buffer\");\n\t}\n\n\tif (_mapAttribBuffers[attrib] === buffer) {\n\t\t_cHits++;\n\t\treturn;\n\t}\n\t_cCalls++;\n\n\t_mapAttribBuffers[attrib] = buffer;\n\n\tif (attrib === undefined) {\n\t\tthrow new Error(\"invalid item array\");\n\t}\n\n\tif (buffer === undefined) {\n\t\tthrow new Error(\"invalid item array\");\n\t}\n\n\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\tgl.vertexAttribPointer(attrib, buffer.itemSize, gl.FLOAT, false, 0, 0);\n\tgl.enableVertexAttribArray(attrib);\n}\n\nfunction updateViewport() {\n\tif (!gl) {\n\t\treturn;\n\t}\n\n\tconst canvas = gl.canvas;\n\tconst width = canvas.clientWidth;\n\tconst height = canvas.clientHeight;\n\n\tcanvas.width = 800;\n\tcanvas.height = 600;\n\n\tcanvas.width = width;\n\tcanvas.height = height;\n\n\tgl.viewport(0, 0, canvas.width, canvas.height);\n\n\tconst FOV = 59;\n\tconst matProjection = Mat4.createPerspective(FOV, width / height, .01, 5000).flatten();\n\n\tfor (let i = rgPrograms.length; i--;) {\n\t\tconst program = rgPrograms[i];\n\t\tgl.useProgram(program);\n\t\tgl.uniformMatrix4fv(program.matProjection, false, matProjection);\n\t}\n\n\t_programLast = rgPrograms[0];\n}\n\nlet matModelView: Mat4;\nconst rgMatrices: Mat4[] = [];\n\nfunction beginScene(position: Vec3, orient: Mat3) {\n\tconst or4 = orient.toMat4();\n\n\tmatModelView = or4.multiply(Mat4.createTranslation(Vec3.Zero.sub(position)));\n\trgMatrices.length = 0;\n\n\t// updateMatModelView(matModelView);\n\n\tuseProgram(programBillboardX);\n\tgl.uniform3f(programBillboardX.eye, position.x, position.y, position.z);\n\n\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n}\n\nfunction createAngleMatrix(angles: Vec3 | null, pos: Vec3 | null) {\n\tlet mat: Mat4 | null = pos ? Mat4.createTranslation(pos) : null;\n\n\tif (angles && angles !== Vec3.Zero) {\n\t\tconst matOrient = Mat3.createRotation(angles).toMat4();\n\t\tif (mat) {\n\t\t\tmat = mat.multiply(matOrient);\n\t\t} else {\n\t\t\tmat = matOrient;\n\t\t}\n\t}\n\n\treturn mat;\n}\n\nfunction pushInstanceMatrix(m: Mat4) {\n\tif (!(m instanceof Mat4)) {\n\t\tthrow new Error(\"invalid argument: m\");\n\t}\n\tpushMatrix(matModelView.multiply(m));\n}\n\nfunction pushMatrix(m: Mat4) {\n\tif (!(m instanceof Mat4)) {\n\t\tthrow new Error(\"invalid argument: m\");\n\t}\n\n\trgMatrices.push(matModelView);\n\tupdateMatModelView(m);\n}\n\nfunction pushAnglesMatrix(angles: Vec3, pos?: Vec3) {\n\tif (!(angles instanceof Vec3)) {\n\t\tthrow new Error(\"invalid argument: angles\");\n\t}\n\n\tconst matOrient = Mat3.fromEuler(angles.x, angles.y, angles.z);\n\tpushOrientMatrix(matOrient, pos);\n}\n\nfunction pushTranslateMatrix(pos: Vec3) {\n\tif (!(pos instanceof Vec3)) {\n\t\tthrow new Error(\"invalid argument: pos\");\n\t}\n\n\tconst matPos = Mat4.createTranslation(pos);\n\tpushInstanceMatrix(matPos);\n}\n\nfunction pushOrientMatrix(matOrient: Mat3, pos?: Vec3) {\n\tif (!(matOrient instanceof Mat3)) {\n\t\tthrow new Error(\"invalid argument: matOrient\");\n\t}\n\n\tlet mat = matOrient.transpose().toMat4();\n\n\tif (pos) {\n\t\tif (!(pos instanceof Vec3)) {\n\t\t\tthrow new Error(\"invalid vector: pos\");\n\t\t}\n\t\tconst matPos = Mat4.createTranslation(pos);\n\t\tmat = matPos.multiply(mat);\n\t}\n\n\tpushInstanceMatrix(mat);\n}\n\nfunction popMatrix() {\n\tupdateMatModelView(matModelView = notNull(rgMatrices.pop()));\n\treturn matModelView;\n}\n\nlet _programLast: WebGLProgram;\nfunction useProgram(program: WebGLProgram) {\n\tif (_programLast === program) {\n\t\treturn;\n\t}\n\n\t_programLast = program;\n\tgl.useProgram(program);\n\n\t_activeTexture = null;\n\n\tif (program.mmv !== matModelView) {\n\t\tprogram.mmv = matModelView;\n\t\tgl.uniformMatrix4fv(program.matModelView, false, matModelView.flatten());\n\t}\n}\n\nfunction updateMatModelView(m: Mat4) {\n\tif (!m) {\n\t\tthrow new Error(\"invalid matrix\");\n\t}\n\n\tmatModelView = m;\n\n\tif (_programLast) {\n\t\t_programLast.mmv = matModelView;\n\t\tgl.uniformMatrix4fv(_programLast.matModelView, false, matModelView.flatten());\n\t}\n}\n\nfunction webGLStart() {\n\tconst canvas = $(\"#canvas\")[0] as HTMLCanvasElement;\n\tgl = canvas.getContext(\"experimental-webgl\") as WebGLRenderingContext;\n\n\tgl.clearColor(0.0, 0.0, 0.0, 1.0);\n\tgl.clearDepth(0.0);\n\n\tgl.frontFace(gl.CW);\n\tgl.cullFace(gl.FRONT);\n\tgl.enable(gl.CULL_FACE);\n\n\tgl.depthFunc(gl.GEQUAL);\n\tgl.enable(gl.DEPTH_TEST);\n\n\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n\treturn initShaders();\n}\n","//// <reference path=\"WebAudio.d.ts\" />\n\n/// <reference path=\"DataView.ts\" />\n/// <reference path=\"DataStream.ts\" />\n/// <reference path=\"Math.ts\" />\n/// <reference path=\"webgl.ts\" />\n/// <reference path=\"Item.ts\" />\n\"use strict\";\n\nlet _audio: AudioContext;\nlet _mainAudio: AudioNode;\n\nclass SoundFile {\n\tindex: number;\n\tname: string;\n\tlength: number;\n\tdata_length: number;\n\toffset: number;\n\n\tdata: Uint8Array;\n\tbuffer: AudioBuffer;\n\n\tload(stream: DataStream) {\n\t\tthis.name = stream.getString(8);\n\t\tthis.length = stream.getUint32();\n\t\tthis.data_length = stream.getUint32();\t// ?\n\t\tthis.offset = stream.getUint32();\n\t\treturn this;\n\t}\n\tgetBuffer() {\n\t\tlet buffer = this.buffer;\n\t\tif (!buffer) {\n\t\t\tbuffer = this.buffer = _audio.createBuffer(1, this.length, 22050 / 2);\n\t\t\t// buffer.gain.value = 1;\n\t\t\tconst rgSamples = buffer.getChannelData(0);\n\t\t\tconst data = this.data;\n\t\t\tfor (let iSample = this.length; iSample--;) {\n\t\t\t\t// rgSamples[iSample] = data[iSample] * 2 / 255 - 1;\n\t\t\t\trgSamples[iSample] = data[iSample] / 255 - .5;\n\t\t\t}\n\t\t}\n\t\treturn buffer;\n\t}\n\tplayObjectSound(obj: Item) {\n\t\tif (!_audio) {\n\t\t\treturn;\n\t\t}\n\t\tconst buffer = this.getBuffer();\n\t\tconst playingSound = new ItemSound(buffer, obj);\n\t\tPlayingSound.play(playingSound);\n\t}\n\tplaySound(pos?: Vec3) {\n\t\tif (!_audio) {\n\t\t\treturn;\n\t\t}\n\t\tconst buffer = this.getBuffer();\n\t\tconst playingSound = pos ? new PositionalSound(buffer, pos) : new PlayingSound(buffer);\n\t\tPlayingSound.play(playingSound);\n\t}\n}\nenum SoundFile_Sounds {\n\tLASER_FIRED = 10,\n\n\tWEAPON_HIT_DOOR = 27,\n\tWEAPON_HIT_BLASTABLE = 11,\n\tBADASS_EXPLOSION = 11, // need something different for this if possible\n\n\tROBOT_HIT_PLAYER = 17,\n\n\tROBOT_HIT = 20,\n\tROBOT_DESTROYED = 21,\n\tVOLATILE_WALL_HIT = 21,\n\tLASER_HIT_WATER = 232,\n\tMISSILE_HIT_WATER = 233,\n\n\tLASER_HIT_CLUTTER = 30,\n\tCONTROL_CENTER_HIT = 30,\n\tEXPLODING_WALL = 31,  // one long sound\n\tCONTROL_CENTER_DESTROYED = 31,\n\n\tCONTROL_CENTER_WARNING_SIREN = 32,\n\tMINE_BLEW_UP = 33,\n\n\tFUSION_WARMUP = 34,\n\tDROP_WEAPON = 39,\n\n\tFORCEFIELD_BOUNCE_PLAYER = 40,\n\tFORCEFIELD_BOUNCE_WEAPON = 41,\n\tFORCEFIELD_HUM = 42,\n\tFORCEFIELD_OFF = 43,\n\n\tMARKER_HIT = 50,\n\tBUDDY_MET_GOAL = 51,\n\n\tREFUEL_STATION_GIVING_FUEL = 62,\n\n\tPLAYER_HIT_WALL = 70,\n\tPLAYER_GOT_HIT = 71,\n\n\tHOSTAGE_RESCUED = 91,\n\n\tBRIEFING_HUM = 94,\n\tBRIEFING_PRINTING = 95,\n\n\tCOUNTDOWN_0_SECS = 100, // countdown 100..114\n\tCOUNTDOWN_13_SECS = 113,\n\tCOUNTDOWN_29_SECS = 114,\n\n\tHUD_MESSAGE = 117,\n\tHUD_KILL = 118,\n\n\tHOMING_WARNING = 122, // Warning beep= You are being tracked by a missile! Borrowed from old repair center sounds.\n\n\tHUD_JOIN_REQUEST = 123,\n\tHUD_BLUE_GOT_FLAG = 124,\n\tHUD_RED_GOT_FLAG = 125,\n\tHUD_YOU_GOT_FLAG = 126,\n\tHUD_BLUE_GOT_GOAL = 127,\n\tHUD_RED_GOT_GOAL = 128,\n\tHUD_YOU_GOT_GOAL = 129,\n\n\tLAVAFALL_HISS = 150, // under a lavafall\n\tVOLATILE_WALL_HISS = 151, // need a hiss sound here.\n\tSHIP_IN_WATER = 152, // sitting (or moving though) water\n\tSHIP_IN_WATERFALL = 158, // under a waterfall\n\n\tGOOD_SELECTION_PRIMARY = 153,\n\tBAD_SELECTION = 156,\n\n\tGOOD_SELECTION_SECONDARY = 154, // Adam= New sound number here! MK, 01/30/95\n\tALREADY_SELECTED = 155, // Adam= New sound number here! MK, 01/30/95\n\n\tCLOAK_ON = 160, // USED FOR WALL CLOAK\n\tCLOAK_OFF = 161, // sound when cloak goes away\n\tINVULNERABILITY_OFF = 163, // sound when invulnerability goes away\n\n\tBOSS_SHARE_SEE = 183,\n\tBOSS_SHARE_DIE = 185,\n\n\tSEE_SOUND_DEFAULT = 170,\n\tATTACK_SOUND_DEFAULT = 171,\n\tCLAW_SOUND_DEFAULT = 190,\n\n\tDROP_BOMB = 26,\n\n\tCHEATER = 200,\n\n\tAMBIENT_LAVA = 222,\n\tAMBIENT_WATER = 223,\n\n\tCONVERT_ENERGY = 241,\n\tWEAPON_STOLEN = 244,\n\n\tLIGHT_BLOWNUP = 157,\n\n\tWALL_REMOVED = 246, // Wall removed, probably due to a wall switch.\n\tAFTERBURNER_IGNITE = 247,\n\tAFTERBURNER_PLAY = 248,\n\n\tSECRET_EXIT = 249,\n\n\tSEISMIC_DISTURBANCE_START = 251,\n\n\tYOU_GOT_ORB = 84,\n\tFRIEND_GOT_ORB = 85,\n\tOPPONENT_GOT_ORB = 86,\n\tOPPONENT_HAS_SCORED = 87,\n\n\tBIG_ENDLEVEL_EXPLOSION = EXPLODING_WALL,\n\tTUNNEL_EXPLOSION = EXPLODING_WALL,\n\tROBOT_SUCKED_PLAYER = ROBOT_HIT_PLAYER, // Robot sucked energy from player.\n\tWALL_CLOAK_ON = CLOAK_ON,\n\tWALL_CLOAK_OFF = CLOAK_OFF,\n}\n// SoundFile_Sounds = freeze(SoundFile_Sounds);\n\nclass PlayingSound {\n\tstatic rgPlayingSounds: PlayingSound[] = [];\n\n\tstatic play(sound: PlayingSound) {\n\t\tPlayingSound.rgPlayingSounds.push(sound);\n\t\tsound.play();\n\t}\n\tstatic update() {\n\t\tconst rgPlayingSounds = PlayingSound.rgPlayingSounds;\n\t\tfor (let iPlayingSound = rgPlayingSounds.length; iPlayingSound--;) {\n\t\t\tconst playingSound = rgPlayingSounds[iPlayingSound];\n\t\t\tif (!playingSound.update()) {\n\t\t\t\trgPlayingSounds.swapOut(iPlayingSound);\n\t\t\t}\n\t\t}\n\t}\n\n\tsourceNode: any;\n\n\tconstructor(public buffer: AudioBuffer) {\n\t}\n\n\tplay() {\n\t\tthis.createSourceNode(this.buffer);\n\t\tthis.update();\n\t\tthis.sourceNode.start(0);\n\t}\n\n\tcreateSourceNode(buffer: AudioBuffer) {\n\t\tconst sourceNode = this.sourceNode = _audio.createBufferSource();\n\t\tsourceNode.buffer = buffer;\n\t\t// sourceNode.playbackRate.value = .5;\n\t\tsourceNode.connect(_mainAudio);\n\t}\n\n\tupdate() {\n\t\t// do nothing\n\t}\n}\n\nclass PannerSound extends PlayingSound {\n\tpannerNode: PannerNode;\n\n\tcreateSourceNode(buffer: AudioBuffer) {\n\t\tconst sourceNode = this.sourceNode = _audio.createBufferSource();\n\t\tsourceNode.buffer = buffer;\n\t\t// sourceNode.playbackRate.value = .5;\n\n\t\tconst pannerNode = this.pannerNode = _audio.createPanner();\n\t\tpannerNode.panningModel = \"equalpower\";\n\t\tpannerNode.distanceModel = \"inverse\";\n\t\tpannerNode.refDistance = 2;\n\t\tpannerNode.rolloffFactor = .5;\n\n\t\tsourceNode.connect(pannerNode);\n\t\tpannerNode.connect(_mainAudio);\n\t}\n}\nclass PositionalSound extends PannerSound {\n\tconstructor(buffer: AudioBuffer, public pos: Vec3) {\n\t\tsuper(buffer);\n\t\tnotNull(this.pos);\n\t}\n\n\tupdate() {\n\t\tconst pos = this.pos;\n\t\tthis.pannerNode.setPosition(pos.x, pos.y, pos.z);\n\t\treturn this.sourceNode.playbackState !== this.sourceNode.FINISHED_STATE;\n\t}\n}\nclass ItemSound extends PannerSound {\n\tconstructor(buffer: AudioBuffer, public obj: Item) {\n\t\tsuper(buffer);\n\t\tnotNull(this.obj);\n\t}\n\n\tupdate() {\n\t\tconst obj = this.obj;\n\n\t\tconst pos = obj.pos;\n\t\tthis.pannerNode.setPosition(pos.x, pos.y, pos.z);\n\n\t\t/*\n\t\tconst pi = obj.mover;\n\t\tif (pi) {\n\t\t\tconst vel = pi.velocity;\n\t\t\t// this.pannerNode.setVelocity(vel.x, vel.y, vel.z);\n\t\t\tthis.pannerNode.setVelocity(0, 0, 0);\n\t\t}\n\t\t*/\n\n\t\treturn this.sourceNode.playbackState !== this.sourceNode.FINISHED_STATE;\n\t}\n}\n","/// <reference path=\"DataView.ts\" />\n/// <reference path=\"DataStream.ts\" />\n\n/// <reference path=\"Math.ts\" />\n/// <reference path=\"webgl.ts\" />\n\"use strict\";\n\nlet _pig: Pig;\n\nenum BitmapFlags {\n\tTRANSPARENT = (1 << 0),\n\tSUPER_TRANSPARENT = (1 << 1),\n\tNO_LIGHTING = (1 << 2),\n\tRLE = (1 << 3),  // A run-length encoded bitmap.\n\tPAGED_OUT = (1 << 4),  // This bitmap's data is paged out.\n\tRLE_BIG = (1 << 5),  // for bitmaps that RLE to > 255 per row (i.e. cockpits)\n}\nclass BitmapHeader {\n\tbuffer: ArrayBuffer;\n\tname: string;\n\t// dflags: number;\n\twidth: number;\n\theight: number;\n\t// wh_extra: number;\n\tflags: BitmapFlags;\n\tavg_color: number;\n\toffset: number;\n\n\tdata: Uint8Array;\n\n\tload(stream: DataStream) {\n\t\tthis.buffer = stream.view.buffer;\n\t\tthis.name = stream.getTerminatedString([\"\\0\", \"\\n\"], 8);\n\t\tconst dflags = stream.getUint8();\n\t\tthis.width = stream.getUint8();\n\t\tthis.height = stream.getUint8();\n\t\tconst wh_extra = stream.getUint8();\n\t\tthis.flags = stream.getUint8();\n\t\tthis.avg_color = stream.getUint8();\n\t\tthis.offset = stream.getUint32();\n\n\t\tif (dflags & (1 << 6)) {\n\t\t\tthis.name += \"#\" + (dflags & ((1 << 6) - 1));\n\t\t}\n\n\t\tthis.width += (wh_extra & 0x0f) << 8;\n\t\tthis.height += (wh_extra & 0xf0) << 4;\n\n\t\treturn this;\n\t}\n\tisTransparent() {\n\t\treturn this.flags & BitmapFlags.TRANSPARENT;\n\t}\n\tloadImage() {\n\t\tif (!this.data) {\n\t\t\tconst view = new DataView(this.buffer, this.offset);\n\t\t\tconst stream = new DataStream(view);\n\t\t\tif (this.flags & BitmapFlags.RLE) {\n\t\t\t\tconst cbTotal = stream.getUint32();\n\t\t\t\tconst offset = stream.position;\n\n\t\t\t\tlet rgSizes: number[];\n\t\t\t\tif (this.flags & BitmapFlags.RLE_BIG) {\n\t\t\t\t\trgSizes = stream.getUint16Array(this.height);\n\t\t\t\t} else {\n\t\t\t\t\trgSizes = stream.getUint8Array(this.height);\n\t\t\t\t}\n\n\t\t\t\tconst offsetData = stream.position;\n\t\t\t\tlet cbData = 0;\n\n\t\t\t\tconst rgPixels: number[] = [];\n\n\t\t\t\tfor (let y = 0; y < this.height; ++y) {\n\t\t\t\t\tif (rgPixels.length !== this.width * y) {\n\t\t\t\t\t\tthrow new Error(\"corrupt image data\");\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let data = stream.getUint8(); data !== 0xe0; data = stream.getUint8()) {\n\t\t\t\t\t\tif ((data & 0xe0) === 0xe0) {\n\t\t\t\t\t\t\tlet count = data & ~0xe0;\n\t\t\t\t\t\t\tdata = stream.getUint8();\n\t\t\t\t\t\t\twhile (count--) {\n\t\t\t\t\t\t\t\trgPixels.push(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trgPixels.push(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcbData += rgSizes[y];\n\n\t\t\t\t\tif (offsetData + cbData !== stream.position) {\n\t\t\t\t\t\tthrow new Error(\"corrupt image data\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (rgPixels.length !== this.width * this.height) {\n\t\t\t\t\tthrow new Error(\"missing pixels\");\n\t\t\t\t}\n\n\t\t\t\tthis.data = new Uint8Array(rgPixels);\n\t\t\t} else {\n\t\t\t\tthis.data = new Uint8Array(stream.view.buffer, stream.view.byteOffset + stream.position, this.width * this.height);\n\t\t\t}\n\t\t}\n\n\t\treturn this.data;\n\t}\n\tgetPixel(x: number, y: number) {\n\t\tx = Math.mod(x, this.width);\n\t\ty = Math.mod(y, this.height);\n\n\t\tconst data = this.loadImage();\n\t\treturn this.data[x + y * this.width];\n\t}\n}\nclass Texture {\n\tconstructor(\n\t\tpublic tex: WebGLTexture,\n\t\tpublic bmp: BitmapHeader) {\n\t\t\t// do nothing\n\t}\n}\n\nenum TMapInfoFlags {\n\tVOLATILE = (1 << 0),\t  // this material blows up when hit\n\tWATER = (1 << 1),\t  // this material is water\n\tFORCE_FIELD = (1 << 2),\t  // this is force field - flares don't stick\n\tGOAL_BLUE = (1 << 3),\t  // this is used to remap the blue goal\n\tGOAL_RED = (1 << 4),\t  // this is used to remap the red goal\n\tGOAL_HOARD = (1 << 5),\t  // this is used to remap the goals\n}\nclass TMapInfo {\n\tflags: TMapInfoFlags;\n\tlighting: number;\n\tdamage: number;\n\teclip_num: number;\n\tdestroyed: number;\n\tslide_u: number;\n\tslide_v: number;\n\n\ttextureIndex: number;\n\n\tload(stream: DataStream) {\n\t\tthis.flags = stream.getUint8();\n\t\tstream.position += 3;\n\t\tthis.lighting = stream.getFixed();\n\t\tthis.damage = stream.getFixed();\n\t\tthis.eclip_num = stream.getInt16();\n\t\tthis.destroyed = stream.getInt16();\n\t\tthis.slide_u = stream.getFixed2();\n\t\tthis.slide_v = stream.getFixed2();\n\n\t\treturn this;\n\t}\n\tloadTexture(iUnit: number): Texture {\n\t\treturn _pig.loadBitmap(this.textureIndex, iUnit);\n\t}\n\tgetBitmapAsset() {\n\t\treturn _pig.getAsset(this.textureIndex);\n\t}\n\tisTransparent() {\n\t\tconst asset = this.getBitmapAsset();\n\t\treturn asset.isTransparent();\n\t}\n\tgetPixel(u: number, v: number): number {\n\t\tconst bmp = this.getBitmapAsset();\n\t\treturn bmp.getPixel(Math.floor(u * bmp.width), Math.floor(v * bmp.height));\n\t}\n}\nfunction isPowerOf2(x: number) { return 0 === (x & (x - 1)); }\n\nclass Pig {\n\tassets: BitmapHeader[];\n\t// mapAssetByName: object;\n\trgLoadedTextures: Texture[] = [];\n\n\tload(view: DataView) {\n\t\tconst pig = new DataStream(view);\n\n\t\tconst id = pig.getString(4);\n\t\tconst version = pig.getUint32();\n\n\t\tif (id !== \"PPIG\" || version !== 2) {\n\t\t\tthrow new Error(\"invalid PIG version: \" + id + \"/\" + version);\n\t\t}\n\n\t\tconst cBitmaps = pig.getUint32();\n\n\t\tconst rgBitmaps = Array_iterate(cBitmaps, () => new BitmapHeader().load(pig));\n\n\t\tconst dataStart = pig.position;\n\n\t\tconst mapAssetsByName: { [index: string]: any } = {};\n\n\t\tfor (let iBitmap = 0; iBitmap < cBitmaps; ++iBitmap) {\n\t\t\tconst bitmap = rgBitmaps[iBitmap];\n\t\t\tmapAssetsByName[bitmap.name] = bitmap;\n\t\t\tbitmap.offset += dataStart;\n\t\t}\n\n\t\tthis.assets = rgBitmaps;\n\t\t// this.mapAssetsByName = mapAssetsByName;\n\n\t\treturn this;\n\t}\n\tgetAsset(index: number) {\n\t\tindex--;\n\t\tif (index < 0 || index >= this.assets.length) {\n\t\t\tthrow new Error(\"bitmap index out of range: \" + index);\n\t\t}\n\n\t\treturn this.assets[index];\n\t}\n\n\tloadBitmap(iBitmap: number, iUnit: number): Texture {\n\t\tif (iBitmap === 0) {\n\t\t\tthrow new Error(\"missing bitmap\" + iBitmap);\n\t\t}\n\n\t\tlet texture = this.rgLoadedTextures[iBitmap];\n\t\tif (!texture) {\n\t\t\tconst bmp = this.getAsset(iBitmap);\n\n\t\t\tconst tex = createTexture(iUnit);\n\n\t\t\ttexture = this.rgLoadedTextures[iBitmap] = new Texture(tex, bmp);\n\n\t\t\tif (isPowerOf2(bmp.width) && isPowerOf2(bmp.height)) {\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\t\t\t} else {\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\t}\n\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, bmp.width, bmp.height, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, bmp.loadImage());\n\t\t\t// gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, bmp.width, bmp.height, 0, gl.RGB, gl.UNSIGNED_BYTE, data);\n\t\t}\n\t\treturn texture;\n\t}\n}\n","/// <areference path=\"DataView.ts\" />\n/// <areference path=\"DataStream.ts\" />\n\n/// <reference path=\"webgl.ts\" />\n/// <reference path=\"Item.ts\" />\n/// <reference path=\"Sound.ts\" />\n/// <reference path=\"Pig.ts\" />\n\"use strict\";\n\nconst VCLIP_MAX_FRAMES = 30;\n\nenum VClipFlags {\n\tROD = 1,       // draw as a rod, not a blob\n}\nclass VClip {\n\n\tplay_time: number;\n\tnum_frames: number;\n\tframe_time: number;\n\tflags: VClipFlags;\n\tsound_num: number;\n\tframes: number[];\n\tlight_value: number;\n\n\tload(stream: DataStream) {\n\t\tthis.play_time = stream.getFixed();\n\t\tthis.num_frames = stream.getInt32();\n\t\tthis.frame_time = stream.getFixed();\n\t\tthis.flags = stream.getInt32();\n\t\tthis.sound_num = stream.getInt16();\n\t\tthis.frames = stream.getInt16Array(VCLIP_MAX_FRAMES);\n\t\tthis.light_value = stream.getFixed();\n\n\t\treturn this;\n\t}\n}\nenum KnownVClips {\n\tSMALL_EXPLOSION = 2,\n\tPLAYER_HIT = 1,\n\tMORPHING_ROBOT = 10,\n\tPLAYER_APPEARANCE = 61,\n\tPOWERUP_DISAPPEARANCE = 62,\n\tVOLATILE_WALL_HIT = 5,\n\tWATER_HIT = 84,\n\tAFTERBURNER_BLOB = 95,\n\tMONITOR_STATIC = 99,\n\tHOSTAGE = 33,\n}\nenum EClipFlags {\n\tCRITICAL = (1 << 0),   // this doesn't get played directly (only when mine critical)\n\tONE_SHOT = (1 << 1),   // this is a special that gets played once\n\tSTOPPED = (1 << 2),   // this has been stopped\n}\nclass EClip extends VClip {\n\ttime_left: number;\n\tframe_count: number;\n\tchanging_wall_texture: number;\n\tchanging_object_texture: number;\n\teflags: EClipFlags;\n\tcrit_clip: number;\n\tdest_bm_num: number;\n\tdest_vclip: number;\n\tdest_eclip: number;\n\tdest_size: number;\n\tsound_num: number;\n\tsegnum: number;\n\tsidenum: number;\n\n\tload(stream: DataStream) {\n\t\tsuper.load(stream);\t// VClip\n\n\t\tthis.time_left = stream.getFixed();               /*for sequencing */\n\t\tthis.frame_count = stream.getInt32();             /*for sequencing */\n\t\tthis.changing_wall_texture = stream.getInt16();   /*Which element of Textures array to */\n\t\tthis.changing_object_texture = stream.getInt16(); /*Which element of ObjBitmapPtrs array */\n\t\tthis.eflags = stream.getInt32();\n\t\tthis.crit_clip = stream.getInt32();               /*use this clip instead of above one */\n\t\tthis.dest_bm_num = stream.getInt32();             /*use this bitmap when monitor destroyed */\n\t\tthis.dest_vclip = stream.getInt32();              /*what vclip to play when exploding */\n\t\tthis.dest_eclip = stream.getInt32();              /*what eclip to play when exploding */\n\t\tthis.dest_size = stream.getFixed();               /*3d size of explosion */\n\t\tthis.sound_num = stream.getInt32();               /*what sound this makes */\n\t\tthis.segnum = stream.getInt32();                  /*what seg & side, for one-shot clips */\n\t\tthis.sidenum = stream.getInt32();\n\n\t\treturn this;\n\t}\n\tget flagsQ() { return this.eflags; }\n\n\tupdate(frameTime: number) {\n\t\tif (this.eflags & EClipFlags.STOPPED) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.changing_wall_texture === -1 && this.changing_object_texture === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.time_left -= frameTime;\n\t\twhile (this.time_left < 0) {\n\t\t\tthis.time_left += this.frame_time;\n\n\t\t\tthis.frame_count++;\n\t\t\tif (this.frame_count >= this.num_frames) {\n\t\t\t\tif (this.eflags & EClipFlags.ONE_SHOT) {\n\t\t\t\t\t_level.getSide(this.segnum, this.sidenum).setTex2(this.dest_bm_num);\n\n\t\t\t\t\tthis.eflags = this.eflags & ~EClipFlags.ONE_SHOT | EClipFlags.STOPPED;\n\t\t\t\t\tthis.segnum = -1;\n\t\t\t\t}\n\t\t\t\tthis.frame_count = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (this.eflags & EClipFlags.CRITICAL) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO: control center destroyed\n\n\t\tif (this.changing_wall_texture !== -1) {\n\t\t\t// const asset = _pig.getAsset(this.frames[this.frame_count] + 1);\n\t\t\t// console.log(this.changing_wall_texture, asset.name);\n\t\t\tconst tmi = _ham.rgTMapInfos[this.changing_wall_texture];\n\t\t\ttmi.textureIndex = this.frames[this.frame_count];\n\t\t}\n\t}\n}\nconst MAX_CLIP_FRAMES = 50;\n\nenum WClipFlags {\n\tEXPLODES = (1 << 0),\t// door explodes when opening\n\tBLASTABLE = (1 << 1),\t// this is a blastable wall\n\tTMAP1 = (1 << 2),\t// this uses primary tmap, not tmap2\n\tHIDDEN = (1 << 3),\t// this uses primary tmap, not tmap2\n}\nclass WClip {\n\tplay_time: number;\n\tnum_frames: number;\n\tframes: number[];\n\topen_sound: number;\n\tclose_sound: number;\n\tflags: WClipFlags;\n\tfilename: string;\n\n\tload(stream: DataStream) {\n\t\tthis.play_time = stream.getFixed();\n\t\tthis.num_frames = stream.getInt16();\n\t\tthis.frames = stream.getInt16Array(MAX_CLIP_FRAMES);\n\t\tthis.open_sound = stream.getInt16();\n\t\tthis.close_sound = stream.getInt16();\n\t\tthis.flags = stream.getInt16();\n\t\tthis.filename = stream.getTerminatedString([\"\\0\", \"\\n\"], 13);\n\t\tstream.position++;\n\n\t\treturn this;\n\t}\n\tapply(side: Side, iFrame: number) {\n\t\t/*\n\t\tconst cFrames = this.num_frames;\n\t\tconst iFrame = Math.floor (cFrames * time / this.play_time);\n\t\tif (iFrame >= cFrames)\n\t\t\tiFrame = cFrames - 1;\n\t\t*/\n\n\t\tconst tex = this.frames[iFrame];\n\t\tconst otherSide = side.otherSide;\n\n\t\tif (this.flags & WClipFlags.TMAP1) {\n\t\t\tside.setTex1(tex);\n\t\t\tif (otherSide) {\n\t\t\t\totherSide.setTex1(tex);\n\t\t\t}\n\t\t} else {\n\t\t\tside.setTex2(tex, false);\n\t\t\tif (otherSide) {\n\t\t\t\totherSide.setTex2(tex, false);\n\t\t\t}\n\t\t}\n\t}\n}\nclass JointList {\n\tn_joints: number;\n\toffset: number;\n\n\tload(stream: DataStream) {\n\t\tthis.n_joints = stream.getInt16();\n\t\tthis.offset = stream.getInt16();\n\n\t\treturn this;\n\t}\n}\nconst MAX_GUNS = 8;\nconst NDL = 5;\t// # difficulty levels\nconst N_ANIM_STATES = 5;\t// # difficulty levels\n\nclass RobotType {\n\tmodel_num: number;\n\n\tgun_points: Vec3[];\n\tgun_submodels: number[];\n\n\texp1_vclip_num: number;\n\texp1_sound_num: number;\n\n\texp2_vclip_num: number;\n\texp2_sound_num: number;\n\n\tweapon_type: number;\n\tweapon_type2: number;\n\tn_guns: number;\n\tcontains_id: number;\n\n\tcontains_count: number;\n\tcontains_prob: number;\n\tcontains_type: number;\n\tkamikaze: number;\n\n\tscore_value: number;\n\tbadass: number;\n\tenergy_drain: number;\n\n\tlighting: number;\n\tstrength: number;\n\n\tmass: number;\n\tdrag: number;\n\n\tfield_of_view: number[];\n\tfiring_wait: number[];\n\tfiring_wait2: number[];\n\tturn_time: number[];\n\tmax_speed: number[];\n\tcircle_distance: number[];\n\n\trapidfire_count: number[];\n\tevade_speed: number[];\n\n\tcloak_type: number;\n\tattack_type: number;\n\n\tsee_sound: number;\n\tattack_sound: number;\n\tclaw_sound: number;\n\ttaunt_sound: number;\n\n\tboss_flag: number;\n\tcompanion: number;\n\tsmart_blobs: number;\n\tenergy_blobs: number;\n\n\tthief: number;\n\tpursuit: number;\n\tlightcast: number;\n\tdeath_roll: number;\n\n\tflags: number;\n\n\tdeathroll_sound: number;\n\tglow: number;\n\tbehavior: number;\n\taim: number;\n\n\tanim_states: JointList[];\n\n\tload(stream: DataStream) {\n\t\tthis.model_num = stream.getInt32();\n\n\t\tthis.gun_points = stream.getVectorArray(MAX_GUNS);\n\t\tthis.gun_submodels = stream.getUint8Array(MAX_GUNS);\n\n\t\tthis.exp1_vclip_num = stream.getInt16();\n\t\tthis.exp1_sound_num = stream.getInt16();\n\n\t\t// if (this.exp1_vclip_num !== -1)\n\t\t// \t$this.rgVClips.checkIndex(this.exp1_vclip_num);\n\t\t// console.assert(this.exp1_sound_num === -1 || this.exp1_sound_num >= 0 && this.exp1_sound_num < $this.cSounds);\n\n\t\tthis.exp2_vclip_num = stream.getInt16();\n\t\tthis.exp2_sound_num = stream.getInt16();\n\n\t\t// if (this.exp2_vclip_num !== -1)\n\t\t// \t$this.rgVClips.checkIndex(this.exp2_vclip_num);\n\t\t// console.assert(this.exp2_sound_num === -1 || this.exp2_sound_num >= 0 && this.exp2_sound_num < $this.cSounds);\n\n\t\tthis.weapon_type = stream.getUint8();\n\t\tthis.weapon_type2 = stream.getUint8();\n\t\tthis.n_guns = stream.getUint8();\n\t\tthis.contains_id = stream.getUint8();\n\n\t\tthis.contains_count = stream.getUint8();\n\t\tthis.contains_prob = stream.getUint8();\n\t\tthis.contains_type = stream.getUint8();\n\t\tthis.kamikaze = stream.getUint8();\n\n\t\tthis.score_value = stream.getInt16();\n\t\tthis.badass = stream.getUint8();\n\t\tthis.energy_drain = stream.getUint8();\n\n\t\tthis.lighting = stream.getFixed();\n\t\tthis.strength = stream.getFixed();\n\n\t\tthis.mass = stream.getFixed();\n\t\tthis.drag = stream.getFixed();\n\n\t\tthis.field_of_view = stream.getFixedArray(NDL);\n\t\tthis.firing_wait = stream.getFixedArray(NDL);\n\t\tthis.firing_wait2 = stream.getFixedArray(NDL);\n\t\tthis.turn_time = stream.getFixedArray(NDL);\n\t\tthis.max_speed = stream.getFixedArray(NDL);\n\t\tthis.circle_distance = stream.getFixedArray(NDL);\n\n\t\tthis.rapidfire_count = stream.getUint8Array(NDL);\n\t\tthis.evade_speed = stream.getUint8Array(NDL);\n\n\t\tthis.cloak_type = stream.getUint8();\n\t\tthis.attack_type = stream.getUint8();\n\n\t\tthis.see_sound = stream.getUint8();\n\t\tthis.attack_sound = stream.getUint8();\n\t\tthis.claw_sound = stream.getUint8();\n\t\tthis.taunt_sound = stream.getUint8();\n\n\t\tthis.boss_flag = stream.getUint8();\n\t\tthis.companion = stream.getUint8();\n\t\tthis.smart_blobs = stream.getUint8();\n\t\tthis.energy_blobs = stream.getUint8();\n\n\t\tthis.thief = stream.getUint8();\n\t\tthis.pursuit = stream.getUint8();\n\t\tthis.lightcast = stream.getUint8();\n\t\tthis.death_roll = stream.getUint8();\n\n\t\tthis.flags = stream.getUint8();\n\t\tstream.position += 3;\n\n\t\tthis.deathroll_sound = stream.getUint8();\n\t\tthis.glow = stream.getUint8();\n\t\tthis.behavior = stream.getUint8();\n\t\tthis.aim = stream.getUint8();\n\n\t\tthis.anim_states = Array_iterate(MAX_GUNS + 1, () => {\n\t\t\treturn Array_iterate(N_ANIM_STATES, () => new JointList().load(stream));\n\t\t});\n\n\t\tconst always_0xabcd = stream.getUint32();\n\t\t// if (always_0xabcd !== 0xabcd)\n\t\t// \tthrow new Error(\"corrupted file\");\n\n\t\treturn this;\n\t}\n}\nclass RobotJoint {\n\tjointnum: number;\n\tangles: Vec3;\n\n\tload(stream: DataStream) {\n\t\tthis.jointnum = stream.getInt16();\n\t\tthis.angles = stream.getVector2();\n\n\t\treturn this;\n\t}\n}\nclass Ham {\n\trgTMapInfos: TMapInfo[];\n\trgSounds: number[];\n\trgVClips: VClip[];\n\trgEClips: EClip[];\n\trgWClips: WClip[];\n\trgWeaponInfos: WeaponInfo[];\n\trgPowerupInfos: PowerupInfo[];\n\trgPolygonModels: PolygonModel[];\n\trgRobotTypes: RobotType[];\n\n\trgObjBitmaps: number[];\n\trgObjBitmapPtrs: number[];\n\ttextureIndices: number[];\n\trgSoundFiles: SoundFile[];\n\n\tship: PlayerShip;\n\n\tload(view: DataView) {\n\t\tconst stream = new DataStream(view);\n\n\t\tconst sig = stream.getString(4);\n\t\tif (sig !== \"HAM!\") {\n\t\t\tthrow new Error(\"invalid HAM signature: \" + sig);\n\t\t}\n\n\t\tconst version = stream.getUint32();\n\t\tif (version < 1 || version > 2) {\n\t\t\tthrow new Error(\"unsupported HAM version: \" + version);\n\t\t}\n\n\t\tlet sound_offset = 0;\n\t\tif (version < 3) {\n\t\t\tsound_offset = stream.getUint32();\n\t\t}\n\n\t\tconst cTextures = stream.getUint32();\n\t\tconst textureIndices = this.textureIndices = stream.getInt16Array(cTextures);\n\t\tthis.rgTMapInfos = Array_iterate(cTextures, (iTexture) => {\n\t\t\tconst tmi = new TMapInfo().load(stream);\n\t\t\ttmi.textureIndex = textureIndices[iTexture];\n\t\t\treturn tmi;\n\t\t});\n\n\t\t/*\n\t\tconst rgTMapInfos = [];\n\t\tthis.textureIndices.forEach((i) => { rgTMapInfos[i] = new TMapInfo().load(stream); });\n\t\tthis.rgTMapInfos = rgTMapInfos;\n\t\t*/\n\n\t\tconst cSounds = stream.getUint32();\n\t\tthis.rgSounds = stream.getUint8Array(cSounds);\n\t\tconst rgAltSounds = stream.getUint8Array(cSounds);\n\n\t\tconst $this = this;\n\n\t\tconst cVClips = stream.getUint32();\n\t\tthis.rgVClips = Array_iterate(cVClips, () => new VClip().load(stream));\n\n\t\tthis.rgVClips[KnownVClips.HOSTAGE].flags |= VClipFlags.ROD;\n\n\t\tconst cEClips = stream.getUint32();\n\t\tthis.rgEClips = Array_iterate(cEClips, () => new EClip().load(stream));\n\n\t\tconst cWClips = stream.getUint32();\n\t\tthis.rgWClips = Array_iterate(cWClips, () => new WClip().load(stream));\n\n\t\tconst cRobotTypes = stream.getUint32();\n\t\tthis.rgRobotTypes = Array_iterate(cRobotTypes, () => new RobotType().load(stream));\n\n\t\tconst cRobotJoints = stream.getUint32();\n\t\tconst rgRobotJoints = Array_iterate(cRobotJoints, () => new RobotJoint().load(stream));\n\n\t\tconst cWeaponInfos = stream.getUint32();\n\t\tthis.rgWeaponInfos = Array_iterate(cWeaponInfos, (iWeapon) => new WeaponInfo().load(stream, version, iWeapon));\n\n\t\tconst cPowerupInfos = stream.getUint32();\n\t\tthis.rgPowerupInfos = Array_iterate(cPowerupInfos, () => new PowerupInfo().load(stream));\n\n\t\tconst cPolygonModels = stream.getUint32();\n\t\tthis.rgPolygonModels = Array_iterate(cPolygonModels, () => new PolygonModel().load(stream));\n\n\t\tfor (let iPolygonModel = 0; iPolygonModel < cPolygonModels; ++iPolygonModel) {\n\t\t\tthis.rgPolygonModels[iPolygonModel].loadData(stream);\n\t\t}\n\n\t\tfor (let iPolygonModel = 0; iPolygonModel < cPolygonModels; ++iPolygonModel) {\n\t\t\tthis.rgPolygonModels[iPolygonModel].Dying_modelnum = stream.getInt32();\n\t\t}\n\n\t\tfor (let iPolygonModel = 0; iPolygonModel < cPolygonModels; ++iPolygonModel) {\n\t\t\tthis.rgPolygonModels[iPolygonModel].Dead_modelnum = stream.getInt32();\n\t\t}\n\n\t\tconst cGuages = stream.getInt32();\n\t\tconst rgGuages = stream.getInt16Array(cGuages);\n\t\tconst rgGuagesHiRes = stream.getInt16Array(cGuages);\n\n\t\tconst cObjBitmaps = stream.getInt32();\n\t\tthis.rgObjBitmaps = stream.getInt16Array(cObjBitmaps);\n\t\tthis.rgObjBitmapPtrs = stream.getInt16Array(cObjBitmaps);\n\n\t\tthis.ship = new PlayerShip().load(stream);\n\n\t\t// cockpits\n\t\t// reactors\n\t\t// exit model\n\n\t\tif (version < 3) {\n\t\t\tstream.position = sound_offset;\n\n\t\t\tconst cSounds = stream.getUint32();\n\n\t\t\tthis.rgSoundFiles = Array_iterate(cSounds, () => new SoundFile().load(stream));\n\n\t\t\tconst sound_start = stream.position;\n\t\t\tfor (let iSound = this.rgSoundFiles.length; iSound--;) {\n\t\t\t\tconst sf = this.rgSoundFiles[iSound];\n\t\t\t\tsf.index = iSound;\n\t\t\t\tconst ibStart = sound_start + sf.offset;\n\t\t\t\tsf.data = new Uint8Array(view, ibStart, sf.length);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\tplayObjectSound(iSound: SoundFile_Sounds, obj: Item) {\n\t\tconst iSoundFile = this.rgSounds[iSound];\n\t\tconst sf = this.rgSoundFiles[iSoundFile];\n\t\tif (sf) {\n\t\t\treturn sf.playObjectSound(obj);\n\t\t}\n\t}\n\tplaySound(iSound: SoundFile_Sounds, pos?: Vec3) {\n\t\tconst iSoundFile = this.rgSounds[iSound];\n\t\tconst sf = this.rgSoundFiles[iSoundFile];\n\t\tif (sf) {\n\t\t\treturn sf.playSound(pos);\n\t\t}\n\t}\n\tupdateEffects(frameTime: number) {\n\t\tconst rgEffects = this.rgEClips;\n\t\tfor (let iEffect = rgEffects.length; iEffect--;) {\n\t\t\tconst effect = rgEffects[iEffect];\n\t\t\teffect.update(frameTime);\n\t\t}\n\t}\n}\nconst MAX_LASER_LEVEL = 3;   // Note, laser levels are numbered from 0.\nconst MAX_SUPER_LASER_LEVEL = 5;   // Note, laser levels are numbered from 0.\n\nenum WeaponTypes {\n\tLASER = 0,\t  // 0..3 are lasers\n\tCONCUSSION = 8,\n\tFLARE = 9,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tVULCAN = 11,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tSPREADFIRE = 12,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tPLASMA = 13,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tFUSION = 14,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tHOMING = 15,\n\tPROXIMITY = 16,\n\tSMART = 17,\n\tMEGA = 18,\n\n\tPLAYER_SMART_HOMING = 19,\n\tSUPER_MECH_MISS = 21,\n\tREGULAR_MECH_MISS = 22,\n\tSILENT_SPREADFIRE = 23,\n\tROBOT_SMART_HOMING = 29,\n\tEARTHSHAKER_MEGA = 54,\n\n\tSUPER_LASER = 30,\t  // 30,31 are super lasers (level 5,6)\n\n\tGAUSS = 32,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tHELIX = 33,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tPHOENIX = 34,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\tOMEGA = 35,\t  //  NOTE                            This MUST correspond to the ID generated at bitmaps.tbl read time.\n\n\tFLASH = 36,\n\tGUIDEDMISS = 37,\n\tSUPERPROX = 38,\n\tMERCURY = 39,\n\tEARTHSHAKER = 40,\n\n\tSMART_MINE_HOMING = 47,\n\tROBOT_SMART_MINE_HOMING = 49,\n\tROBOT_SUPERPROX = 53,\n\tROBOT_EARTHSHAKER = 58,\n\n\tPMINE = 51,\t// the mine that the designers can place\n}\nenum WeaponRenderTypes {\n\tNONE = -1,\n\tLASER = 0,\n\tBLOB = 1,\n\tPOLYMODEL = 2,\n\tVCLIP = 3,\n}\nclass WeaponInfo {\n\tindex: WeaponTypes;\n\n\trender_type: WeaponRenderTypes;\n\tpersistent: number;\n\tmodel_num: number;\n\tmodel_num_inner: number;\n\n\tflash_vclip: number;\n\trobot_hit_vclip: number;\n\tflash_sound: number;\n\n\twall_hit_vclip: number;\n\tfire_count: number;\n\trobot_hit_sound: number;\n\n\tammo_usage: number;\n\tweapon_vclip: number;\n\twall_hit_sound: number;\n\n\tdestroyable: number;\n\tmatter: number;\n\tbounce: number;\n\thoming_flag: number;\n\n\tspeedvar: number;\n\tflags: number;\n\tflash: number;\n\tafterburner_size: number;\n\n\tenergy_usage: number;\n\tfire_wait: number;\n\n\tmulti_damage_scale: number;\n\n\tbitmap: number;\n\n\tblob_size: number;\n\tflash_size: number;\n\timpact_size: number;\n\tstrength: number[];\n\tspeed: number[];\n\tmass: number;\n\tdrag: number;\n\tthrust: number;\n\tpo_len_to_width_ratio: number;\n\tlight: number;\n\tlifetime: number;\n\tdamage_radius: number;\n\tpicture: number;\n\thires_picture: number;\n\n\tchildren: number;\n\n\tload(stream: DataStream, file_version: number, iWeapon: number) {\n\t\tthis.index = iWeapon;\n\n\t\tthis.render_type = stream.getUint8();\n\t\tthis.persistent = stream.getUint8();\n\t\tthis.model_num = stream.getInt16();\n\t\tthis.model_num_inner = stream.getInt16();\n\n\t\tthis.flash_vclip = stream.getUint8();\n\t\tthis.robot_hit_vclip = stream.getUint8();\n\t\tthis.flash_sound = stream.getInt16();\n\n\t\tthis.wall_hit_vclip = stream.getUint8();\n\t\tthis.fire_count = stream.getUint8();\n\t\tthis.robot_hit_sound = stream.getInt16();\n\n\t\tthis.ammo_usage = stream.getUint8();\n\t\tthis.weapon_vclip = stream.getUint8();\n\t\tthis.wall_hit_sound = stream.getInt16();\n\n\t\tthis.destroyable = stream.getUint8();\n\t\tthis.matter = stream.getUint8();\n\t\tthis.bounce = stream.getUint8();\n\t\tthis.homing_flag = stream.getUint8();\n\n\t\tthis.speedvar = stream.getUint8();\n\t\tthis.flags = stream.getUint8();\n\t\tthis.flash = stream.getUint8();\n\t\tthis.afterburner_size = stream.getUint8();\n\n\t\tif (file_version >= 3) {\n\t\t\tthis.children = stream.getUint8();\n\t\t} else {\n\t\t\tswitch (iWeapon) {\n\t\t\t\tcase WeaponTypes.SMART:\n\t\t\t\t\tthis.children = WeaponTypes.PLAYER_SMART_HOMING;\n\t\t\t\t\tbreak;\n\t\t\t\tcase WeaponTypes.SUPERPROX:\n\t\t\t\t\tthis.children = WeaponTypes.SMART_MINE_HOMING;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.children = -1;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.energy_usage = stream.getFixed();\n\t\tthis.fire_wait = stream.getFixed();\n\n\t\tif (file_version >= 3) {\n\t\t\tthis.multi_damage_scale = stream.getFixed();\n\t\t} else {\n\t\t\tthis.multi_damage_scale = 1;\n\t\t}\n\n\t\tthis.bitmap = stream.getInt16();\n\n\t\tthis.blob_size = stream.getFixed();\n\t\tthis.flash_size = stream.getFixed();\n\t\tthis.impact_size = stream.getFixed();\n\t\tthis.strength = stream.getFixedArray(NDL);\n\t\tthis.speed = stream.getFixedArray(NDL);\n\t\tthis.mass = stream.getFixed();\n\t\tthis.drag = stream.getFixed();\n\t\tthis.thrust = stream.getFixed();\n\t\tthis.po_len_to_width_ratio = stream.getFixed();\n\t\tthis.light = stream.getFixed();\n\t\tthis.lifetime = stream.getFixed();\n\t\tthis.damage_radius = stream.getFixed();\n\t\tthis.picture = stream.getInt16();\n\n\t\tif (file_version >= 3) {\n\t\t\tthis.hires_picture = stream.getInt16();\n\t\t} else {\n\t\t\tthis.hires_picture = this.picture;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tcreateObject(parent: Item, pos: Vec3, cube: Cube, dir: Vec3) {\n\t\tconst obj = new Item(ItemTypes.WEAPON, this.index);\n\n\t\t// const parent = _level.rgObjects[0];\n\t\t// orient = Mat3.createLook(parent.orient._[2], parent.orient._[1]);\n\n\t\tobj.link(cube);\n\n\t\tobj.pos = pos;\n\t\tobj.size = this.blob_size || 1;\n\t\tobj.flags = 0;\n\t\tobj.parent = parent;\n\t\tif (parent) {\n\t\t\tobj.orient = Mat3.createLook(dir, parent.orient._[1]);\n\t\t} else {\n\t\t\tthrow new Error(\"asdasd\");\n\t\t}// obj.orient = Mat3.I;\n\n\t\tobj.controlType = ControlTypes.WEAPON;\n\t\tobj.movementType = MovementTypes.PHYSICS;\n\n\t\tconst pi = new PhysicsInfo();\n\t\tpi.mass = this.mass;\n\t\tpi.drag = this.drag;\n\n\t\tif (this.bounce) {\n\t\t\tpi.flags |= PhysicsFlags.BOUNCE;\n\t\t\tif (this.bounce === 2) {\n\t\t\t\tpi.flags |= PhysicsFlags.BOUNCES_TWICE;\n\t\t\t}\n\t\t}\n\n\t\tlet speed = this.speed[_difficultyLevel];\n\t\tif (this.speedvar !== 128) {\n\t\t\tspeed *= (1 - (this.speedvar * Math.random() / 64));\n\t\t}\n\n\t\tif (this.thrust !== 0) {\n\t\t\tspeed /= 2;\n\t\t}\n\n\t\tpi.velocity = dir.scale(speed);\n\n\t\tlet size = this.blob_size;\n\t\tlet rtype: RenderTypes;\n\t\tswitch (this.render_type) {\n\t\t\tcase WeaponRenderTypes.BLOB:\n\t\t\t\trtype = RenderTypes.LASER;\n\t\t\t\tbreak;\n\t\t\tcase WeaponRenderTypes.POLYMODEL:\n\t\t\t\trtype = RenderTypes.POLYOBJ;\n\t\t\t\tobj.renderInfo = new PolygonRenderInfo(this.model_num);\n\t\t\t\tsize = _ham.rgPolygonModels[this.model_num].rad / this.po_len_to_width_ratio;\n\t\t\t\tbreak;\n\t\t\tcase WeaponRenderTypes.NONE:\n\t\t\t\trtype = RenderTypes.NONE;\n\t\t\t\tsize = 1;\n\t\t\t\tbreak;\n\t\t\tcase WeaponRenderTypes.VCLIP:\n\t\t\t\trtype = RenderTypes.WEAPON_VCLIP;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"invalid weapon render type\");\n\t\t}\n\n\t\tobj.renderType = rtype;\n\t\tobj.size = size;\n\t\tobj.shields = this.strength[_difficultyLevel];\n\t\tobj.multiplier = 1;\n\t\tobj.weaponInfo = this;\n\t\tobj.mover = pi;\n\n\t\treturn obj;\n\t}\n\n}\nclass PowerupInfo {\n\tvclip_num: number;\n\thit_sound: number;\n\tsize: number;\n\tlight: number;\n\n\tload(stream: DataStream) {\n\t\tthis.vclip_num = stream.getInt32();\n\t\tthis.hit_sound = stream.getInt32();\n\t\tthis.size = stream.getFixed();\n\t\tthis.light = stream.getFixed();\n\n\t\treturn this;\n\t}\n}\nconst MAX_SUBMODELS = 10;\n\nenum OpCodes {\n\tEOF = 0,   // eof\n\tDEFPOINTS = 1,   // defpoints\n\tFLATPOLY = 2,   // flat-shaded polygon\n\tTMAPPOLY = 3,   // texture-mapped polygon\n\tSORTNORM = 4,   // sort by normal\n\tRODBM = 5,   // rod bitmap\n\tSUBCALL = 6,   // call a subobject\n\tDEFP_START = 7,   // defpoints with start\n\tGLOW = 8,   // glow value for next poly\n}\nclass PolygonModel {\n\tn_models: number;\n\tmodel_data_size: number;\n\n\tsubmodel_ptrs: number[];\n\tsubmodel_offsets: Vec3[];\n\tsubmodel_norms: Vec3[];\n\tsubmodel_pnts: Vec3[];\n\tsubmodel_rads: number[];\n\tsubmodel_parents: number[];\n\tsubmodel_mins: Vec3[];\n\tsubmodel_maxs: Vec3[];\n\n\tmins: Vec3;\n\tmaxs: Vec3;\n\n\trad: number;\n\tn_textures: number;\n\tfirst_texture: number;\n\tsimpler_model: number;\n\n\tmodel_data: DataStream;\n\n\trgInstructions: Array<(light: any, anim_angles: any) => void>;\n\n\tbufferFlatVertexPosition: WebGLBuffer;\n\tbufferFlatVertexColor: WebGLBuffer;\n\tbufferVertexPosition: WebGLBuffer;\n\tbufferVertexTextureCoord: WebGLBuffer;\n\n\tDying_modelnum: number;\n\tDead_modelnum: number;\n\n\tload(stream: DataStream) {\n\t\tthis.n_models = stream.getInt32();\n\t\tif (this.n_models < 0) {\n\t\t\tthrow new Error(\"invalid count\");\n\t\t}\n\n\t\tthis.model_data_size = stream.getInt32();\n\t\tif (this.model_data_size < 0) {\n\t\t\tthrow new Error(\"invalid size\");\n\t\t}\n\n\t\tstream.getInt32();\t// bogus model_data\n\n\t\tthis.submodel_ptrs = stream.getInt32Array(MAX_SUBMODELS);\n\t\tthis.submodel_offsets = stream.getVectorArray(MAX_SUBMODELS);\n\t\tthis.submodel_norms = stream.getVectorArray(MAX_SUBMODELS);\n\t\tthis.submodel_pnts = stream.getVectorArray(MAX_SUBMODELS);\n\t\tthis.submodel_rads = stream.getFixedArray(MAX_SUBMODELS);\n\t\tthis.submodel_parents = stream.getUint8Array(MAX_SUBMODELS);\n\t\tthis.submodel_mins = stream.getVectorArray(MAX_SUBMODELS);\n\t\tthis.submodel_maxs = stream.getVectorArray(MAX_SUBMODELS);\n\n\t\tthis.mins = stream.getVector();\n\t\tthis.maxs = stream.getVector();\n\n\t\tthis.rad = stream.getFixed();\n\t\tthis.n_textures = stream.getUint8();\n\t\tthis.first_texture = stream.getInt16();\n\t\tthis.simpler_model = stream.getUint8();\n\n\t\treturn this;\n\t}\n\tloadData(stream: DataStream) {\n\t\tthis.model_data = new DataStream(stream.view.slice(stream.position, this.model_data_size));\n\t\tstream.position += this.model_data_size;\n\t}\n\trender(light: Vec3, anim_angles: Vec3[]) {\n\t\tif (!this.rgInstructions) {\n\t\t\tconst compile = (position: number) => {\n\t\t\t\tlet rgInstructions: Array<(light: Vec3, anim_angles: Vec3[]) => void> = [];\n\n\t\t\t\tconst oldPos = data.position;\n\t\t\t\tdata.position = position;\n\n\t\t\t\twhile (true) {\n\t\t\t\t\tconst pc = data.position;\n\t\t\t\t\tlet op: number;\n\t\t\t\t\tswitch (op = data.getUint16()) {\n\t\t\t\t\t\tcase OpCodes.EOF:\n\t\t\t\t\t\t\t// case OpCodes.GLOW:\n\t\t\t\t\t\t\tdata.position = oldPos;\n\t\t\t\t\t\t\treturn rgInstructions;\n\n\t\t\t\t\t\tcase OpCodes.DEFP_START:\n\t\t\t\t\t\t\tlet n = data.getUint16();\n\t\t\t\t\t\t\tlet s = data.getUint16();\n\t\t\t\t\t\t\tdata.position += 2;\n\t\t\t\t\t\t\twhile (n-- > 0) {\n\t\t\t\t\t\t\t\trgPoints[s++] = data.getVector();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase OpCodes.SORTNORM:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdata.position += 2;\n\t\t\t\t\t\t\t\tconst plane = new Plane3(data.getVector(), data.getVector());\n\t\t\t\t\t\t\t\tconst addr1 = data.getInt16();\n\t\t\t\t\t\t\t\tconst addr2 = data.getInt16();\n\n\t\t\t\t\t\t\t\tconst sub1 = compile(pc + addr1);\n\t\t\t\t\t\t\t\tconst sub2 = compile(pc + addr2);\n\n\t\t\t\t\t\t\t\trgInstructions = rgInstructions.concat(sub1);\n\t\t\t\t\t\t\t\trgInstructions = rgInstructions.concat(sub2);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase OpCodes.SUBCALL:\n\t\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t\tconst iAngle = data.getUint16();\n\n\t\t\t\t\t\t\t\tconst pos = data.getVector();\n\n\t\t\t\t\t\t\t\tconst addr = data.getInt16();\n\t\t\t\t\t\t\t\tconst sub = compile(pc + addr);\n\n\t\t\t\t\t\t\t\trgInstructions.push(((iAngle: number, pos: Vec3, rgInstructions: Array<(light: Vec3, anim_angles: Vec3[]) => void>) => {\n\t\t\t\t\t\t\t\t\treturn (light: Vec3, anim_angles: Vec3[]) => {\n\t\t\t\t\t\t\t\t\t\tconst angles = anim_angles ? anim_angles[iAngle] : null;\n\t\t\t\t\t\t\t\t\t\tconst mat = createAngleMatrix(angles, pos);\n\n\t\t\t\t\t\t\t\t\t\tif (mat) {\n\t\t\t\t\t\t\t\t\t\t\tpushInstanceMatrix(mat);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tconst cInstructions = rgInstructions.length;\n\t\t\t\t\t\t\t\t\t\tfor (let i = 0; i < cInstructions; ++i) {\n\t\t\t\t\t\t\t\t\t\t\trgInstructions[i](light, anim_angles);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (mat) {\n\t\t\t\t\t\t\t\t\t\t\tpopMatrix();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t})(iAngle, pos, sub));\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tcase OpCodes.TMAPPOLY:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst nv = data.getUint16();\n\t\t\t\t\t\t\t\tconst plane = new Plane3(data.getVector(), data.getVector());\n\n\t\t\t\t\t\t\t\tdata.position = pc + 28;\n\n\t\t\t\t\t\t\t\tconst objBitmap = _ham.rgObjBitmaps[_ham.rgObjBitmapPtrs[$this.first_texture + data.getUint16()]];\n\n\t\t\t\t\t\t\t\tconst offset = rgVertexPosition.length / 3;\n\n\t\t\t\t\t\t\t\tfor (let i = 0; i < nv; ++i) {\n\t\t\t\t\t\t\t\t\tconst pos = rgPoints[data.getUint16()];\n\t\t\t\t\t\t\t\t\trgVertexPosition.push(pos.x, pos.y, pos.z);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdata.position = pc + 30 + ((nv & ~1) + 1) * 2;\n\n\t\t\t\t\t\t\t\tfor (let i = 0; i < nv; ++i) {\n\t\t\t\t\t\t\t\t\tconst uvl = data.getVector();\n\t\t\t\t\t\t\t\t\trgVertexTextureCoord.push(uvl.x, uvl.y);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdata.position = ((data.position - 1) & ~3) + 4;\n\n\t\t\t\t\t\t\t\tdata.position = pc + 30 + ((nv & ~1) + 1) * 2 + nv * 12;\n\n\t\t\t\t\t\t\t\trgInstructions.push(((plane: Plane3, objBitmap: number, offset: number, nv: number) => {\n\t\t\t\t\t\t\t\t\tconst tex = _pig.loadBitmap(objBitmap, 1).tex;\n\n\t\t\t\t\t\t\t\t\treturn (light: Vec3, anim_angles: Vec3[]) => {\n\t\t\t\t\t\t\t\t\t\t// TODO check normal\n\n\t\t\t\t\t\t\t\t\t\tuseProgram(programLit);\n\t\t\t\t\t\t\t\t\t\tloadAttribBuffer(programLit.aVertexPosition, this.bufferVertexPosition);\n\t\t\t\t\t\t\t\t\t\tloadAttribBuffer(programLit.aVertexTextureCoord, this.bufferVertexTextureCoord);\n\n\t\t\t\t\t\t\t\t\t\tbindTexture(1, tex);\n\t\t\t\t\t\t\t\t\t\tgl.drawArrays(gl.TRIANGLE_FAN, offset, nv);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t})(plane, objBitmap, offset, nv));\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase OpCodes.FLATPOLY:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst nv = data.getUint16();\n\t\t\t\t\t\t\t\tconst plane = new Plane3(data.getVector(), data.getVector());\n\n\t\t\t\t\t\t\t\tdata.position = pc + 28;\n\n\t\t\t\t\t\t\t\tconst color = data.getColor15();\n\n\t\t\t\t\t\t\t\tconst offset = rgFlatVertexPosition.length / 3;\n\n\t\t\t\t\t\t\t\tfor (let i = 0; i < nv; ++i) {\n\t\t\t\t\t\t\t\t\tconst pos = rgPoints[data.getUint16()];\n\t\t\t\t\t\t\t\t\tpos.pushTo(rgFlatVertexPosition);\n\t\t\t\t\t\t\t\t\tcolor.pushTo(rgFlatVertexColor);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdata.position = pc + 30 + ((nv & ~1) + 1) * 2;\n\n\t\t\t\t\t\t\t\trgInstructions.push(((plane: Plane3, offset: number, nv: number) => {\n\t\t\t\t\t\t\t\t\treturn (light: Vec3, anim_angles: Vec3[]): void => {\n\t\t\t\t\t\t\t\t\t\t// TODO check normal\n\n\t\t\t\t\t\t\t\t\t\tuseProgram(programFlat);\n\t\t\t\t\t\t\t\t\t\tloadAttribBuffer(programFlat.aVertexPosition, this.bufferFlatVertexPosition);\n\t\t\t\t\t\t\t\t\t\tloadAttribBuffer(programFlat.aVertexColor, this.bufferFlatVertexColor);\n\n\t\t\t\t\t\t\t\t\t\tgl.drawArrays(gl.TRIANGLE_FAN, offset, nv);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t})(plane, offset, nv));\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new Error(\"unknown OpCode: \" + op);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst data = this.model_data;\n\t\t\tconst rgPoints: Vec3[] = [];\n\t\t\tconst rgFlatVertexPosition: number[] = [];\n\t\t\tconst rgFlatVertexColor: number[] = [];\n\n\t\t\tconst rgVertexPosition: number[] = [];\n\t\t\tconst rgVertexTextureCoord: number[] = [];\n\n\t\t\tconst $this = this;\n\t\t\tthis.rgInstructions = compile(0);\n\n\t\t\tif (rgFlatVertexPosition.length) {\n\t\t\t\tthis.bufferFlatVertexPosition = createBuffer(rgFlatVertexPosition, 3);\n\t\t\t\tthis.bufferFlatVertexColor = createBuffer(rgFlatVertexColor, 3);\n\t\t\t}\n\n\t\t\tif (rgVertexPosition.length) {\n\t\t\t\tthis.bufferVertexPosition = createBuffer(rgVertexPosition, 3);\n\t\t\t\tthis.bufferVertexTextureCoord = createBuffer(rgVertexTextureCoord, 2);\n\t\t\t}\n\t\t}\n\n\t\tuseProgram(programLit);\n\t\tgl.uniform3f(programLit.light, light.x, light.y, light.z);\n\t\tuseProgram(programFlat);\n\t\tgl.uniform3f(programFlat.light, light.x, light.y, light.z);\n\n\t\tconst rgInstructions = this.rgInstructions;\n\t\tconst cInstructions = rgInstructions.length;\n\t\tfor (let i = 0; i < cInstructions; ++i) {\n\t\t\trgInstructions[i](light, anim_angles);\n\t\t}\n\t}\n}\nconst N_PLAYER_GUNS = 8;\n\nclass PlayerShip {\n\tmodel_num: number;\n\texpl_vclip_num: number;\n\tmass: number;\n\tdrag: number;\n\tmax_thrust: number;\n\treverse_thrust: number;\n\tbrakes: number;\n\twiggle: number;\n\tmax_rotthrust: number;\n\tgun_points: Vec3[];\n\n\tload(stream: DataStream) {\n\t\tthis.model_num = stream.getInt32();\n\t\tthis.expl_vclip_num = stream.getInt32();\n\t\tthis.mass = stream.getFixed();\n\t\tthis.drag = stream.getFixed();\n\t\tthis.max_thrust = stream.getFixed();\n\t\tthis.reverse_thrust = stream.getFixed();\n\t\tthis.brakes = stream.getFixed();\n\t\tthis.wiggle = stream.getFixed();\n\t\tthis.max_rotthrust = stream.getFixed();\n\t\tthis.gun_points = stream.getVectorArray(N_PLAYER_GUNS);\n\n\t\treturn this;\n\t}\n}\nlet _ham: Ham;\n","enum PowerupTypes {\n\tEXTRA_LIFE = 0,\n\tENERGY = 1,\n\tSHIELD_BOOST = 2,\n\tLASER = 3,\n\n\tKEY_BLUE = 4,\n\tKEY_RED = 5,\n\tKEY_GOLD = 6,\n\n\tMISSILE_1 = 10,\n\tMISSILE_4 = 11,      // 4-pack MUST follow single missile\n\n\tQUAD_FIRE = 12,\n\n\tVULCAN_WEAPON = 13,\n\tSPREADFIRE_WEAPON = 14,\n\tPLASMA_WEAPON = 15,\n\tFUSION_WEAPON = 16,\n\tPROXIMITY_WEAPON = 17,\n\tSMARTBOMB_WEAPON = 20,\n\tMEGA_WEAPON = 21,\n\tVULCAN_AMMO = 22,\n\tHOMING_AMMO_1 = 18,\n\tHOMING_AMMO_4 = 19,      // 4-pack MUST follow single missile\n\tCLOAK = 23,\n\tTURBO = 24,\n\tINVULNERABILITY = 25,\n\tMEGAWOW = 27,\n\n\tGAUSS_WEAPON = 28,\n\tHELIX_WEAPON = 29,\n\tPHOENIX_WEAPON = 30,\n\tOMEGA_WEAPON = 31,\n\n\tSUPER_LASER = 32,\n\tFULL_MAP = 33,\n\tCONVERTER = 34,\n\tAMMO_RACK = 35,\n\tAFTERBURNER = 36,\n\tHEADLIGHT = 37,\n\n\tSMISSILE1_1 = 38,\n\tSMISSILE1_4 = 39,      // 4-pack MUST follow single missile\n\tGUIDED_MISSILE_1 = 40,\n\tGUIDED_MISSILE_4 = 41,      // 4-pack MUST follow single missile\n\tSMART_MINE = 42,\n\tMERCURY_MISSILE_1 = 43,\n\tMERCURY_MISSILE_4 = 44,      // 4-pack MUST follow single missile\n\tEARTHSHAKER_MISSILE = 45,\n\n\tFLAG_BLUE = 46,\n\tFLAG_RED = 47,\n\n\tHOARD_ORB = 7,       // use unused slot\n}\n","/// <reference path=\"DataView.ts\" />\n/// <reference path=\"DataStream.ts\" />\n\n/// <reference path=\"Math.ts\" />\n/// <reference path=\"webgl.ts\" />\n/// <reference path=\"PowerupTypes.ts\" />\n\"use strict\";\n\nconst MAX_ENERGY = 200;\nconst MAX_SHIELDS = 200;\n\nconst VULCAN_AMMO_MAX = (392 * 4);\nconst VULCAN_WEAPON_AMMO_AMOUNT = 196;\nconst VULCAN_AMMO_AMOUNT = (49 * 2);\nconst GAUSS_WEAPON_AMMO_AMOUNT = 392;\n\nconst _difficultyLevel = 0;\n\nenum PlayerFlags {\n\tINVULNERABLE = (1 << 0),\t// Player is invincible\n\tBLUE_KEY     = (1 << 1),\t// Player has blue key\n\tRED_KEY      = (1 << 2),\t// Player has red key\n\tGOLD_KEY     = (1 << 3),\t// Player has gold key\n\tFLAG         = (1 << 4),\t// Player has his team's flag\n\tUNUSED       = (1 << 5),\t//\n\tMAP_ALL      = (1 << 6),\t// Player can see unvisited areas on map\n\tAMMO_RACK    = (1 << 7),\t// Player has ammo rack\n\tCONVERTER    = (1 << 8),\t// Player has energy->shield converter\n\tQUAD_LASERS  = (1 << 9),\t// Player shoots 4 at once\n\tCLOAKED      = (1 << 10),\t// Player is cloaked for awhile\n\tAFTERBURNER  = (1 << 11),\t// Player's afterburner is engaged\n\tHEADLIGHT    = (1 << 12),\t// Player has headlight boost\n\tHEADLIGHT_ON = (1 << 13),\t// is headlight on or off?\n}\nclass Player {\n\n\tstatic secondary_ammo_max = [20, 10, 10, 5, 5, 20, 20, 15, 10, 10];\n\n\tscore: number;\n\tlives: number;\n\tlevel: number;\n\tkeys: number;\n\tshields: number;\n\tenergy: number;\n\tlaser_level: number;\n\tflags: PlayerFlags;\n\n\tprimary_weapon: number;\n\tprimary_weapon_flags: number;\n\tprimary_ammo: number[];\n\n\tvulcan_ammo: number;\n\n\tsecondary_weapon: number;\n\tsecondary_weapon_flags: number;\n\tsecondary_ammo: number[];\n\n\tconstructor() {\n\t\tthis.reset();\n\t}\n\treset() {\n\t\tthis.score = 0;\n\t\tthis.lives = 3;\n\t\tthis.level = 1;\n\t\tthis.keys = 0;\n\t\tthis.shields = 100;\n\t\tthis.energy = 100;\n\t\tthis.laser_level = 0;\n\t\tthis.flags = 0;\n\n\t\tthis.primary_weapon = 0;\n\t\tthis.primary_weapon_flags = 0;\n\t\tthis.primary_ammo = [];\n\n\t\tthis.vulcan_ammo = 0;\n\n\t\tthis.secondary_weapon = 0;\n\t\tthis.secondary_weapon_flags = 0;\n\t\tthis.secondary_ammo = [];\n\t}\n\tpickUpPowerup(idPowerupType: PowerupTypes) {\n\t\tlet fAlreadyHave = false;\n\n\t\tif (PowerupPrimaryFlags[idPowerupType]) {\n\t\t\tfAlreadyHave = !!(this.primary_weapon_flags & PowerupPrimaryFlags[idPowerupType]);\n\t\t} else if (PowerupSecondaryFlags[idPowerupType]) {\n\t\t\tfAlreadyHave = !!(this.secondary_weapon_flags & PowerupSecondaryFlags[idPowerupType]);\n\t\t\t\t\t\t\t} else if (PowerupPlayerFlags[idPowerupType]) {\n\t\t\tfAlreadyHave = !!(this.flags & PowerupPlayerFlags[idPowerupType]);\n\t\t\t\t\t\t\t}\n\n\t\tswitch (idPowerupType) {\n\t\t\tcase PowerupTypes.EXTRA_LIFE:\n\t\t\t\tthis.lives++;\n\t\t\t\treturn true;\n\n\t\t\tcase PowerupTypes.ENERGY:\n\t\t\t\treturn this.pickUpEnergy();\n\n\t\t\tcase PowerupTypes.SHIELD_BOOST:\n\t\t\t\treturn this.pickUpShields();\n\n\t\t\tcase PowerupTypes.LASER:\n\t\t\t\tif (this.laser_level < MAX_LASER_LEVEL) {\n\t\t\t\t\tthis.laser_level++;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\t// case PowerupTypes.SUPER_LASER:\n\n\t\t\tcase PowerupTypes.SPREADFIRE_WEAPON:\n\t\t\tcase PowerupTypes.PLASMA_WEAPON:\n\t\t\tcase PowerupTypes.FUSION_WEAPON:\n\t\t\tcase PowerupTypes.HELIX_WEAPON:\n\t\t\tcase PowerupTypes.PHOENIX_WEAPON:\n\t\t\t\treturn this.pickUpPrimary(idPowerupType);\n\n\t\t\tcase PowerupTypes.VULCAN_WEAPON:\n\t\t\t\treturn this.pickUpVulcan();\n\n\t\t\tcase PowerupTypes.VULCAN_AMMO:\n\t\t\t\treturn this.pickUpVulcanAmmo();\n\n\t\t\tcase PowerupTypes.GAUSS_WEAPON:\n\t\t\t\treturn this.pickUpGauss();\n\n\t\t\tcase PowerupTypes.KEY_BLUE:\n\t\t\tcase PowerupTypes.KEY_RED:\n\t\t\tcase PowerupTypes.KEY_GOLD:\n\t\t\t\tif (!fAlreadyHave) {\n\t\t\t\t\tthis.flags |= PowerupPlayerFlags[idPowerupType];\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase PowerupTypes.MISSILE_1:\n\t\t\tcase PowerupTypes.SMARTBOMB_WEAPON:\n\t\t\tcase PowerupTypes.MEGA_WEAPON:\n\t\t\tcase PowerupTypes.SMISSILE1_1:\n\t\t\tcase PowerupTypes.GUIDED_MISSILE_1:\n\t\t\tcase PowerupTypes.MERCURY_MISSILE_1:\n\t\t\tcase PowerupTypes.HOMING_AMMO_1:\n\t\t\tcase PowerupTypes.EARTHSHAKER_MISSILE:\n\t\t\t\treturn this.pickUpSecondary(idPowerupType, 1);\n\n\t\t\tcase PowerupTypes.MISSILE_4:\n\t\t\tcase PowerupTypes.PROXIMITY_WEAPON:\n\t\t\tcase PowerupTypes.SMISSILE1_4:\n\t\t\tcase PowerupTypes.GUIDED_MISSILE_4:\n\t\t\tcase PowerupTypes.SMART_MINE:\n\t\t\tcase PowerupTypes.MERCURY_MISSILE_4:\n\t\t\tcase PowerupTypes.HOMING_AMMO_4:\n\t\t\t\treturn this.pickUpSecondary(idPowerupType, 4);\n\n\t\t\tcase PowerupTypes.QUAD_FIRE:\n\t\t\tcase PowerupTypes.AMMO_RACK:\n\t\t\tcase PowerupTypes.FULL_MAP:\n\t\t\tcase PowerupTypes.CONVERTER:\n\t\t\tcase PowerupTypes.HEADLIGHT:\n\t\t\tcase PowerupTypes.AFTERBURNER:\n\t\t\tcase PowerupTypes.INVULNERABILITY:\n\t\t\tcase PowerupTypes.CLOAK:\n\t\t\t\tif (fAlreadyHave) {\n\t\t\t\t\treturn this.pickUpEnergy();\n\t\t\t\t}\n\t\t\t\tthis.flags |= PowerupPlayerFlags[idPowerupType];\n\t\t\t\treturn true;\n\n\t\t\tcase PowerupTypes.OMEGA_WEAPON:\n\t\t\tcase PowerupTypes.TURBO:\n\t\t\tcase PowerupTypes.MEGAWOW:\n\t\t\t\t/* network\n\t\t\t\tcase PowerupTypes.FLAG_BLUE:\n\t\t\t\tcase PowerupTypes.FLAG_RED:\n\t\t\t\tcase PowerupTypes.HOARD_ORB:\n\t\t\t\t*/\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn false;\n\t}\n\tpickUpEnergy() {\n\t\tif (this.energy >= MAX_ENERGY) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet boost = 3 * (NDL - _difficultyLevel + 1);\n\t\tif (_difficultyLevel === 0) {\n\t\t\tboost += boost / 2;\n\t\t}\n\t\tthis.energy = Math.min(this.energy + boost, MAX_ENERGY);\n\t\treturn true;\n\t}\n\tpickUpShields() {\n\t\tif (this.shields >= MAX_SHIELDS) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet boost = 3 + 3 * (NDL - _difficultyLevel);\n\t\tif (_difficultyLevel === 0) {\n\t\t\tboost += boost / 2;\n\t\t}\n\t\tthis.shields = Math.min(this.shields + boost, MAX_SHIELDS);\n\t\treturn true;\n\t}\n\tpickUpPrimary(idPowerupType: PowerupTypes) {\n\t\tconst iPrimary = PowerupPrimaryFlags[idPowerupType];\n\t\tif (this.primary_weapon_flags & (1 << iPrimary)) {\n\t\t\treturn this.pickUpEnergy();\n\t\t}\n\n\t\tthis.primary_weapon_flags |= (1 << iPrimary);\n\t\treturn true;\n\t}\n\tpickUpSecondary(idPowerupType: PowerupTypes, count: number) {\n\t\tconst iSecondary = PowerupPrimaryFlags[idPowerupType];\n\t\tif (this.secondary_weapon_flags & (1 << iSecondary)) {\n\t\t\tlet max = Player.secondary_ammo_max[iSecondary];\n\t\t\tif (this.flags & PlayerFlags.AMMO_RACK) {\n\t\t\t\tmax *= 2;\n\t\t\t}\n\n\t\t\tif (this.secondary_ammo[iSecondary] >= max) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.secondary_ammo[iSecondary] = Math.min (max, this.secondary_ammo[iSecondary] + count);\n\t\t} else {\n\t\t\tthis.secondary_weapon_flags |= (1 << iSecondary);\n\t\t\tthis.secondary_ammo[iSecondary] = 0;\n\t\t}\n\t\treturn true;\n\t}\n\tpickUpVulcan() {\n\t\t_player.primary_weapon_flags |= (1 << PrimaryWeaponIndex.VULCAN);\n\t\treturn this.pickUpVulcanAmmo(VULCAN_WEAPON_AMMO_AMOUNT);\n\t}\n\tpickUpGauss() {\n\t\t_player.primary_weapon_flags |= (1 << PrimaryWeaponIndex.GAUSS);\n\t\treturn this.pickUpVulcanAmmo(GAUSS_WEAPON_AMMO_AMOUNT);\n\t}\n\tpickUpVulcanAmmo(count = VULCAN_AMMO_AMOUNT) {\n\t\tif (this.vulcan_ammo >= VULCAN_AMMO_MAX) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.vulcan_ammo = Math.min(this.vulcan_ammo + count, VULCAN_AMMO_MAX);\n\t\treturn true;\n\t}\n\thasKeys(doorKeys: DoorKeys) {\n\t\tconst flags = this.flags;\n\n\t\tif ((doorKeys & DoorKeys.BLUE) && !(flags & PlayerFlags.BLUE_KEY)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((doorKeys & DoorKeys.RED) && !(flags & PlayerFlags.RED_KEY)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((doorKeys & DoorKeys.GOLD) && !(flags & PlayerFlags.GOLD_KEY)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n}\nconst _player = new Player();\n\nenum PrimaryWeaponIndex {\n\tLASER       = 0,\n\tVULCAN      = 1,\n\tSPREADFIRE  = 2,\n\tPLASMA      = 3,\n\tFUSION      = 4,\n\tSUPER_LASER = 5,\n\tGAUSS       = 6,\n\tHELIX       = 7,\n\tPHOENIX     = 8,\n\tOMEGA       = 9,\n}\nconst PowerupPrimaryFlags: { [index: number]: PrimaryWeaponIndex } = (() => {\n\tconst rg: { [index: number]: PrimaryWeaponIndex } = {};\n\n\trg[PowerupTypes.LASER] = PrimaryWeaponIndex.LASER;\n\trg[PowerupTypes.VULCAN_WEAPON] = PrimaryWeaponIndex.VULCAN;\n\trg[PowerupTypes.SPREADFIRE_WEAPON] = PrimaryWeaponIndex.SPREADFIRE;\n\trg[PowerupTypes.PLASMA_WEAPON] = PrimaryWeaponIndex.PLASMA;\n\trg[PowerupTypes.FUSION_WEAPON] = PrimaryWeaponIndex.FUSION;\n\trg[PowerupTypes.SUPER_LASER] = PrimaryWeaponIndex.SUPER_LASER;\n\trg[PowerupTypes.GAUSS_WEAPON] = PrimaryWeaponIndex.GAUSS;\n\trg[PowerupTypes.HELIX_WEAPON] = PrimaryWeaponIndex.HELIX;\n\trg[PowerupTypes.PHOENIX_WEAPON] = PrimaryWeaponIndex.PHOENIX;\n\trg[PowerupTypes.OMEGA_WEAPON] = PrimaryWeaponIndex.OMEGA;\n\n\treturn rg;\n\n})();\n\nenum SecondaryWeaponIndex {\n\tCONCUSSION  = 0,\n\tHOMING      = 1,\n\tPROXIMITY   = 2,\n\tSMART       = 3,\n\tMEGA        = 4,\n\tSMISSILE1   = 5,\n\tGUIDED      = 6,\n\tSMART_MINE  = 7,\n\tSMISSILE4   = 8,\n\tSMISSILE5   = 9,\n}\nconst PowerupSecondaryFlags: { [index: number]: SecondaryWeaponIndex } = (() => {\n\tconst rg: { [index: number]: SecondaryWeaponIndex } = {};\n\n\trg[PowerupTypes.MISSILE_1] = SecondaryWeaponIndex.CONCUSSION;\n\trg[PowerupTypes.MISSILE_4] = SecondaryWeaponIndex.CONCUSSION;\n\trg[PowerupTypes.HOMING_AMMO_1] = SecondaryWeaponIndex.HOMING;\n\trg[PowerupTypes.HOMING_AMMO_4] = SecondaryWeaponIndex.HOMING;\n\trg[PowerupTypes.PROXIMITY_WEAPON] = SecondaryWeaponIndex.PROXIMITY;\n\trg[PowerupTypes.SMARTBOMB_WEAPON] = SecondaryWeaponIndex.SMART;\n\trg[PowerupTypes.MEGA_WEAPON] = SecondaryWeaponIndex.MEGA;\n\trg[PowerupTypes.SMISSILE1_1] = SecondaryWeaponIndex.SMISSILE1;\n\trg[PowerupTypes.SMISSILE1_4] = SecondaryWeaponIndex.SMISSILE1;\n\trg[PowerupTypes.GUIDED_MISSILE_1] = SecondaryWeaponIndex.GUIDED;\n\trg[PowerupTypes.GUIDED_MISSILE_4] = SecondaryWeaponIndex.GUIDED;\n\trg[PowerupTypes.SMART_MINE] = SecondaryWeaponIndex.SMART_MINE;\n\trg[PowerupTypes.MERCURY_MISSILE_1] = SecondaryWeaponIndex.SMISSILE4;\n\trg[PowerupTypes.MERCURY_MISSILE_4] = SecondaryWeaponIndex.SMISSILE4;\n\trg[PowerupTypes.EARTHSHAKER_MISSILE] = SecondaryWeaponIndex.SMISSILE5;\n\n\treturn rg;\n})();\n\nconst PowerupPlayerFlags: { [index: number]: PlayerFlags } = (() => {\n\tconst rg: { [index: number]: PlayerFlags } = {};\n\n\trg[PowerupTypes.INVULNERABILITY] = PlayerFlags.INVULNERABLE;\n\trg[PowerupTypes.KEY_BLUE] = PlayerFlags.BLUE_KEY;\n\trg[PowerupTypes.KEY_RED] = PlayerFlags.RED_KEY;\n\trg[PowerupTypes.KEY_GOLD] = PlayerFlags.GOLD_KEY;\n\t// rg[PowerupTypes.] = PlayerFlags.FLAG;\n\t// rg[PowerupTypes.] = PlayerFlags.UNUSED;\n\trg[PowerupTypes.FULL_MAP] = PlayerFlags.MAP_ALL;\n\trg[PowerupTypes.AMMO_RACK] = PlayerFlags.AMMO_RACK;\n\trg[PowerupTypes.CONVERTER] = PlayerFlags.CONVERTER;\n\trg[PowerupTypes.QUAD_FIRE] = PlayerFlags.QUAD_LASERS;\n\trg[PowerupTypes.CLOAK] = PlayerFlags.CLOAKED;\n\trg[PowerupTypes.AFTERBURNER] = PlayerFlags.AFTERBURNER;\n\trg[PowerupTypes.HEADLIGHT] = PlayerFlags.HEADLIGHT;\n\n\treturn rg;\n})();\n","/// <reference path=\"DataView.ts\" />\n/// <reference path=\"DataStream.ts\" />\n/// <reference path=\"Math.ts\" />\n/// <reference path=\"webgl.ts\" />\n/// <reference path=\"Item.ts\" />\n\"use strict\";\n\nenum KeyActions {\n\tForward,\n\tBackward,\n\n\tStrafeLeft,\n\tStrafeRight,\n\n\tStrafeUp,\n\tStrafeDown,\n\n\tPitchUp,\n\tPitchDown,\n\n\tTurnLeft,\n\tTurnRight,\n\n\tBankLeft,\n\tBankRight,\n\n\tFirePrimary,\n\tFireSecondary,\n\tFireFlare,\n\n\tDebug,\n\n\tTriUp,\n\tTriDown,\n\n\tStepNext,\n\tStepBack,\n\n\tstepUp,\n\tstepDown,\n\n\twireframe,\n\n\tlockDebug,\n\n\tPrimaryLaser,\n\tPrimaryVulcan,\n\tPrimarySpreadFire,\n\tPrimaryPlasma,\n\tPrimaryFusion,\n\n\tSecondaryConcussion,\n\tSecondaryHoming,\n\tSecondaryProximity,\n\tSecondarySmart,\n\tSecondaryMega,\n}\n\nclass KeyBinding {\n\tpressed = false;\n\n\tconstructor(public name: string, public keyCode: number, public debounce = false) {\n\t}\n}\nconst MOUSE_SENSITIVITY = 2;\n\nclass KeysType {\n\tbindings: KeyBinding[];\n\tmapBindings: { [index: string]: KeyBinding };\n\tthrust: Vec3;\n\trot: Vec3;\n\n\tfirePrimary: boolean;\n\tlockDebug: boolean;\n\tstepUp: boolean;\n\tstepDown: boolean;\n\tafterburner: boolean;\n\twireframe: boolean;\n\n\t_mouseDeltaX: number = 0;\n\t_mouseDeltaY: number = 0;\n\n\tconstructor() {\n\t\tthis.bindings =\n\t\t[\n\t\t\tnew KeyBinding(\"forward\", -1),\n\t\t\tnew KeyBinding(\"backward\", -3),\n\n\t\t\tnew KeyBinding(\"strafe left\", 83),\n\t\t\tnew KeyBinding(\"strafe right\", 68),\n\n\t\t\tnew KeyBinding(\"strafe up\", 32),\n\t\t\tnew KeyBinding(\"strafe down\", 18),\n\n\t\t\tnew KeyBinding(\"pitch up\", 0),\n\t\t\tnew KeyBinding(\"pitch down\", 0),\n\n\t\t\tnew KeyBinding(\"turn left\", 90),\n\t\t\tnew KeyBinding(\"turn right\", 88),\n\n\t\t\tnew KeyBinding(\"bank left\", 69),\n\t\t\tnew KeyBinding(\"bank right\", 87),\n\n\t\t\tnew KeyBinding(\"fire primary\", 65),\n\t\t\tnew KeyBinding(\"fire secondary\", 20),\n\t\t\tnew KeyBinding(\"fire flare\", 81),\n\n\t\t\t// new KeyBinding(\"afterburner\", 16),\n\n\t\t\tnew KeyBinding(\"debug\", 66),\n\n\t\t\tnew KeyBinding(\"tri up\", 33, true),\n\t\t\tnew KeyBinding(\"tri down\", 34, true),\n\n\t\t\tnew KeyBinding(\"step next\", 39, true),\n\t\t\tnew KeyBinding(\"step back\", 37, true),\n\n\t\t\tnew KeyBinding(\"step up\", 38, true),\n\t\t\tnew KeyBinding(\"step down\", 40, true),\n\n\t\t\tnew KeyBinding(\"wireframe\", 9, true),\n\n\t\t\tnew KeyBinding(\"lock debug\", 16, true),\n\n\t\t\tnew KeyBinding(\"(SUPER)LASER CANNON\",       0x31, true),\n\t\t\tnew KeyBinding(\"VULCAN/GAUSS CANNON\",\t\t0x32, true),\n\t\t\tnew KeyBinding(\"SPREADFIRE/HELIX CANNON\", \t0x33, true),\n\t\t\tnew KeyBinding(\"PLASMA/PHOENIX CANNON\",\t\t0x34, true),\n\t\t\tnew KeyBinding(\"FUSION/OMEGA CANNON\",\t\t0x35, true),\n\t\t\tnew KeyBinding(\"CONCUSSION/FLASH MISSILE\",\t0x36, true),\n\t\t\tnew KeyBinding(\"HOMING/GUIDED MISSILE\",\t\t0x37, true),\n\t\t\tnew KeyBinding(\"PROXIMITY BOMB/SMART MINE\",\t0x38, true),\n\t\t\tnew KeyBinding(\"SMART/MERCURY MISSILE\",\t\t0x39, true),\n\t\t\tnew KeyBinding(\"MEGA/EARTHSHAKER MISSILE\",\t0x30, true),\n\t\t];\n\n\t\tthis.mapBindings = {};\n\t\tfor (let iBinding = this.bindings.length; iBinding--;) {\n\t\t\tconst binding = this.bindings[iBinding];\n\t\t\tthis.mapBindings[binding.keyCode.toString()] = binding;\n\t\t\tthis.mapBindings[binding.name] = binding;\n\t\t}\n\n\t\tthis.thrust = Vec3.Zero;\n\t\tthis.rot = Vec3.Zero;\n\t}\n\treset() {\n\t\tfor (let iBinding = this.bindings.length; iBinding--;) {\n\t\t\tthis.bindings[iBinding].pressed = false;\n\t\t}\n\t}\n\tkeyDown(code: any) {\n\t\tconst binding = this.mapBindings[code];\n\t\tif (binding) {\n\t\t\tif (!binding.pressed) {\n\t\t\t\t// console.log(\"DOWN: \" + binding.name);\n\t\t\t\tbinding.pressed = true;\n\t\t\t}\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconsole.log(\"DOWN: \" + code);\n\t\t\treturn false;\n\t\t}\n\t}\n\tkeyUp(code: any) {\n\t\tconst binding = this.mapBindings[code];\n\t\tif (binding) {\n\t\t\tif (binding.pressed) {\n\t\t\t\t// console.log(\"UP: \" + binding.name);\n\t\t\t\tbinding.pressed = false;\n\t\t\t}\n\t\t}\n\t}\n\tupdateControls(frameTime: number) {\n\t\tlet forwardThrust = 0;\n\t\tlet sidewaysThrust = 0;\n\t\tlet verticalThrust = 0;\n\n\t\tlet pitchTime = 0;\n\t\tlet headingTime = 0;\n\t\tlet bankTime = 0;\n\n\t\tthis.firePrimary = false;\n\t\tthis.lockDebug = false;\n\t\tthis.stepUp = false;\n\t\tthis.stepDown = false;\n\n\t\tfor (let iBinding = this.bindings.length; iBinding--;) {\n\t\t\tconst binding = this.bindings[iBinding];\n\t\t\tif (!binding.pressed) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (binding.name) {\n\t\t\t\tcase \"strafe right\":\n\t\t\t\t\tsidewaysThrust = frameTime;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"strafe left\":\n\t\t\t\t\tsidewaysThrust = -frameTime;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"strafe up\":\n\t\t\t\t\tverticalThrust = frameTime;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"strafe down\":\n\t\t\t\t\tverticalThrust = -frameTime;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"forward\":\n\t\t\t\t\tforwardThrust = frameTime;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"backward\":\n\t\t\t\t\tforwardThrust = -frameTime;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"afterburner\":\n\t\t\t\t\tthis.afterburner = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"fire primary\":\n\t\t\t\t\tthis.firePrimary = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"pitch up\":\n\t\t\t\t\tpitchTime = frameTime;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"pitch down\":\n\t\t\t\t\tpitchTime = -frameTime;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"turn right\":\n\t\t\t\t\theadingTime = frameTime;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"turn left\":\n\t\t\t\t\theadingTime = -frameTime;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"bank right\":\n\t\t\t\t\tbankTime = frameTime;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"bank left\":\n\t\t\t\t\tbankTime = -frameTime;\n\t\t\t\t\tbreak;\n\n\t\t\t\t/*\n\t\t\t\tcase \"tri up\":\n\t\t\t\t\tif (_iTriView < 5)\n\t\t\t\t\t{\n\t\t\t\t\t\t_iTriView++;\n\t\t\t\t\t\t_iStep = 0;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"tri down\":\n\t\t\t\t\tif (_iTriView > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t_iTriView--;\n\t\t\t\t\t\t_iStep = 0;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"step next\":\n\t\t\t\t\t_iStep++;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"step back\":\n\t\t\t\t\tif (_iStep > 0)\n\t\t\t\t\t\t_iStep--;\n\t\t\t\t\tbreak;\n\t\t\t\t*/\n\n\t\t\t\tcase \"step up\":\n\t\t\t\t\tthis.stepUp = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"step down\":\n\t\t\t\t\tthis.stepDown = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"wireframe\":\n\t\t\t\t\tthis.wireframe = !this.wireframe;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"lock debug\":\n\t\t\t\t\tthis.lockDebug = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (binding.debounce) {\n\t\t\t\tbinding.pressed = false;\n\t\t\t}\n\t\t}\n\n\t\theadingTime += this._mouseDeltaX * frameTime * MOUSE_SENSITIVITY / 8;\n\t\tpitchTime -= this._mouseDeltaY * frameTime * MOUSE_SENSITIVITY / 8;\n\n\t\tif (headingTime > frameTime) {\n\t\t\theadingTime = frameTime;\n\t\t} else if (headingTime < -frameTime) {\n\t\t\theadingTime = -frameTime;\n\t\t\t\t\t\t\t}\n\n\t\tif (pitchTime > frameTime) {\n\t\t\tpitchTime = frameTime;\n\t\t} else if (pitchTime < -frameTime) {\n\t\t\tpitchTime = -frameTime;\n\t\t\t\t\t\t\t}\n\n\t\tthis.thrust = new Vec3(sidewaysThrust, verticalThrust, forwardThrust);\n\t\tthis.rot = new Vec3(pitchTime, headingTime, bankTime);\n\n\t\tthis._mouseDeltaX = this._mouseDeltaY = 0;\n\t}\n}\nconst Keys = new KeysType();\n","/// <reference path=\"DataView.ts\" />\n/// <reference path=\"DataStream.ts\" />\n/// <reference path=\"Math.ts\" />\n/// <reference path=\"webgl.ts\" />\n/// <reference path=\"Ham.ts\" />\n/// <reference path=\"Level.ts\" />\n/// <reference path=\"Player.ts\" />\n/// <reference path=\"Controls.ts\" />\n/// <reference path=\"PowerupTypes.ts\" />\n\"use strict\";\n\nenum ItemTypes {\n\tWALL = 0,\t// A CWall... not really an CObject, but used for collisions\n\tFIREBALL = 1,\t// a fireball, part of an explosion\n\tROBOT = 2,\t// an evil enemy\n\tHOSTAGE = 3,\t// a hostage you need to rescue\n\tPLAYER = 4,\t// the player on the console\n\tWEAPON = 5,\t// a laser, missile, etc\n\tCAMERA = 6,\t// a camera to slew around with\n\tPOWERUP = 7,\t// a powerup you can pick up\n\tDEBRIS = 8,\t// a piece of robot\n\tCNTRLCEN = 9,\t// the control center\n\tFLARE = 10,  // a flare\n\tCLUTTER = 11,  // misc objects\n\tGHOST = 12,  // what the player turns into when dead\n\tLIGHT = 13,  // a light source, & not much else\n\tCOOP = 14,  // a cooperative player CObject.\n\tMARKER = 15,  // a map marker\n\tNONE = 255, // unused CObject\n}\n// misc object flags\nenum ItemFlags {\n\tEXPLODING = (1 << 0),   // this object is exploding\n\tSHOULD_BE_DEAD = (1 << 1),   // this object should be dead, so next time we can, we should delete this object.\n\tDESTROYED = (1 << 2),   // this has been killed, and is showing the dead version\n\tSILENT = (1 << 3),   // this makes no sound when it hits a wall.  Added by MK for weapons, if you extend it to other types, do it completely!\n\tATTACHED = (1 << 4),  // this object is a fireball attached to another object\n\tHARMLESS = (1 << 5),  // this object does no damage.  Added to make quad lasers do 1.5 damage as normal lasers.\n\tPLAYER_DROPPED = (1 << 6),  // this object was dropped by the player...\n}\n// Control types - what tells this CObject what do do\nenum ControlTypes {\n\tNONE = 0,\t  // doesn't move (or change movement)\n\tAI = 1,\t  // driven by AI\n\tEXPLOSION = 2,\t  // explosion sequencer\n\tFLYING = 4,\t  // the player is flying\n\tSLEW = 5,\t  // slewing\n\tFLYTHROUGH = 6,\t  // the flythrough system\n\tWEAPON = 9,\t  // laser, etc.\n\tREPAIRCEN = 10,  // under the control of the repair center\n\tMORPH = 11,  // this CObject is being morphed\n\tDEBRIS = 12,  // this is a piece of debris\n\tPOWERUP = 13,  // animating powerup blob\n\tLIGHT = 14,  // doesn't actually do anything\n\tREMOTE = 15,  // controlled by another net player\n\tCNTRLCEN = 16,  // the control center/main reactor\n\tWAYPOINT = 17,\n\tCAMERA = 18,\n}\nenum MovementTypes {\n\tNONE = 0,   // doesn't move\n\tPHYSICS = 1,   // moves by physics\n\tSTATIC = 2,\t// completely still and immoveable\n\tSPINNING = 3,   // this CObject doesn't move, just sits and spins\n}\nenum RenderTypes {\n\tNONE = 0,\t// does not render\n\tPOLYOBJ = 1,\t// a polygon model\n\tFIREBALL = 2,\t// a fireball\n\tLASER = 3,\t// a laser\n\tHOSTAGE = 4,\t// a hostage\n\tPOWERUP = 5,\t// a powerup\n\tMORPH = 6,\t// a robot being morphed\n\tWEAPON_VCLIP = 7,\t// a weapon that renders as a tVideoClip\n\tTHRUSTER = 8,\t// like afterburner, but doesn't cast light\n\tEXPLBLAST = 9,\t// white explosion light blast\n\tSHRAPNELS = 10,\t// smoke trails coming from explosions\n\tSMOKE = 11,\n\tLIGHTNING = 12,\n\tSOUND = 13,\n\tSHOCKWAVE = 14,\t// concentric shockwave effect\n}\n\ninterface IMover {\n\tvelocity: Vec3;\n\n\tmove(obj: Item, time: number, frameTime: number): boolean;\n}\n\nclass SpinnerInfo implements IMover {\n\tspin: Vec3;\n\tspinMatrix: Mat3;\n\tvelocity: Vec3 = Vec3.Zero;\n\n\tload(view: DataStream) {\n\t\tthis.spin = view.getVector();\n\t\tthis.spinMatrix = Mat3.fromEuler(this.spin);\n\t\treturn this;\n\t}\n\tmove(obj: Item, time: number, frameTime: number): boolean {\n\t\tobj.orient = this.spinMatrix.scale(frameTime).multiply(obj.orient);\n\t\treturn true;\n\t}\n}\nclass PhysicsInfo implements IMover {\n\tvelocity: Vec3 = Vec3.Zero;\n\tthrust: Vec3 = Vec3.Zero;\n\n\tmass = 0;\n\tdrag = 0;\n\tbrakes = 0;\n\n\trotvel: Vec3 = Vec3.Zero;\n\trotthrust: Vec3 = Vec3.Zero;\n\n\tturnroll = 0;\n\tflags = 0;\n\n\tload(view: DataStream) {\n\t\tthis.velocity = view.getVector();\n\t\tthis.thrust = view.getVector();\n\n\t\tthis.mass = view.getFixed();\n\t\tthis.drag = view.getFixed();\n\t\tthis.brakes = view.getFixed();\n\n\t\tthis.rotvel = view.getVector();\n\t\tthis.rotthrust = view.getVector();\n\n\t\tthis.turnroll = view.getFixed2();\n\t\tthis.flags = view.getUint16();\n\n\t\treturn this;\n\t}\n\tmove(obj: Item, time: number, frameTime: number) {\n\t\tassert(!obj.isDead());\n\n\t\tif (this.drag) {\n\t\t\tconst tau = this.mass * 2.5 * this.drag;\n\t\t\tconst dragScale = Math.exp(-frameTime / tau);\n\n\t\t\t// linear drag equation\n\t\t\tthis.rotvel = this.rotvel.scale(dragScale);\n\n\t\t\tif (this.flags & PhysicsFlags.USES_THRUST) {\n\t\t\t\tthis.rotvel = this.rotvel.addScale(this.rotthrust, tau * (1 - dragScale) / frameTime);\n\t\t\t}\n\t\t}\n\n\t\tlet orient = obj.orient;\n\n\t\tif (this.turnroll) {\n\t\t\tconst turnmat = Mat3.fromEuler(0, 0, -this.turnroll);\n\t\t\torient = orient.multiply(turnmat);\n\t\t}\n\n\t\tconst tangles = Mat3.fromEuler(this.rotvel.scale(frameTime));\n\t\torient = tangles.multiply(orient);\n\n\t\tif (this.flags & PhysicsFlags.TURNROLL) {\n\t\t\tconst desired_bank = -this.rotvel.y * TURNROLL_SCALE;\n\n\t\t\tif (this.turnroll !== desired_bank) {\n\t\t\t\tlet max_roll = frameTime * ROLL_RATE;\n\n\t\t\t\tconst delta_ang = desired_bank - this.turnroll;\n\n\t\t\t\tif (Math.abs(delta_ang) < max_roll) {\n\t\t\t\t\tmax_roll = delta_ang;\n\t\t\t\t} else if (delta_ang < 0) {\n\t\t\t\t\tmax_roll = -max_roll;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\tthis.turnroll += max_roll;\n\t\t\t}\n\t\t}\n\n\t\tif (this.turnroll) {\n\t\t\tconst turnmat = Mat3.fromEuler(0, 0, this.turnroll);\n\t\t\torient = orient.multiply(turnmat);\n\t\t}\n\n\t\tobj.orient = orient;\n\n\t\tif (this.drag) {\n\t\t\tconst tau = this.mass * this.drag;\n\t\t\tconst dragScale = Math.exp(-frameTime / tau);\n\n\t\t\t// linear drag equation\n\t\t\tthis.velocity = this.velocity.scale(dragScale);\n\t\t\tif (this.flags & PhysicsFlags.USES_THRUST) {\n\t\t\t\tthis.velocity = this.velocity.addScale(this.thrust, tau * (1 - dragScale) / frameTime);\n\t\t\t}\n\t\t}\n\n\t\tlet fKill = false;\n\n\t\tif (this.velocity.len2() > 1e-15) {\n\t\t\tconst move = this.velocity.scale(frameTime);\n\t\t\t// const distance = move.len2();\n\n\t\t\tassert(obj.iCube >= 0);\n\n\t\t\t/*\n\t\t\tif (!obj.cube.isPointInside(posNew))\n\t\t\t{\n\t\t\t\tconsole.log(\"NOT INSIDE\");\n\t\t\t\t// return;\n\t\t\t}\n\t\t\t*/\n\t\t\tconst mapCollisionHandlers = Item.mapCollisionHandlers[obj.type];\n\n\t\t\tlet cBounces = 3;\n\t\t\tconst type = obj.type;\n\t\t\tlet bounce: Bounce | null;\n\t\t\tconst sideExit: Side | null = null;\n\n\t\t\tlet cube = obj.cube;\n\t\t\tlet pos = obj.pos;\n\t\t\tlet posNew = pos.add(move);\n\n\t\t\tdo {\n\t\t\t\tconst line = new LineSegment(pos, posNew);\n\n\t\t\t\t// if (!(obj.type === ObjectTypes.PLAYER /*&& _cubeDebug*/))\n\t\t\t\tbounce = cube.bounce(line, obj.size + 0.01);\n\n\t\t\t\tlet closestOther: Item | null = null;\n\t\t\t\tlet distanceToClosest = line.length; // Number.POSITIVE_INFINITY;\n\n\t\t\t\tif (mapCollisionHandlers) {\n\t\t\t\t\tconst rgObjects = cube._rgObjects;\n\t\t\t\t\tfor (let iOther = rgObjects.length; iOther--;) {\n\t\t\t\t\t\tconst other: Item = rgObjects[iOther];\n\t\t\t\t\t\tif (other.isDead()) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\t// item is dead\n\n\t\t\t\t\t\tconst otherType = other.type;\n\t\t\t\t\t\tif (otherType === type) {\n\t\t\t\t\t\t\tif (iOther >= obj.cubeIndex) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (other === obj) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst collisionHandler = mapCollisionHandlers[otherType];\n\t\t\t\t\t\tif (collisionHandler) {\n\t\t\t\t\t\t\tconst distanceToOther = line.distanceToSphere(other.pos, other.size + obj.size);\n\t\t\t\t\t\t\tif (distanceToClosest > distanceToOther) {\n\t\t\t\t\t\t\t\tdistanceToClosest = distanceToOther;\n\t\t\t\t\t\t\t\tclosestOther = other;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (closestOther && (!bounce || distanceToClosest < bounce.distance)) {\n\t\t\t\t\tconst collisionPoint = new LineSegment(line.proceed(distanceToClosest), closestOther.pos).proceed(obj.size);\n\n\t\t\t\t\t// console.log(distanceToClosest);\n\t\t\t\t\tconst objRemove = mapCollisionHandlers[closestOther.type].call(obj, time, collisionPoint, closestOther);\n\t\t\t\t\tif (objRemove) {\n\t\t\t\t\t\tif (objRemove === obj) {\n\t\t\t\t\t\t\tfKill = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tobjRemove.link(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (bounce) {\n\t\t\t\t\tconst side = bounce.side;\n\t\t\t\t\tconst wall = side.wall;\n\n\t\t\t\t\tif (!side.isSolid()) {\n\t\t\t\t\t\tif (wall && wall.trigger) {\n\t\t\t\t\t\t\twall.trigger.trigger(obj, time, false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcube = side.neighbor;\n\t\t\t\t\t\tpos = bounce.anchor;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase ItemTypes.WEAPON:\n\n\t\t\t\t\t\t\tlet uv: Vec2 | null = null;\n\n\t\t\t\t\t\t\tconst tmi1 = side.tmi1;\n\t\t\t\t\t\t\tif (side.neighbor && tmi1.isTransparent()) {\n\t\t\t\t\t\t\t\t\tif (!uv) {\n\t\t\t\t\t\t\t\t\t\tuv = bounce.getTextureCoords();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tconst color = side.getPixel(uv.x, uv.y);\n\t\t\t\t\t\t\t\t\tif (color === 255) {\n\t\t\t\t\t\t\t\t\t\tcube = side.neighbor;\n\t\t\t\t\t\t\t\t\t\tpos = bounce.anchor;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst wi = obj.weaponInfo;\n\n\t\t\t\t\t\t\tif (this.flags & PhysicsFlags.BOUNCE &&\n\t\t\t\t\t\t\t\t\t(!(this.flags & PhysicsFlags.BOUNCES_TWICE) || !(this.flags & PhysicsFlags.BOUNCED_ONCE))) {\n\t\t\t\t\t\t\t\t\tthis.flags |= PhysicsFlags.BOUNCED_ONCE;\n\t\t\t\t\t\t\t\t\tconst normalVelocity = this.velocity.projectOnTo(bounce.normal);\n\t\t\t\t\t\t\t\t\tthis.velocity = this.velocity.addScale(normalVelocity, -2);\n\n\t\t\t\t\t\t\t\t\tobj.orient = Mat3.createLook(this.velocity, obj.orient._[1]);\n\n\t\t\t\t\t\t\t\t\tpos = bounce.anchor;\n\t\t\t\t\t\t\t\t\tposNew = bounce.reflectPoint(posNew);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfKill = true;\n\t\t\t\t\t\t\t\t\tposNew = bounce.anchor;\n\n\t\t\t\t\t\t\t\t\tcube.createExplosion(time, posNew.addScale(side.normal, .1), wi.impact_size, wi.wall_hit_vclip);\n\n\t\t\t\t\t\t\t\t\tif (!wall && wi.wall_hit_sound >= 0) {\n\t\t\t\t\t\t\t\t\t\t_ham.playSound(wi.wall_hit_sound, posNew);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst tmi2 = side.tmi2;\n\t\t\t\t\t\t\tif (tmi2) {\n\t\t\t\t\t\t\t\t\tconst ec = tmi2.eclip_num;\n\n\t\t\t\t\t\t\t\t\tlet fBlow = false;\n\t\t\t\t\t\t\t\t\tconst effect: EClip | null = (ec >= 0) ? _ham.rgEClips[ec] : null;\n\t\t\t\t\t\t\t\t\tif (effect) {\n\t\t\t\t\t\t\t\t\t\tfBlow = (effect.dest_bm_num >= 0 && !(effect.eflags & EClipFlags.ONE_SHOT));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tfBlow = (tmi2.destroyed !== -1);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (fBlow) {\n\t\t\t\t\t\t\t\t\t\tif (!uv) {\n\t\t\t\t\t\t\t\t\t\t\tuv = bounce.getTextureCoords();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tconst color = side.getPixel2(uv.x, uv.y);\n\t\t\t\t\t\t\t\t\t\tif (color !== 255) {\n\t\t\t\t\t\t\t\t\t\t\tside.setDeltaLight(0);\n\n\t\t\t\t\t\t\t\t\t\t\tif (effect) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (effect.sound_num >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t_ham.playSound(effect.sound_num, posNew);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tcube.createExplosion(time, posNew.addScale(side.normal, .1), effect.dest_size, effect.dest_vclip);\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (effect.dest_eclip >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst new_ec = _ham.rgEClips[effect.dest_eclip];\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew_ec.time_left = new_ec.frame_time;\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew_ec.frame_count = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew_ec.segnum = cube.index;\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew_ec.sidenum = side.index;\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew_ec.eflags |= EClipFlags.ONE_SHOT;\n\t\t\t\t\t\t\t\t\t\t\t\t\tnew_ec.dest_bm_num = effect.dest_bm_num;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tside.setTex2(new_ec.changing_wall_texture);\t\t// replace with destoyed\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tside.setTex2(effect.dest_bm_num);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tcube.createExplosion(time, posNew.addScale(side.normal, .1), 20, 3);\n\t\t\t\t\t\t\t\t\t\t\t\tside.setTex2(tmi2.destroyed);\n\t\t\t\t\t\t\t\t\t\t\t\t_ham.playSound(SoundFile_Sounds.LIGHT_BLOWNUP, posNew);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (wall && wall.trigger) {\n\t\t\t\t\t\t\t\t\t\t\t\twall.trigger.trigger(obj.parent, time, true);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (wall) {\n\t\t\t\t\t\t\t\t\tswitch (wall.type) {\n\t\t\t\t\t\t\t\t\t\tcase WallTypes.BLASTABLE:\n\t\t\t\t\t\t\t\t\t\t\twall.damage(time, obj.shields);\n\t\t\t\t\t\t\t\t\t\t\tif (wi.wall_hit_sound >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t_ham.playSound(SoundFile_Sounds.WEAPON_HIT_BLASTABLE, posNew);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase WallTypes.DOOR:\n\t\t\t\t\t\t\t\t\t\t\tif (obj.parent && obj.parent.type === ItemTypes.PLAYER) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (_player.hasKeys(wall.keys) && !(wall.flags & WallFlags.DOOR_LOCKED)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (wall.state !== DoorStates.OPENING) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twall.openDoor();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t_ham.playSound(SoundFile_Sounds.WEAPON_HIT_DOOR, posNew);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tif (wi.wall_hit_sound >= 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t_ham.playSound(wi.wall_hit_sound, posNew);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tconst normalVelocity = this.velocity.projectOnTo(bounce.normal);\n\t\t\t\t\t\t\t\tthis.velocity = this.velocity.sub(normalVelocity);\n\t\t\t\t\t\t\t\tpos = bounce.anchor;\n\t\t\t\t\t\t\t\tposNew = bounce.reflectPoint(posNew);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\twhile (cBounces-- > 0 && (bounce || sideExit));\n\n\t\t\tif (!cube.isPointInside(posNew)) {\n\t\t\t\tcube.isPointInside(posNew);\n\t\t\t\tcube.bounce(new LineSegment(pos, posNew), 0);\n\t\t\t\t// find closest point\n\t\t\t\tconst lineFix = new LineSegment(cube.center, posNew);\n\t\t\t\tconst bounceFix = cube.bounce(lineFix, obj.size);\n\t\t\t\tif (bounceFix) {\n\t\t\t\t\tposNew = bounceFix.anchor;\n\t\t\t\t} else {\n\t\t\t\t\tposNew = null!;\n\t\t\t\t}\t// last resort, don't move\n\t\t\t}\n\n\t\t\tif (posNew) {\n\t\t\t\tobj.pos = posNew;\n\t\t\t\tobj.link(cube);\n\t\t\t}\n\t\t}\n\t\treturn !fKill;\t// stay alive\n\t}\n}\nenum PhysicsFlags {\n\tTURNROLL = (1 << 0),\t// roll when turning\n\tLEVELLING = (1 << 1),\t// level object with closest side\n\tBOUNCE = (1 << 2),\t// bounce (not slide) when hit will\n\tWIGGLE = (1 << 3),\t// wiggle while flying\n\tSTICK = (1 << 4),\t// object sticks (stops moving) when hits wall\n\tPERSISTENT = (1 << 5),\t// object keeps going even after it hits another object (eg, fusion cannon)\n\tUSES_THRUST = (1 << 6),\t// this object uses its thrust\n\tBOUNCED_ONCE = (1 << 7),\t// Weapon has bounced once.\n\tFREE_SPINNING = (1 << 8),\t// Drag does not apply to rotation of this object\n\tBOUNCES_TWICE = (1 << 9),\t// This weapon bounces twice, then dies\n}\ninterface IObjectRenderer {\n\trender(obj: Item, time: number): void;\n}\nclass PolygonRenderInfo implements IObjectRenderer {\n\trgAnimAngles: Vec3[];\n\tsubobj_flags = 0;\n\talt_textures = 0;\n\ttmap_override = 0;\n\n\tconstructor(public model_num?: number) {\n\t}\n\n\tload(view: DataStream) {\n\t\tthis.model_num = view.getUint32();\n\t\tthis.rgAnimAngles = view.getVector2Array(MAX_SUBMODELS);\n\t\tthis.subobj_flags = view.getUint32();\n\t\tthis.tmap_override = view.getInt32();\n\n\t\treturn this;\n\t}\n\trender(obj: Item, time: number) {\n\t\tconst pos = obj.pos;\n\t\tconst orient = obj.orient;\n\n\t\tconst lightValue = obj.cube.static_light;\n\t\tconst light = new Vec3(lightValue, lightValue, lightValue);\n\n\t\tconst model = _ham.rgPolygonModels[this.model_num!];\n\n\t\tpushOrientMatrix(orient, pos);\n\n\t\tlet flags = this.subobj_flags;\n\t\tif (flags) {\n\t\t\tfor (let i = 0; flags; flags >>= 1, ++i) {\n\t\t\t\tif (flags & 1) {\n\t\t\t\t\tconst ofs = model.submodel_mins[i].add(model.submodel_maxs[i]).scale(.5);\n\t\t\t\t\t// push matrix\n\n\t\t\t\t\tmodel.render(light, this.rgAnimAngles);\n\n\t\t\t\t\t// pop matrix\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tmodel.render(light, this.rgAnimAngles);\n\t\t}\n\n\t\tpopMatrix();\n\t}\n}\nclass VClipRenderInfo implements IObjectRenderer {\n\tvclip: VClip;\n\tvclip_num: number;\n\n\trender(obj: Item, time: number) {\n\t\t// do nothing\n\t}\n\n\trenderFrame(obj: Item, iBitmap: number) {\n\t\tconst vclip = this.getVClip();\n\n\t\tlet program: WebGLProgram;\n\t\tif (vclip.flags & VClipFlags.ROD) {\n\t\t\tprogram = programBillboardX;\n\t\t} else {\n\t\t\tprogram = programBillboard;\n\t\t}\n\n\t\tuseProgram(program);\n\n\t\tconst tex = _pig.loadBitmap(iBitmap, 1);\n\t\tif (!tex) {\n\t\t\treturn;\n\t\t}\n\t\tbindTexture(1, tex.tex);\n\n\t\tconst bmp = tex.bmp;\n\t\tgl.uniform3f(program.pos, obj.pos.x, obj.pos.y, obj.pos.z);\n\t\tgl.uniform2f(program.sizeTexture, bmp.width, bmp.height);\n\t\tgl.uniform1f(program.scale, obj.size / Math.max(bmp.width, bmp.height));\n\n\t\tloadAttribBuffer(program.aVertexPosition, program.bufferVertexPosition);\n\n\t\tgl.drawArrays(gl.TRIANGLE_FAN, 0, program.bufferVertexPosition.numItems);\n\t}\n\tgetVClip() {\n\t\tlet vclip = this.vclip;\n\t\tif (!vclip) {\n\t\t\tthis.vclip = vclip = _ham.rgVClips[this.vclip_num];\n\t\t}\n\t\treturn vclip;\n\t}\n}\nclass OneShotVClipRenderInfo extends VClipRenderInfo {\n\tvclip_num: number;\n\n\tconstructor(vclip_num: number) {\n\t\tsuper();\n\t\tthis.vclip_num = vclip_num;\n\t}\n\trender(obj: Item, time: number) {\n\t\tconst vclip = this.getVClip();\n\n\t\t// odd objects go backwards?\n\t\tlet iFrame = Math.floor(vclip.num_frames * (time - obj.creationTime) / (vclip.play_time));\n\t\tif (iFrame >= vclip.num_frames) {\n\t\t\tiFrame = vclip.num_frames - 1;\n\t\t}\n\n\t\tconst iBitmap = vclip.frames[iFrame];\n\n\t\tthis.renderFrame(obj, iBitmap);\n\t}\n}\nclass LoopingVClipRenderInfo extends VClipRenderInfo {\n\tframetime: number;\n\tframenum: number;\n\n\tload(view: DataStream) {\n\t\tthis.vclip_num = view.getUint32();\n\t\tthis.frametime = view.getFixed();\n\t\tthis.framenum = view.getUint8();\n\n\t\treturn this;\n\t}\n\trender(obj: Item, time: number) {\n\t\tconst vclip = this.getVClip();\n\n\t\tconst num = Number(obj._unique);\n\t\t// odd objects go backwards?\n\t\tconst iFrame = Math.floor((time / this.frametime) + this.framenum + num) % vclip.num_frames;\n\t\tconst iBitmap = (num & 1) ? vclip.frames[iFrame] : vclip.frames[vclip.num_frames - 1 - iFrame];\n\n\t\tthis.renderFrame(obj, iBitmap);\n\t}\n}\nconst MAX_AI_FLAGS = 11;          // This MUST cause word (4 bytes) alignment in ai_static, allowing for one byte mode\n\nconst TURNROLL_SCALE = fix(0x4ec4 / 2);\nconst ROLL_RATE = fix(0x2000);\nconst HEADLIGHT_SCALE = 10;\n\nclass Item {\n\tstatic mapCollisionHandlers = [] as Array<Array<(time: number, pos: Vec3, other: Item) => Item|null>>;\n\n\tstatic load(view: DataStream) {\n\t\tconst type = view.getUint8();\n\t\tconst id = view.getInt8();\n\n\t\tswitch (type) {\n\t\t\tcase ItemTypes.PLAYER: // 4,\t\t// the player on the console\n\t\t\tcase ItemTypes.POWERUP: // 7,\t\t// a powerup you can pick up\n\t\t\tcase ItemTypes.ROBOT: // 2,\t\t// an evil enemy\n\t\t\tcase ItemTypes.COOP: // 14,\t// a cooperative player CObject.\n\t\t\tcase ItemTypes.CNTRLCEN: // 9,\t\t// the control center\n\t\t\tcase ItemTypes.HOSTAGE: // 3,\t\t// a hostage you need to rescue\n\t\t\tcase ItemTypes.WEAPON: // 5,\t\t// a laser, missile, etc\n\t\t\t\treturn new Item(type, id).load(view);\n\n\t\t\t// case ObjectTypes.WALL\t\t\t: // 0,\t\t// A CWall... not really an CObject, but used for collisions\n\t\t\t// case ObjectTypes.FIREBALL\t\t: // 1,\t\t// a fireball, part of an explosion\n\t\t\t// case ObjectTypes.CAMERA\t\t: // 6,\t\t// a camera to slew around with\n\t\t\t// case ObjectTypes.DEBRIS\t\t: // 8,\t\t// a piece of robot\n\t\t\t// case ObjectTypes.FLARE\t\t: // 10,\t// a flare\n\t\t\t// case ObjectTypes.CLUTTER\t\t: // 11,\t// misc objects\n\t\t\t// case ObjectTypes.GHOST\t\t: // 12,\t// what the player turns into when dead\n\t\t\t// case ObjectTypes.LIGHT\t\t: // 13,\t// a light source, & not much else\n\t\t\t// case ObjectTypes.MARKER\t\t: // 15,\t// a map marker\n\t\t\t// case ObjectTypes.CAMBOT\t\t: // 16,\t// a camera\n\t\t\t// case ObjectTypes.MONSTERBALL\t: // 17,\t// a monsterball\n\t\t\t// case ObjectTypes.SMOKE\t\t: // 18,\t// static smoke\n\t\t\t// case ObjectTypes.EXPLOSION\t: // 19,\t// static explosion particleEmitters\n\t\t\t// case ObjectTypes.EFFECT\t\t: // 20,\t// lightnings\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"unknown object type: \" + type);\n\t\t}\n\t}\n\n\tinfo: any;\n\tparent: Item;\n\n\tmapCollisionHandlers: Array<(time: number, pos: Vec3, other: Item) => Item|null>;\n\n\tcontrolType: ControlTypes;\n\tmovementType: MovementTypes;\n\trenderType: RenderTypes;\n\tflags: ItemFlags;\n\n\tiCube: number;\n\tattachedObj: number;\n\n\tcube: Cube;\n\tcubeIndex: number;\n\tpos: Vec3;\n\torient: Mat3;\n\n\tget direction() { return this.orient._[2]; }\n\n\tsize: number;\n\tshields: number;\n\n\tlastPos: Vec3;\n\n\tcontainsType: number;\n\tcontainsId: number;\n\tcontainsCount: number;\n\tmover: IMover;\n\tcontrol: any;\n\trenderInfo: IObjectRenderer;\n\tweaponInfo: WeaponInfo;\n\tmultiplier: number;\n\n\tcreationTime: number;\n\tdeathTime: number;\n\n\tcontrols: KeysType;\n\n\t_unique: string;\n\n\tconstructor(public type: ItemTypes, public id: number) {\n\t\tthis._unique = (__unique++).toString();\n\n\t\t// console.log(\"type: \" + type);\n\n\t\tif (type < 0 || type > 15) {\n\t\t\tthrow new Error(\"unknown ObjectType: \" + type);\n\t\t}\n\n\t\tthis.mapCollisionHandlers = Item.mapCollisionHandlers[type];\n\n\t\tswitch (type) {\n\t\t\tcase ItemTypes.ROBOT:\n\t\t\t\tthis.info = _ham.rgRobotTypes[id];\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.FIREBALL:\n\t\t\t\tthis.info = _ham.rgVClips[id];\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.POWERUP:\n\t\t\t\tthis.info = _ham.rgPowerupInfos[id];\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.WEAPON:\n\t\t\t\tthis.info = _ham.rgWeaponInfos[id];\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t}\n\n\t\t// if (!this.info)\n\t\t// \tthrow new Error (\"object info not found\");\n\t}\n\tload(view: DataStream) {\n\t\tthis.controlType = view.getUint8();\n\t\tthis.movementType = view.getUint8();\n\t\tthis.renderType = view.getUint8();\n\t\tthis.flags = view.getUint8();\n\n\t\tthis.iCube = view.getUint16();\n\t\tthis.attachedObj = -1;\n\n\t\tthis.pos = view.getVector();\n\t\tthis.orient = view.getMatrix();\n\n\t\tthis.size = view.getFixed();\n\t\tthis.shields = view.getFixed();\n\n\t\tthis.lastPos = view.getVector();\n\n\t\tthis.containsType = view.getUint8();\n\t\tthis.containsId = view.getUint8();\n\t\tthis.containsCount = view.getUint8();\n\n\t\tswitch (this.movementType) {\n\t\t\tcase MovementTypes.PHYSICS:\n\t\t\t\tthis.mover = new PhysicsInfo().load(view);\n\t\t\t\tbreak;\n\n\t\t\tcase MovementTypes.SPINNING:\n\t\t\t\tthis.mover = new SpinnerInfo().load(view);\n\t\t\t\tbreak;\n\n\t\t\tcase MovementTypes.NONE:\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"unknown MovementType: \" + this.movementType);\n\t\t}\n\n\t\tswitch (this.controlType) {\n\t\t\tcase ControlTypes.NONE:\t\t// 0,\t  // doesn't move (or change movement)\n\t\t\tcase ControlTypes.FLYING:\t// 4,\t  // the player is flying\n\t\t\tcase ControlTypes.SLEW:\t\t// 5,\t  // slewing\n\t\t\tcase ControlTypes.DEBRIS:\t// 12,\t  // this is a piece of debris\n\t\t\tcase ControlTypes.CNTRLCEN:\t// 16,\t  // the control center/main reactor\n\t\t\t\tbreak;\n\n\t\t\tcase ControlTypes.AI:\t\t// 1,\t  // driven by AI\n\n\t\t\t\tthis.control = {\n\t\t\t\t\tbehavior: view.getUint8(),\n\t\t\t\t\tflags: view.getUint8Array(MAX_AI_FLAGS),\n\t\t\t\t\thide_segment: view.getUint16(),\n\t\t\t\t\thide_index: view.getUint16(),\n\t\t\t\t\tpath_length: view.getUint16(),\n\t\t\t\t\tcur_path_index: view.getUint16(),\n\t\t\t\t};\n\t\t\t\tif (view.gameVersion <= 25) {\n\t\t\t\t\tview.getUint16();\t// follow_path_start_seg\n\t\t\t\t\tview.getUint16();\t// follow_path_end_seg\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase ControlTypes.POWERUP:\t// 13,\t  // animating powerup blob\n\n\t\t\tlet count = 1;\n\t\t\tif (view.gameVersion >= 25) {\n\t\t\t\t\tcount = view.getUint32();\n\t\t\t}\n\n\t\t\tswitch (this.id) {\n\t\t\t\t\tcase PowerupTypes.VULCAN_WEAPON:\n\t\t\t\t\tcase PowerupTypes.GAUSS_WEAPON:\n\t\t\t\t\t\tcount = VULCAN_WEAPON_AMMO_AMOUNT;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t// case PowerupTypes.OMEGA_WEAPON:\n\t\t\t\t\t// \tcount = 1;\n\t\t\t\t\t// \tbreak;\n\t\t\t\t}\n\n\t\t\tthis.control = { count };\n\t\t\tbreak;\n\n\t\t\tcase ControlTypes.WEAPON:\n\t\t\t\tthis.control = {\n\t\t\t\t\t\tparent_type: view.getInt16(),\n\t\t\t\t\t\tparent_num: view.getInt16(),\n\t\t\t\t\t\tparent_signature: view.getUint32(),\n\t\t\t\t\t};\n\t\t\t\tbreak;\n\n\t\t\t// case ControlTypes.WEAPON:\t\t// 9,\t  // laser, etc.\n\t\t\t// case ControlTypes.EXPLOSION:\t// 2,\t  // explosion sequencer\n\t\t\t// case ControlTypes.FLYTHROUGH:\t// 6,\t  // the flythrough system\n\t\t\t// case ControlTypes.REPAIRCEN:\t// 10,\t  // under the control of the repair center\n\t\t\t// case ControlTypes.MORPH:\t\t// 11,\t  // this CObject is being morphed\n\t\t\t// case ControlTypes.LIGHT:\t\t// 14,\t  // doesn't actually do anything\n\t\t\t// case ControlTypes.REMOTE:\t\t// 15,\t  // controlled by another net player\n\t\t\t// case ControlTypes.WAYPOINT:\t// 17,\n\t\t\t// case ControlTypes.CAMERA:\t\t// 18,\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"unknown ControlType: \" + this.controlType);\n\t\t}\n\n\t\tswitch (this.renderType) {\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"unknown RenderType: \" + this.renderType);\n\n\t\t\tcase RenderTypes.NONE:\t\t\t// 0,\t// does not render\n\t\t\tcase RenderTypes.LASER:\t\t\t// 3,\t// a laser\n\t\t\t\tbreak;\n\n\t\t\tcase RenderTypes.POLYOBJ:\t\t// 1,\t// a polygon model\n\t\t\tcase RenderTypes.MORPH:\t\t\t// 6,\t// a robot being morphed\n\t\t\t\tthis.renderInfo = new PolygonRenderInfo().load(view);\n\t\t\t\tbreak;\n\n\t\t\tcase RenderTypes.HOSTAGE:\t\t// 4,\t// a hostage\n\t\t\tcase RenderTypes.POWERUP:\t\t// 5,\t// a powerup\n\t\t\tcase RenderTypes.WEAPON_VCLIP:\t// 7,\t// a weapon that renders as a tVideoClip\n\t\t\t\t// case RenderTypes.FIREBALL:\t\t// 2,\t// a fireball\n\t\t\t\tthis.renderInfo = new LoopingVClipRenderInfo().load(view);\n\t\t\t\tbreak;\n\n\t\t\t// case RenderTypes.THRUSTER:\t// 8,\t// like afterburner, but doesn't cast light\n\t\t\t// case RenderTypes.EXPLBLAST:\t// 9,\t// white explosion light blast\n\t\t\t// case RenderTypes.SHRAPNELS:\t// 10,\t// smoke trails coming from explosions\n\t\t\t// case RenderTypes.SMOKE:\t\t// 11,\n\t\t\t// case RenderTypes.LIGHTNING:\t// 12,\n\t\t\t// case RenderTypes.SOUND:\t\t// 13,\n\t\t\t// case RenderTypes.SHOCKWAVE:\t// 14,\t// concentric shockwave effect\n\t\t}\n\n\t\treturn this;\n\t}\n\tisValid() {\n\t\tif (this.type === ItemTypes.NONE) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.flags & ItemFlags.SHOULD_BE_DEAD) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\tlink(cube: Cube | null) {\n\t\tconst cubeOld = this.cube;\n\t\tif (cubeOld === cube) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cubeOld) {\n\t\t\tassert(!this.isDead());\n\n\t\t\tconst index = this.cubeIndex;\n\t\t\tconst objectOther = cubeOld._rgObjects.pop();\n\t\t\tif (!objectOther) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t\tif (objectOther.cubeIndex !== cubeOld._rgObjects.length) {\n\t\t\t\tthrow new Error(\"wrong cube\");\n\t\t\t}\n\t\t\tif (this !== objectOther) {\n\t\t\t\tcubeOld._rgObjects[index] = objectOther;\n\t\t\t\tobjectOther.cubeIndex = index;\n\t\t\t}\n\t\t}\n\n\t\tif (cube) {\n\t\t\tthis.cube = cube;\n\t\t\tthis.iCube = cube.index;\n\t\t\tthis.cubeIndex = cube._rgObjects.length;\n\t\t\tcube._rgObjects.push(this);\n\t\t} else {\n\t\t\tthis.iCube = -1;\n\t\t\tthis.cubeIndex = -1;\n\t\t}\n\t}\n\tgetEmittedLight(time: number): Vec3 | null {\n\t\tlet intensity = 0;\n\t\tswitch (this.type) {\n\t\t\tcase ItemTypes.PLAYER:\n\t\t\t\tif (_player.flags & PlayerFlags.HEADLIGHT_ON) {\n\t\t\t\t\tintensity = HEADLIGHT_SCALE;\n\t\t\t\t} else {\n\t\t\t\t\tconst pi = this.mover as PhysicsInfo;\n\t\t\t\t\tconst k = pi.mass * pi.drag / (1 - pi.drag);\n\t\t\t\t\tintensity = Math.max(pi.velocity.len() * k / 4, 2) + 0.5;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.FIREBALL:\n\t\t\t\tif (this.id < 0) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst vclip: VClip = this.info;\n\t\t\t\tintensity = vclip.light_value;\n\n\t\t\t\tconst timeleft = this.deathTime - time;\n\t\t\t\tif (timeleft < 4) {\n\t\t\t\t\tintensity *= timeleft / vclip.play_time;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.ROBOT:\n\t\t\t\tconst rt: RobotType = this.info;\n\t\t\t\tintensity = rt.lightcast;\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.WEAPON:\n\t\t\t\tconst wi: WeaponInfo = this.info;\n\t\t\t\tintensity = wi.light;\n\t\t\t\t// if (this.id === WeaponTypes.FLARE)// TODO: flicker flares\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.POWERUP:\n\t\t\t\tconst powerupInfo: PowerupInfo = this.info;\n\t\t\t\tintensity = powerupInfo.light;\n\t\t\t\tbreak;\n\n\t\t\tcase ItemTypes.MARKER:\n\t\t\tcase ItemTypes.DEBRIS:\n\t\t\tcase ItemTypes.LIGHT:\n\t\t\t\tbreak;\n\n\t\t\t// default:\n\t\t\t// \tthrow new Error(\"unhandled type: \" + this.type);\n\t\t}\n\n\t\tif (intensity <= 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (intensity > 1) {\n\t\t\tintensity = 1;\n\t\t}\n\n\t\treturn Vec3.One.scale(intensity);\n\t}\n\tupdate(time: number, frameTime: number) {\n\t\tif (this.flags & ItemFlags.SHOULD_BE_DEAD) {\n\t\t\treturn false;\n\t\t}\n\n\t\tswitch (this.controlType) {\n\t\t\tcase ControlTypes.FLYING:\n\n\t\t\t\tconst ship = _ham.ship;\n\n\t\t\t\tconst pi = this.mover as PhysicsInfo;\n\t\t\t\tif (this.controls) {\n\t\t\t\t\tpi.thrust = this.orient.multiply(this.controls.thrust).scale(ship.max_thrust / frameTime);\n\t\t\t\t\tpi.rotthrust = this.controls.rot.scale(ship.max_rotthrust / frameTime);\n\t\t\t\t}\n\n\t\t\t\tif (pi.flags & PhysicsFlags.WIGGLE) {\n\t\t\t\t\tconst wiggle = Math.sin(time * Math.PI * 2) * ship.wiggle;\n\t\t\t\t\tpi.velocity = pi.velocity.addScale(this.orient._[1], wiggle);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase ControlTypes.POWERUP:\n\t\t\t\tbreak;\n\n\t\t\tcase ControlTypes.AI:\n\t\t\t\tthis.doAI(time, frameTime);\n\t\t\t\tbreak;\n\n\t\t\tcase ControlTypes.EXPLOSION:\n\t\t\t\tthis.doExplosion(time, frameTime);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (time >= this.deathTime || (this.flags & ItemFlags.SHOULD_BE_DEAD)) {\n\t\t\tswitch (this.controlType) {\n\t\t\t\tcase ControlTypes.POWERUP:\n\t\t\t\t\t// create explosion\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.mover) {\n\t\t\treturn this.mover.move(this, time, frameTime);\n\t\t}\n\n\t\treturn true;\n\t}\n\tdoAI(time: number, frameTime: number) {\n\t\t// do nothing\n\t}\n\trender(time: number) {\n\t\tif (this.type === ItemTypes.PLAYER) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.renderInfo) {\n\t\t\tthis.renderInfo.render(this, time);\n\t\t}\n\t}\n\tfireLaser(iWeapon: number, laser_level: number, cFires: number, fQuad: boolean) {\n\t\tswitch (iWeapon) {\n\t\t\tcase PrimaryWeaponIndex.LASER:\n\n\t\t\t\t// Laser_offset?\n\n\t\t\t\tlet weaponNum: number;\n\t\t\t\tif (laser_level <= MAX_LASER_LEVEL) {\n\t\t\t\t\tweaponNum = WeaponTypes.LASER + laser_level;\n\t\t\t\t} else {\n\t\t\t\t\tweaponNum = WeaponTypes.SUPER_LASER + laser_level - (MAX_LASER_LEVEL + 1);\n\t\t\t\t}\n\n\t\t\t\tthis.fireWeapon(weaponNum, 0, 0, 0, 0, true);\n\t\t\t\tthis.fireWeapon(weaponNum, 1);\n\n\t\t\t\tif (fQuad) {\n\t\t\t\t\tthis.fireWeapon(weaponNum, 2);\n\t\t\t\t\tthis.fireWeapon(weaponNum, 3);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tfireWeapon(laser_type: number, gun_num: number, spreadr?: number, spreadu?: number, delay?: number, make_sound = false, harmless: boolean = false) {\n\t\tconst wi = _ham.rgWeaponInfos[laser_type];\n\n\t\tconst ship = _ham.ship;\n\t\tconst pos = this.orient.transpose().rotate(ship.gun_points[gun_num]).add(this.pos);\n\t\tlet dir = this.direction;\n\n\t\t// if (delay)\n\t\t// \tpos = pos.sub(dir.scale(delay * wi.speed[_difficultyLevel]));\n\n\t\tif (spreadr) {\n\t\t\tdir = dir.addScale(this.orient._[0], spreadr);\n\t\t}\n\n\t\tif (spreadu) {\n\t\t\tdir = dir.addScale(this.orient._[0], spreadu);\n\t\t}\n\n\t\tconst obj = wi.createObject(this, pos, this.cube, dir);\n\t\tobj.multiplier = 1;\n\n\t\tif (this.type === ItemTypes.PLAYER) {\n\t\t\tif (laser_type >= WeaponTypes.LASER && laser_type <= MAX_SUPER_LASER_LEVEL) {\n\t\t\t\tobj.multiplier = 3 / 4;\n\t\t\t}\n\t\t}\n\n\t\t_level.rgObjects.push(obj);\n\n\t\tif (make_sound && wi.flash_sound >= 0) {\n\t\t\tif (this.type === ItemTypes.PLAYER) {\n\t\t\t\tthis.playSound(wi.flash_sound);\n\t\t\t} else {\n\t\t\t\t_ham.playSound(wi.flash_sound, pos);\n\t\t\t}\n\t\t}\n\t}\n\tcreateFireball(time: number, delay: number) {\n\t\tconst obj = this.cube.createExplosion(time, this.pos, 0, -1, delay);\n\t\tobj.control = {\n\t\t\tdelete_obj: this,\n\t\t\tspawn: true,\n\t\t};\n\t\treturn obj;\n\t}\n\tdoExplosion(time: number, frameTime: number) {\n\t\tconst control = this.control;\n\t\tif (control) {\n\t\t\tif (time >= this.deathTime) {\n\t\t\t\tconst del_obj: Item = control.delete_obj;\n\t\t\t\tif (control.spawn) {\n\t\t\t\t\tconst vclip = del_obj.getExplosionVClip(1);\n\t\t\t\t\tconst expl_obj = del_obj.cube.createExplosion(time, del_obj.pos, del_obj.size * (5 / 2), vclip);\n\n\t\t\t\t\tif (expl_obj && !(expl_obj.flags & ItemFlags.SHOULD_BE_DEAD)) {\n\t\t\t\t\t\texpl_obj.control = {\n\t\t\t\t\t\t\tdelete_time: (time + control.death_time) / 2,\n\t\t\t\t\t\t\tdelete_obj: del_obj,\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdel_obj.flags |= ItemFlags.SHOULD_BE_DEAD;\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO: drop stuff\n\n\t\t\t\t\tconst rt: RobotType = del_obj.info;\n\t\t\t\t\tif (rt.exp2_sound_num >= 0) {\n\t\t\t\t\t\t_ham.playSound(rt.exp2_sound_num, del_obj.pos);\n\t\t\t\t\t}\n\n\t\t\t\t\t// TODO: debris\n\t\t\t\t}\n\n\t\t\t\tif (control.delete_obj) {\n\t\t\t\t\tdel_obj.flags |= ItemFlags.SHOULD_BE_DEAD;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tgetExplosionVClip(stage: number): number {\n\t\tswitch (this.type) {\n\t\t\tcase ItemTypes.PLAYER:\n\t\t\t\tconst rt: RobotType = this.info;\n\t\t\t\tif (stage === 0 && rt.exp1_vclip_num >= 0) {\n\t\t\t\t\treturn rt.exp1_vclip_num;\n\t\t\t\t}\n\t\t\t\tif (stage === 1 && rt.exp2_vclip_num >= 0) {\n\t\t\t\t\treturn rt.exp2_vclip_num;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ItemTypes.ROBOT:\n\t\t\t\tif (_ham.ship.expl_vclip_num >= 0) {\n\t\t\t\t\treturn _ham.ship.expl_vclip_num;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn KnownVClips.SMALL_EXPLOSION;\n\t}\n\tplaySound(iSound: SoundFile_Sounds) {\n\t\t_ham.playObjectSound(iSound, this);\n\t}\n\t/*\n\tcollide(other: item)\n\t{\n\t\tconst mapCollisionHandlers = this.mapCollisionHandlers;\n\t\tif (!mapCollisionHandlers)\n\t\t\treturn;\n\n\t\tconst otherType = other.type;\n\t\tconst collisionHandler = mapCollisionHandlers[<any>otherType];\n\t\tif (!collisionHandler)\n\t\t\treturn;\n\n\t\treturn collisionHandler(other);\n\t}\n\t*/\n\n\tcollidePlayerHostage(time: number, pos: Vec3, other: Item): Item|null {\n\t\t// TODO: flags\n\t\t// TODO: increment hostage count\n\n\t\t_ham.playSound(SoundFile_Sounds.HOSTAGE_RESCUED);\n\t\treturn other;\n\t}\n\tcollidePlayerMarker(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollidePlayerClutter(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollidePlayerControlCenter(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollidePlayerPlayer(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollidePlayerPowerup(time: number, pos: Vec3, other: Item) {\n\t\tif (!_player.pickUpPowerup(other.id)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst pi: PowerupInfo = other.info;\n\t\tif (pi && pi.hit_sound) {\n\t\t\t_ham.playSound(pi.hit_sound);\n\t\t}\n\n\t\treturn other;\n\t}\n\tcollidePlayerWeapon(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollidePlayerRobot(time: number, pos: Vec3, other: Item): Item|null {\n\t\tconst pi = this.mover as PhysicsInfo;\n\t\tconst piOther = other.mover as PhysicsInfo;\n\n\t\tconst vel = pi.velocity;\n\t\tconst velOther = piOther.velocity;\n\n\t\tconst mass = pi.mass;\n\t\tconst massOther = piOther.mass;\n\n\t\tconst force = vel.addScale(velOther, -2 * mass * massOther / (mass + massOther));\n\n\t\tpiOther.velocity = velOther.addScale(force, 1 / piOther.mass);\n\n\t\tpi.velocity = vel.addScale(force, -1 / pi.mass);\n\n\t\treturn null;\n\t}\n\tcollideRobotControlCenter(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollideRobotRobot(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollideRobotWeapon(time: number, pos: Vec3, weapon: Item) {\n\t\tconst rt: RobotType = this.info;\n\t\tif (rt.exp1_vclip_num >= 0) {\n\t\t\tweapon.cube.createExplosion(time, pos, this.size * 3 / 8, rt.exp1_vclip_num);\n\t\t}\n\n\t\tif (rt.exp1_sound_num >= 0) {\n\t\t\t_ham.playSound(rt.exp1_sound_num, pos);\n\t\t}\n\n\t\tif (!(weapon.flags & ItemFlags.HARMLESS)) {\n\t\t\tconst damage = weapon.shields * weapon.multiplier;\n\t\t\tthis.damage(time, damage);\n\t\t}\n\n\t\treturn weapon;\n\t}\n\tdamage(time: number, damage: number): boolean {\n\t\tif (this.flags & ItemFlags.EXPLODING || this.shields < 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.shields -= damage;\n\n\t\tif (this.shields < 0) {\n\t\t\tif (this.type === ItemTypes.PLAYER) {\n\t\t\t\t// do nothing\n\t\t\t} else {\n\t\t\t\tconst rt: RobotType = this.info;\n\t\t\t\tconst delay = (rt.kamikaze) ? .01 : .25;\n\t\t\t\tthis.createFireball(time, delay);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\tcollideWeaponClutter(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollideWeaponControlCenter(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollideWeaponDebris(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\tcollideWeaponWeapon(time: number, pos: Vec3, other: Item): Item|null { return null; }\n\n\tisDead(): boolean {\n\t\treturn this.cubeIndex < 0;\n\t}\n\n}\n\n(() => {\n\tItem.mapCollisionHandlers[ItemTypes.HOSTAGE] = [];\n\tItem.mapCollisionHandlers[ItemTypes.MARKER] = [];\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER] = [];\n\tItem.mapCollisionHandlers[ItemTypes.ROBOT] = [];\n\tItem.mapCollisionHandlers[ItemTypes.WEAPON] = [];\n\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.HOSTAGE] = Item.prototype.collidePlayerHostage;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.MARKER] = Item.prototype.collidePlayerMarker;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.CLUTTER] = Item.prototype.collidePlayerClutter;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.CNTRLCEN] = Item.prototype.collidePlayerControlCenter;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.PLAYER] = Item.prototype.collidePlayerPlayer;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.POWERUP] = Item.prototype.collidePlayerPowerup;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.WEAPON] = Item.prototype.collidePlayerWeapon;\n\tItem.mapCollisionHandlers[ItemTypes.PLAYER][ItemTypes.ROBOT] = Item.prototype.collidePlayerRobot;\n\tItem.mapCollisionHandlers[ItemTypes.ROBOT][ItemTypes.CNTRLCEN] = Item.prototype.collideRobotControlCenter;\n\tItem.mapCollisionHandlers[ItemTypes.ROBOT][ItemTypes.ROBOT] = Item.prototype.collideRobotRobot;\n\tItem.mapCollisionHandlers[ItemTypes.ROBOT][ItemTypes.WEAPON] = Item.prototype.collideRobotWeapon;\n\tItem.mapCollisionHandlers[ItemTypes.WEAPON][ItemTypes.CLUTTER] = Item.prototype.collideWeaponClutter;\n\tItem.mapCollisionHandlers[ItemTypes.WEAPON][ItemTypes.CNTRLCEN] = Item.prototype.collideWeaponControlCenter;\n\tItem.mapCollisionHandlers[ItemTypes.WEAPON][ItemTypes.DEBRIS] = Item.prototype.collideWeaponDebris;\n\tItem.mapCollisionHandlers[ItemTypes.WEAPON][ItemTypes.WEAPON] = Item.prototype.collideWeaponWeapon;\n\n\tfor (const i in Item.mapCollisionHandlers) {\n\t\tif (!Item.mapCollisionHandlers.hasOwnProperty(i)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst mapCollisionHandlers = Item.mapCollisionHandlers[i];\n\t\tfor (const j in mapCollisionHandlers) {\n\t\t\tif (!mapCollisionHandlers.hasOwnProperty(j)) {\n\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet mapReversed = Item.mapCollisionHandlers[j];\n\t\t\tif (!mapReversed) {\n\t\t\t\tmapReversed = Item.mapCollisionHandlers[j] = [];\n\t\t\t}\n\t\t\tif (!mapReversed[i]) {\n\t\t\t\tmapReversed[i] = ((fn: (time: number, pos: Vec3, other: Item) => Item|null) => {\n\t\t\t\t\treturn function(this: Item, time: number, pos: Vec3, other: Item): Item|null {\n\t\t\t\t\t\treturn fn.call(other, time, pos, this);\n\t\t\t\t\t};\n\t\t\t\t})(Item.mapCollisionHandlers[i][j]);\n\t\t\t}\n\t\t}\n\t}\n\n})();\n","\"use strict\";\n\nclass BinaryHeap<T> {\n\telements: T[];\n\tcomparison: (e1: T, e2: T) => number;\n\n\tconstructor(comparison: (e1: T, e2: T) => number) {\n\t\tthis.elements = [];\n\t\tthis.comparison = comparison;\n\t}\n\tpush(element: T) {\n\t\tconst elements = this.elements;\n\t\t// Add the new element to the end of the array.\n\t\telements.push(element);\n\t\t// Allow it to bubble up.\n\t\tthis.bubbleUp(elements.length - 1);\n\t}\n\tpop() {\n\t\t// Store the first element so we can return it later.\n\t\treturn this.removeAt(0);\n\t}\n\tremoveAt(i: number) {\n\t\tconst elements = this.elements;\n\t\tif (!(i >= 0 && i < elements.length)) {\n\t\t\tthrow new Error(\"argument out of range: i\");\n\t\t}\n\n\t\tconst old = elements[i];\n\n\t\t// Get the element at the end of the array.\n\t\tconst end = elements.pop()!;\n\t\t// If there are any elements left, put the end element at the\n\t\t// start, and const it sink down.\n\t\tif (elements.length > 0) {\n\t\t\telements[i] = end;\n\t\t\tthis.sinkDown(i);\n\t\t}\n\n\t\treturn old;\n\t}\n\tremove(node: T) {\n\t\tconst i = this.indexOf(node);\n\t\tif (i >= 0) {\n\t\t\treturn this.removeAt(i);\n\t\t}\n\t\tthrow new Error(\"Node not found.\");\n\t}\n\tindexOf(node: T) {\n\t\tconst elements = this.elements;\n\n\t\tfor (let i = elements.length; i--;) {\n\t\t\tif (elements[i] === node) {\n\t\t\t\treturn i;\n\t\t}\n\t\t\t}\n\n\t\treturn -1;\n\t}\n\tlength() { return this.elements.length; }\n\n\tbubbleUp(n: number) {\n\t\t// Fetch the element that has to be moved.\n\t\tconst elements = this.elements;\n\t\tconst\telement = elements[n];\n\t\tconst comparison = this.comparison;\n\n\t\t// When at 0, an element can not go up any further.\n\t\twhile (n > 0) {\n\t\t\t// Compute the parent element's index, and fetch it.\n\t\t\tconst iParent = Math.floor((n + 1) / 2) - 1;\n\t\t\tconst\tparent = elements[iParent];\n\n\t\t\tif (comparison(element, parent) > 0) {\n\t\t\t\tbreak;\n\t\t\t} // Found a parent that is less, no need to move it further.\n\n\t\t\t// Swap the elements if the parent is greater.\n\t\t\telements[n] = parent;\n\t\t\tn = iParent;\n\t\t\telements[n] = element;\n\t\t}\n\t}\n\tsinkDown(n: number) {\n\t\t// Look up the target element and its score.\n\t\tconst elements = this.elements;\n\t\tconst length = elements.length;\n\t\tconst element = elements[n];\n\t\tconst comparison = this.comparison;\n\n\t\twhile (true) {\n\t\t\t// Compute the indices of the child elements.\n\t\t\tconst iLeft = 2 * n + 1;\n\t\t\tconst\tiRight = iLeft + 1;\n\n\t\t\tif (iLeft >= length) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet iMin = iLeft;\n\t\t\tif (iRight > length) {\n\t\t\t\tconst left = elements[iLeft];\n\t\t\t\tconst right = elements[iRight];\n\t\t\t\tif (comparison(left, right) > 0) {\n\t\t\t\t\tiMin = iRight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst min = elements[iMin];\n\n\t\t\tif (comparison(element, min) <= 0) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\telements[n] = min;\n\t\t\tn = iMin;\n\t\t\telements[n] = element;\n\t\t}\n\t}\n}\n","/// <reference path=\"DataView.ts\" />\n/// <reference path=\"DataStream.ts\" />\n/// <reference path=\"Math.ts\" />\n\n/// <reference path=\"webgl.ts\" />\n\n/// <reference path=\"Item.ts\" />\n/// <reference path=\"Ham.ts\" />\n\n/// <reference path=\"BinaryHeap.ts\" />\n\"use strict\";\n\nconst _rgrgSideVertexIndices =\n\t[\n\t\t[7, 6, 2, 3],\t\t\t// left\n\t\t[0, 4, 7, 3],\t\t\t// top\n\t\t[0, 1, 5, 4],\t\t\t// right\n\t\t[2, 6, 5, 1],\t\t\t// bottom\n\t\t[4, 5, 6, 7],\t\t\t// back\n\t\t[3, 2, 1, 0],\t\t\t// front\n\t];\n\nlet _bufferVertexTextureBrightness: WebGLBuffer;\nlet _bufferVertexLight: WebGLBuffer;\n\nclass Level {\n\tversion: number;\n\toffsetMine: number;\n\toffsetGame: number;\n\tpaletteName: string;\n\treactorTime: number;\n\treactorLife: number;\n\trgFlickeringLights: FlickeringLight[];\n\trgVertices: Vec3[];\n\tcubes: Cube[];\n\n\trgPOFNames: string[];\n\trgObjects: Item[];\n\trgRobotCenters: RobotCenter[];\n\n\tbufferVertexPosition: WebGLBuffer;\n\tbufferVertexLight: WebGLBuffer;\n\tbufferVertexTextureCoord: WebGLBuffer;\n\tbufferVertexTextureBrightness: WebGLBuffer;\n\n\tconstructor(view: DataView) {\n\t\tconst stream = new DataStream(view);\n\n\t\tstream.position = 0;\n\n\t\tconst magic = stream.getString(4);\n\t\tif (magic !== \"LVLP\") {\n\t\t\tthrow new Error(\"invalid level signature\");\n\t\t}\n\n\t\tthis.version = stream.getInt32();\n\t\tthis.offsetMine = stream.getInt32();\n\t\tthis.offsetGame = stream.getInt32();\n\n\t\tif (this.version >= 8) {\n\t\t\t// dummy data?\n\t\t\tstream.getInt32();\n\t\t\tstream.getUint16();\n\t\t\tstream.getInt8();\n\t\t}\n\n\t\tif (this.version < 5) {\n\t\t\tstream.getInt32();\n\t\t}\t// hostage text offset\n\n\t\tif (this.version > 1) {\n\t\t\tthis.paletteName = stream.getTerminatedString([\"\\0\", \"\\n\"], 11);\n\t\t}\n\t\t// TODO: default level palette\n\n\t\tif (this.version >= 3) {\n\t\t\tthis.reactorTime = stream.getInt32();\n\t\t} else {\n\t\t\tthis.reactorTime = 30;\n\t\t}\n\n\t\tif (this.version >= 4) {\n\t\t\tthis.reactorLife = stream.getInt32();\n\t\t}\n\n\t\tlet rgFlickeringLights: FlickeringLight[] | null = null;\n\t\tif (this.version >= 7) {\n\t\t\tconst cLights = stream.getInt32();\n\t\t\trgFlickeringLights = Array_iterate(cLights, () => new FlickeringLight().load(stream));\n\t\t}\n\n\t\tif (this.version >= 6) {\n\t\t\tstream.getInt32();\t// secret cube?\n\t\t}\n\n\t\tstream.position = this.offsetMine;\n\n\t\tconst compiledVersion = stream.getUint8();\n\n\t\tconst cVertices = stream.getUint16();\n\t\tconst cCubes = stream.getUint16();\n\n\t\tconst rgVertices = this.rgVertices = stream.getVectorArray(cVertices);\n\n\t\tconst _endCube = new Cube(-1);\n\n\t\tconst rgCubes = this.cubes = new Array<Cube>(cCubes);\n\n\t\tconst rgVertexPosition: number[] = [];\n\t\tconst rgVertexTextureCoord: number[] = [];\n\t\tconst rgVertexLight: number[] = [];\n\t\tconst rgVertexBrightness: number[] = [];\n\n\t\tfor (let iCube = 0; iCube < cCubes; ++iCube) {\n\t\t\t// console.log(\"cube \" + iCube);\n\n\t\t\tconst sideMask = stream.getUint8();\n\n\t\t\tconst cube = getCube(iCube);\n\n\t\t\tlet rgNeighbors: Cube[];\n\t\t\tif (this.version === 5) {\n\t\t\t\treadSpecial(cube, sideMask);\n\t\t\t\treadVertices(cube);\n\t\t\t\trgNeighbors = readChildren(sideMask);\n\t\t\t} else {\n\t\t\t\trgNeighbors = readChildren(sideMask);\n\t\t\t\treadVertices(cube);\n\t\t\t\tif (this.version <= 1) {\n\t\t\t\t\treadSpecial(cube, sideMask);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.version <= 5) {\n\t\t\t\tcube.static_light = fix(stream.getUint16() << 4);\n\t\t\t}\n\n\t\t\tconst rgSwitches = new Uint8Array(6);\n\n\t\t\tconst sideMask2 = stream.getUint8();\n\t\t\tfor (let iSide = 0; iSide < 6; ++iSide) {\n\t\t\t\tif (sideMask2 & (1 << iSide)) {\n\t\t\t\t\trgSwitches[iSide] = stream.getUint8();\n\t\t\t\t} else {\n\t\t\t\t\trgSwitches[iSide] = -1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let iSide = 0; iSide < 6; ++iSide) {\n\t\t\t\tconst rgSideVertexIndices = _rgrgSideVertexIndices[iSide];\n\t\t\t\tconst rgOtherVertices = rgSideVertexIndices.map((iVertex: number) => cube.rgVertices[iVertex]);\n\t\t\t\tconst neighbor = rgNeighbors[iSide];\n\t\t\t\tconst side = cube.rgSides[iSide] = new Side(cube, iSide, neighbor, rgOtherVertices);\n\n\t\t\t\tconst iSwitch = rgSwitches[iSide];\n\t\t\t\tif (iSwitch < 255 || !side.neighbor) {\n\t\t\t\t\tside.load(stream);\n\t\t\t\t\t// side.tmi = _ham.rgTMapInfos[side.tex1];\n\t\t\t\t\tside.iSwitch = iSwitch;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let iCube = 0; iCube < cCubes; ++iCube) {\n\t\t\tconst cube = this.cubes[iCube];\n\n\t\t\tif (this.version > 5) {\n\t\t\t\tcube.load2(stream);\n\t\t\t}\n\n\t\t\tfor (let iSide = 6; iSide--;) {\n\t\t\t\tconst side = cube.rgSides[iSide];\n\t\t\t\tside.initializeBuffers(rgVertexPosition, rgVertexLight, rgVertexTextureCoord, rgVertexBrightness);\n\t\t\t}\n\t\t}\n\n\t\t// initialize lighting cubes\n\n\t\tfor (let iCube = cCubes; iCube--;) {\n\t\t\tconst cube = this.cubes[iCube];\n\t\t\tconst radius2 = cube.radius * cube.radius;\n\n\t\t\tfor (let iCubeOther = cCubes; iCubeOther--;) {\n\t\t\t\tconst cubeOther = this.cubes[iCubeOther];\n\n\t\t\t\tconst minDistance = cube.radius + cubeOther.radius + LIGHT_DISTANCE_THRESHOLD;\n\n\t\t\t\tif (cube.center.distanceTo2(cubeOther.center) < minDistance * minDistance) {\n\t\t\t\t\tfor (let iSide = 6; iSide--;) {\n\t\t\t\t\t\tconst side = cube.rgSides[iSide];\n\n\t\t\t\t\t\tlet fFound = false;\n\n\t\t\t\t\t\tfor (let iSideVertex = 4; !fFound && iSideVertex--;) {\n\t\t\t\t\t\t\tconst sideVertex = side.vertices[iSideVertex];\n\n\t\t\t\t\t\t\tfor (let iVertexOtherCube = 8; !fFound && iVertexOtherCube--;) {\n\t\t\t\t\t\t\t\tconst vertexOtherCube = cubeOther.rgVertices[iVertexOtherCube];\n\n\t\t\t\t\t\t\t\tif (vertexOtherCube.distanceTo2(sideVertex) < LIGHT_DISTANCE_THRESHOLD * LIGHT_DISTANCE_THRESHOLD) {\n\t\t\t\t\t\t\t\t\tif (side.rgTriangles[0].distanceTo(vertexOtherCube) >= 0 &&\n\t\t\t\t\t\t\t\t\t\tside.rgTriangles[1].distanceTo(vertexOtherCube)) {\n\t\t\t\t\t\t\t\t\t\tfFound = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fFound) {\n\t\t\t\t\t\t\tside.rgLightingCubes.push(cubeOther);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.bufferVertexPosition = createBuffer(rgVertexPosition, 3);\n\t\tthis.bufferVertexLight = createDynamicBuffer(rgVertexLight, 3);\n\t\tthis.bufferVertexTextureCoord = createBuffer(rgVertexTextureCoord, 2);\n\t\tthis.bufferVertexTextureBrightness = createDynamicBuffer(rgVertexBrightness, 1);\n\n\t\t_bufferVertexTextureBrightness = this.bufferVertexTextureBrightness;\n\t\t_bufferVertexLight = this.bufferVertexLight;\n\n\t\tif (rgFlickeringLights) {\n\t\t\tfor (let iLight = rgFlickeringLights.length; iLight--;) {\n\t\t\t\tconst fl = rgFlickeringLights[iLight];\n\t\t\t\tconst side = this.getSide(fl.segnum, fl.sidenum);\n\t\t\t\tside.light = fl;\n\t\t\t}\n\t\t}\n\n\t\tstream.position = this.offsetGame;\n\n\t\tconst gameSig = stream.getUint16();\n\t\tif (gameSig !== 0x6705) {\n\t\t\tthrow new Error(\"invalid level game signature: \" + gameSig);\n\t\t}\n\n\t\tconst gameVersion = stream.getUint16();\n\t\tstream.gameVersion = gameVersion;\n\n\t\tstream.position += 31;\n\n\t\tconst offsetObjects = stream.getUint32();\n\t\tconst cObjects = stream.getUint32();\n\n\t\tstream.position += 8;\n\n\t\tconst cWalls = stream.getUint32();\n\n\t\tstream.position += 20;\n\n\t\tconst cTriggers = stream.getUint32();\n\n\t\tstream.position += 24;\n\n\t\tconst triggerSize = stream.getUint32();\n\n\t\tstream.position += 4;\n\n\t\tconst cRobotCenters = stream.getUint32();\n\n\t\tstream.position += 4;\n\n\t\tlet cStaticLights = 0;\n\t\tlet cDeltaLights: number = 0;\n\n\t\tif (gameVersion >= 29) {\n\t\t\tstream.position += 4;\n\t\t\tcStaticLights = stream.getUint32();\n\t\t\tstream.position += 8;\n\t\t\tcDeltaLights = stream.getUint32();\n\t\t\tstream.position += 4;\n\t\t}\n\n\t\tlet levelName: string;\n\t\tif (gameVersion >= 31) {\n\t\t\tlevelName = stream.getTerminatedString([\"\\n\"]);\n\t\t} else if (gameVersion >= 14) {\n\t\t\tlevelName = stream.getTerminatedString([\"\\0\"]);\n\t\t} else {\n\t\t\tlevelName = \"\";\n\t\t}\n\n\t\tif (gameVersion >= 19) {\n\t\t\tconst cPOFNames = stream.getUint16();\n\t\t\tif (cPOFNames !== 0x614d && cPOFNames !== 0x5547) {\n\t\t\t\tthis.rgPOFNames = Array_iterate(cPOFNames, (i: number): string => {\n\t\t\t\t\treturn stream.getTerminatedString([\"\\0\", \"\\n\"], 13);\n\t\t\t\t}) as string[];\n\t\t\t}\n\t\t}\n\n\t\tconst $this = this;\n\n\t\tif (offsetObjects >= 0) {\n\t\t\tstream.position = offsetObjects;\n\t\t\tthis.rgObjects = Array_iterate(cObjects, (iObject) => {\n\t\t\t\tconst obj = Item.load(stream);\n\t\t\t\tif (obj.type === ItemTypes.COOP) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst pos = obj.pos;\n\n\t\t\t\tlet cube = $this.getCube(obj.iCube);\n\t\t\t\tif (!cube.isPointInside(pos)) {\n\t\t\t\t\tconsole.log(\"object \" + iObject + \" outside cube \" + cube.index);\n\t\t\t\t\tconst foundCube = $this.findCubeContaining(pos);\n\t\t\t\t\tif (!foundCube) {\n\t\t\t\t\t\tthrow new Error(\"orphaned object\");\n\t\t\t\t\t}\n\t\t\t\t\tcube = foundCube;\n\t\t\t\t}\n\t\t\t\tobj.link(cube);\n\t\t\t\treturn obj;\n\t\t\t});\n\t\t}\n\n\t\tif (gameVersion < 20) {\n\t\t\tthrow new Error(\"level game info version not supported: \" + gameVersion);\n\t\t}\n\n\t\t// load walls\n\t\tconst rgWalls = Array_iterate(cWalls, () => new Wall().load(stream));\n\n\t\tif (gameVersion < 31) {\n\t\t\tthrow new Error(\"level game info version not supported: \" + gameVersion);\n\t\t}\n\n\t\t// load triggers\n\t\tconst rgTriggers = Array_iterate(cTriggers, () => new Trigger().load(stream));\n\n\t\tfor (let iTrigger = cTriggers; iTrigger--;) {\n\t\t\tconst trigger = rgTriggers[iTrigger];\n\t\t\ttrigger.rgSides = Array_iterate(trigger.num_links, (i) => $this.getSide(trigger.seg[i], trigger.side[i]));\n\t\t\t// delete trigger.seg;\n\t\t\t// delete trigger.side;\n\t\t}\n\n\t\tfor (let iWall = cWalls; iWall--;) {\n\t\t\tconst wall = rgWalls[iWall];\n\t\t\twall.iWall = iWall;\n\t\t\tconst side = this.getSide(wall.segnum, wall.sidenum);\n\n\t\t\tside.wall = wall;\n\t\t\tif (!wall.side) {\n\t\t\t\twall.side = side;\n\t\t\t}\n\n\t\t\tconst otherSide = side.otherSide;\n\t\t\tif (otherSide) {\n\t\t\t\tif (otherSide.wall) {\n\t\t\t\t\totherSide.wall.otherWall = wall;\n\t\t\t\t\twall.otherWall = otherSide.wall;\n\t\t\t\t} else {\n\t\t\t\t\totherSide.wall = wall;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (wall.linked_wall >= 0) {\n\t\t\t\twall.linked_wall = rgWalls[wall.linked_wall];\n\t\t\t}\n\n\t\t\tif (wall.iTrigger >= 0) {\n\t\t\t\t// console.log(iWall, wall.iTrigger);\n\t\t\t\twall.trigger = rgTriggers[wall.iTrigger];\n\t\t\t}\n\t\t}\n\n\t\tconst rgControlCenterTriggers = Array_iterate(1, () => new ControlCenterTrigger().load(stream));\n\n\t\t// read materialization centers\n\n\t\tif (gameVersion < 27) {\n\t\t\tthrow new Error(\"level game info version not supported: \" + gameVersion);\n\t\t}\n\n\t\tthis.rgRobotCenters = Array_iterate(cRobotCenters, () => new RobotCenter().load(stream));\n\n\t\tconst rgDeltaLightIndices: DeltaLightIndex[] = Array_iterate(cStaticLights, () => new DeltaLightIndex().load(stream));\n\t\tconst rgDeltaLights = Array_iterate(cDeltaLights, () => new DeltaLight().load(stream));\n\n\t\tfor (let iLight = rgDeltaLights.length; iLight--;) {\n\t\t\tconst dl = rgDeltaLights[iLight];\n\t\t\tconst side = this.getSide(dl.segnum, dl.sidenum);\n\t\t\tdl.side = side;\n\t\t}\n\n\t\tfor (let iLight = rgDeltaLightIndices.length; iLight--;) {\n\t\t\tconst lightIndex = rgDeltaLightIndices[iLight];\n\t\t\tconst side = this.getSide(lightIndex.segnum, lightIndex.sidenum);\n\t\t\tside.rgDeltaLights = Array_iterate(lightIndex.count, (i) => rgDeltaLights[lightIndex.index + i]) as DeltaLight[];\n\t\t}\n\n\t\tfunction getCube(i: number): Cube {\n\t\t\tlet cube = rgCubes[i];\n\t\t\tif (!cube) {\n\t\t\t\tcube = rgCubes[i] = new Cube(i);\n\t\t\t}\n\t\t\treturn cube;\n\t\t}\n\n\t\tfunction readChildren(sideMask: number): Cube[] {\n\t\t\tconst rgNeighbors = new Array<Cube>(6);\n\t\t\tfor (let iSide = 0; iSide < 6; ++iSide) {\n\t\t\t\tif (sideMask & (1 << iSide)) {\n\t\t\t\t\tconst iNeighbor = stream.getUint16();\n\t\t\t\t\tif (iNeighbor < cCubes) {\n\t\t\t\t\t\trgNeighbors[iSide] = getCube(iNeighbor);\n\t\t\t\t\t\t// console.log(\"cube \" + iCube + \" [\" + iSide + \"] -> \" + iNeighbor);\n\t\t\t\t\t} else if (iNeighbor === 65534) {\n\t\t\t\t\t\trgNeighbors[iSide] = _endCube;\n\t\t\t\t\t} else if (iNeighbor !== 65535) {\n\t\t\t\t\t\tthrow new Error(\"neighbor out of range\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn rgNeighbors;\n\t\t}\n\n\t\tfunction readVertices(cube: Cube) {\n\t\t\tlet center = Vec3.Zero;\n\t\t\tfor (let iVertex = 0; iVertex < 8; ++iVertex) {\n\t\t\t\tconst iCubeVertex = stream.getUint16();\n\t\t\t\tif (iCubeVertex >= cVertices) {\n\t\t\t\t\tthrow new Error(\"vertex index out of range\");\n\t\t\t\t}\n\t\t\t\tconst vertex = rgVertices[iCubeVertex];\n\t\t\t\tcube.rgVertices[iVertex] = vertex;\n\t\t\t\tcenter = center.add(vertex);\n\t\t\t}\n\t\t\tcube.center = center = center.scale(1.0 / 8.0);\n\n\t\t\tlet radius2 = 0;\n\t\t\tfor (let iVertex = 0; iVertex < 8; ++iVertex) {\n\t\t\t\tconst dist2 = center.distanceTo2(cube.rgVertices[iVertex]);\n\t\t\t\tif (radius2 < dist2) {\n\t\t\t\t\tradius2 = dist2;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcube.radius = Math.sqrt(radius2);\n\t\t}\n\n\t\tfunction readSpecial(cube: Cube, sideMask: number) {\n\t\t\tif (sideMask & (1 << 6)) {\n\t\t\t\tcube.special = stream.getUint8();\n\t\t\t\tcube.iMatCen = stream.getInt8();\n\t\t\t\tcube.value = stream.getInt8();\n\t\t\t\tstream.getInt8();\t// skip\n\t\t\t\t// console.log(\"cube \" + iCube + \" special: \", cube.special, cube.iMatCen, cube.value);\n\t\t\t}\n\t\t}\n\t}\n\tgetCube(iCube: number) {\n\t\tif (!(iCube >= 0 && iCube < this.cubes.length)) {\n\t\t\tthrow new Error(\"cube index out of range: \" + iCube);\n\t\t}\n\t\treturn this.cubes[iCube];\n\t}\n\tgetSideByIndex(index: SideIndex) {\n\t\treturn this.getSide(index.iCube, index.iSide);\n\t}\n\tgetSide(iCube: number, iSide: number) {\n\t\tconst cube = this.getCube(iCube);\n\t\tif (!(iSide >= 0 && iSide < 6)) {\n\t\t\tthrow new Error(\"side index out of range: \" + iSide);\n\t\t}\n\t\treturn cube.rgSides[iSide];\n\t}\n\tfindCubeContaining(pt: Vec3): Cube | null {\n\t\tconst cubes = this.cubes;\n\t\tfor (let iCube = cubes.length; iCube--;) {\n\t\t\tconst cube = cubes[iCube];\n\t\t\tif (cube.isPointInside(pt)) {\n\t\t\t\treturn cube;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tupdate(time: number, frameTime: number) {\n\t\tconst rgObjects = this.rgObjects;\n\t\tfor (let iObject = rgObjects.length; iObject--;) {\n\t\t\tconst object = rgObjects[iObject];\n\t\t\tif (!object.update(time, frameTime)) {\n\t\t\t\tobject.link(null);\n\t\t\t\trgObjects.swapOut(iObject);\n\t\t\t}\n\t\t}\n\n\t\tthis.cleanObjects();\n\n\t\tfor (let iDoor = _rgActiveDoors.length; iDoor--;) {\n\t\t\tconst door = _rgActiveDoors[iDoor];\n\t\t\tif (!door.updateDoor(time, frameTime)) {\n\t\t\t\t_rgActiveDoors.swapOut(iDoor);\n\t\t\t}\n\t\t}\n\t}\n\tcleanObjects() {\n\t\tconst rgObjects = this.rgObjects;\n\t\tfor (let iObject = rgObjects.length; iObject--;) {\n\t\t\tconst object = rgObjects[iObject];\n\t\t\tif (object.isDead()) {\n\t\t\t\t//object.link(null);\n\t\t\t\trgObjects.swapOut(iObject);\n\t\t\t}\n\t\t}\n\t}\n}\nconst _rgActiveDoors: Wall[] = [];\n\nlet LIGHT_DISTANCE_THRESHOLD = 80;\n\n// values for special field\nenum CubeFlags {\n\tIS_NOTHING = 0,\n\tIS_FUELCEN = 1,\n\tIS_REPAIRCEN = 2,\n\tIS_CONTROLCEN = 3,\n\tIS_ROBOTMAKER = 4,\n\tIS_GOAL_BLUE = 5,\n\tIS_GOAL_RED = 6,\n\tMAX_CENTER_TYPES = 7,\n\n\tAMBIENT_WATER = 8,\n\tAMBIENT_LAVA = 9,\n}\nclass Cube {\n\n\trgVertices = new Array<Vec3>(8);\n\trgSides = new Array<Side>(6);\n\tcenter: Vec3;\n\tradius: number;\n\n\tspecial: CubeFlags;\n\tmatcen_num: number;\n\tvalue: number;\n\tstatic_light = 1;\n\tiMatCen: number;\n\n\trgVisibleNeighbors: Cube[];\n\trgLightingNeighbors: Cube[];\n\trgVisibleSides: Side[];\n\trgVisibleSidesBlended: Side[];\n\trgLightingSides: Side[];\n\n\t_unique = (__unique++).toString();\n\t_rgObjects: Item[] = [];\n\n\tconstructor(public index: number) {\n\t}\n\tload2(stream: DataStream) {\n\t\tthis.special = stream.getUint8();\n\t\tthis.matcen_num = stream.getUint8();\n\t\tthis.value = stream.getUint8();\n\t\tthis.special |= (stream.getUint8() << 8);\n\t\tthis.static_light = stream.getFixed();\n\t}\n\tisPointInside(pt: Vec3) {\n\t\tconst rgSides = this.rgSides;\n\t\tfor (let iSide = 6; iSide--;) {\n\t\t\tconst side = rgSides[iSide];\n\t\t\tif (side && !side.isPointInside(pt)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\trender(time: number, fWireframe: boolean) {\n\t\tconst rgSides = this.rgSides;\n\t\tfor (let iSide = 6; iSide--;) {\n\t\t\tconst side = rgSides[iSide];\n\t\t\tside.render(time, fWireframe);\n\t\t}\n\t}\n\trenderObjects(time: number, viewPlane?: Plane3) {\n\t\tconst rgObjects = this._rgObjects;\n\t\tfor (let iObject = rgObjects.length; iObject--;) {\n\t\t\tconst obj: Item = rgObjects[iObject];\n\t\t\tif (viewPlane && viewPlane.distanceTo(obj.pos) < 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tobj.render(time);\n\t\t}\n\t}\n\t/*\n\tgetVisibleNeighbors ()\n\t{\n\t\tif (this.rgVisibleNeighbors)\n\t\t\treturn this.rgVisibleNeighbors;\n\n\t\tconst rgVisible = [];\n\t\tconst mapVisible = {};\n\n\t\tconst rgVisibleSides = [];\n\t\tconst rgVisibleSidesBlended = [];\n\t\tconst mapVisibleSides = {};\n\n\t\tconst mapVisited = {};\n\t\tconst rgVisited = [];\n\n\t\tconst rgDebug;// = this.rgDebug = [];\n\n\t\tconst root = this;\n\n\t\t// const iSide = this.rgSides.concat().sort((s1, s2) => { return s2.rgTriangles[0].normal.z - s1.rgTriangles[0].normal.z; })[0].index;\n\t\tfor (let iSide = 6; iSide--;)\n\t\t{\n\t\t\tconst side = this.rgSides[iSide];\n\t\t\tconst rgVertices = side.vertices;\n\n\t\t\tconst rgEdges = new Array (4);\n\t\t\tconst rgReverses = new Array (4);\n\n\t\t\tfor (let iEdge = 4; iEdge--;)\n\t\t\t{\n\t\t\t\tconst edge = new LineSegment(rgVertices[iEdge], rgVertices[(iEdge + 1) % 4]);\n\t\t\t\trgEdges[iEdge] = edge\n\t\t\t\trgReverses[iEdge] = Plane3.fromPoints(edge.start, rgVertices[(iEdge + 3) % 4], edge.end);\n\t\t\t\trgReverses[iEdge].normal = rgReverses[iEdge].normal.unit();\n\t\t\t}\n\n\t\t\tconst recurse = function (cube, rgPlanes, depth)\n\t\t\t{\n\t\t\t\tif (depth > 25)\n\t\t\t\t\treturn;\n\n\t\t\t\tmapVisited[cube._unique] = true;\n\n\t\t\t\tif (!mapVisible[cube.index])\n\t\t\t\t{\n\t\t\t\t\tmapVisible[cube.index] = cube;\n\t\t\t\t\trgVisible.push(cube);\n\t\t\t\t}\n\n\t\t\t\tfor (let iOtherSide = 6; iOtherSide--;)\n\t\t\t\t{\n\t\t\t\t\tconst otherSide = cube.rgSides[iOtherSide];\n\t\t\t\t\tconst neighbor = otherSide.neighbor;\n\n\t\t\t\t\tif (neighbor)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (mapVisited[neighbor._unique])\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (mapVisibleSides[otherSide._unique])\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\trgVisited.push(otherSide);\n\n\t\t\t\t\tconst minPlanes = new Array(4);\n\n\t\t\t\t\tconst debug;\n\t\t\t\t\tif (rgDebug)\n\t\t\t\t\t{\n\t\t\t\t\t\tdebug = {\n\t\t\t\t\t\t\tcube: cube,\n\t\t\t\t\t\t\tdepth: depth,\n\t\t\t\t\t\t\tside: otherSide,\n\t\t\t\t\t\t\tplanes: rgPlanes.concat(),\n\t\t\t\t\t\t\trgVisited: rgVisited.concat(),\n\t\t\t\t\t\t\trgEdges: rgEdges.concat(),\n\t\t\t\t\t\t\trgFront: [],\n\t\t\t\t\t\t\trgBehind: [],\n\t\t\t\t\t\t\trgNewStarts: [],\n\t\t\t\t\t\t\tminPlanes: minPlanes,\n\t\t\t\t\t\t\textents: [],\n\t\t\t\t\t\t\treverses: rgReverses,\n\t\t\t\t\t\t\tcallback () { recurse(cube, rgPlanes, depth); };\n\t\t\t\t\t\t}\n\t\t\t\t\t\trgDebug.push(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst rgOtherVertices = otherSide.vertices;\n\t\t\t\t\tconst fOutside = false;\n\t\t\t\t\tconst fFrontSide = false;\n\t\t\t\t\tfor (let iEdge = 4; iEdge--;)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst edge = rgEdges[iEdge];\n\t\t\t\t\t\tconst vertex = edge.start;\n\t\t\t\t\t\tif (true || otherSide.rgTriangles[0].distanceTo(vertex) >= 0 ||\n\t\t\t\t\t\t\totherSide.rgTriangles[1].distanceTo(vertex) >= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst minPlane = rgReverses[iEdge];\n\n\t\t\t\t\t\t\tconst plane = rgPlanes[iEdge];\n\t\t\t\t\t\t\tconst extent;\n\n\t\t\t\t\t\t\tconst fFront = false;\n\t\t\t\t\t\t\tconst fBehind = false;\n\n\t\t\t\t\t\t\tfor (let iVertex = 4; iVertex--;)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst vertexOther = rgOtherVertices[iVertex];\n\n\t\t\t\t\t\t\t\tif (plane.distanceTo(vertexOther) < 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfBehind = true;\n\t\t\t\t\t\t\t\t\tif (fFront)\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfFront = true;\n\t\t\t\t\t\t\t\t\tif (fBehind)\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tif (minPlane.distanceTo(vertexOther) < -.0001)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tminPlane = new Plane3(vertex, edge.direction.cross(vertexOther.sub(vertex)).unit());\n\t\t\t\t\t\t\t\t\t\textent = vertexOther;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (debug)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdebug.rgFront[iEdge] = fFront;\n\t\t\t\t\t\t\t\tdebug.rgBehind[iEdge] = fBehind;\n\t\t\t\t\t\t\t\tdebug.extents[iEdge] = extent;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (fBehind)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (fFront)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tminPlane = plane;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (debug)\n\t\t\t\t\t\t\t\t\t\tdebug.iOutside = iEdge;\n\t\t\t\t\t\t\t\t\tfOutside = true;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tminPlanes[iEdge] = minPlane;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst newStart = edge.intersectPlane(otherSide.rgTriangles[0]);\n\t\t\t\t\t\t\tif (newStart)\n\t\t\t\t\t\t\t\tminPlanes[iEdge] = new Plane3(newStart, otherSide.rgTriangles[0].normal.unit().neg());\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tminPlanes[iEdge] = rgReverses[iEdge].reverse();\n\n\t\t\t\t\t\t\tif (debug)\n\t\t\t\t\t\t\t\tdebug.rgNewStarts[iEdge] = newStart;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!fOutside)\n\t\t\t\t\t{\n\t\t\t\t\t\t// if (minPlanes[0].normal.dot(minPlanes[1].normal) > 0)\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tdebug.reject = \"0/2\";\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t// if (minPlanes[2].normal.dot(minPlanes[3].normal) > 0)\n\t\t\t\t\t\t// {\n\t\t\t\t\t\t// \tdebug.reject = \"1/3\";\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t// else\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!mapVisibleSides[otherSide._unique])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmapVisibleSides[otherSide._unique] = otherSide;\n\t\t\t\t\t\t\t\tif (neighbor)\n\t\t\t\t\t\t\t\t\trgVisibleSidesBlended.push(otherSide);\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\trgVisibleSides.push(otherSide);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (neighbor)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst tmpDebug = rgDebug;\n\t\t\t\t\t\t\t\tif (rgDebug)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst childDebug = [];\n\t\t\t\t\t\t\t\t\tdebug.children = childDebug\n\t\t\t\t\t\t\t\t\trgDebug = childDebug;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\trecurse(neighbor, minPlanes, depth + 1);\n\n\t\t\t\t\t\t\t\trgDebug = tmpDebug;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\trgVisited.pop();\n\t\t\t\t}\n\n\t\t\t\tdelete mapVisited[cube._unique];\n\t\t\t}\n\n\t\t\tconst rgDebugTmp = rgDebug;\n\t\t\tif (rgDebug)\n\t\t\t{\n\t\t\t\trgDebug = [];\n\t\t\t\tconst debug = {\n\t\t\t\t\tcube: this,\n\t\t\t\t\tside: side,\n\t\t\t\t\tdepth: -1,\n\t\t\t\t\tchildren: rgDebug,\n\t\t\t\t}\n\t\t\t\trgDebugTmp.push(debug);\n\t\t\t}\n\n\t\t\tconst rgInits = rgReverses.map((p) => { return p.reverse(); });\n\t\t\trecurse(this, rgInits, 1);\n\n\t\t\trgDebug = rgDebugTmp;\n\t\t}\n\t\t// console.log(rgVisibleSides.length);\n\n\t\t// function compareSides(side1, side2)\n\t\t// {\n\t\t// \tconst tex1 = side1.tex2;\n\t\t// \tconst tex2 = side2.tex2;\n\t\t// \tif (tex1 !== tex2)\n\t\t// \t{\n\t\t// \t\tif (tex1 === undefined)\n\t\t// \t\t\treturn -1;\n\t\t// \t\tif (tex2 === undefined)\n\t\t// \t\t\treturn 1;\n\t\t// \t\treturn tex1 - tex2;\n\t\t// \t}\n\n\t\t// \treturn side1.tex1 - side2.tex1;\n\t\t// }\n\n\t\t// rgVisibleSides.sort(compareSides);\n\t\t// rgVisibleSidesBlended.sort(compareSides);\n\n\t\tthis.rgVisibleNeighbors = rgVisible;\n\t\tthis.rgVisibleSides = rgVisibleSides;\n\t\tthis.rgVisibleSidesBlended = rgVisibleSidesBlended;\n\n\t\treturn rgVisible;\n\t}\n\tgetLightingNeighbors ()\n\t{\n\t\tconst rgLightingNeighbors = this.rgLightingNeighbors;\n\t\tif (rgLightingNeighbors)\n\t\t\treturn rgLightingNeighbors;\n\n\t\tconst center = this.center;\n\t\tconst LIGHT_DISTANCE_THRESHOLD2 = LIGHT_DISTANCE_THRESHOLD * LIGHT_DISTANCE_THRESHOLD;\n\n\t\tconst rgLightingNeighbors = [];\n\n\t\tconst rgVisibleNeighbors = this.getVisibleNeighbors();\n\t\tfor (let iVisible = rgVisibleNeighbors.length; iVisible--;)\n\t\t{\n\t\t\tconst cube = rgVisibleNeighbors[iVisible];\n\t\t\tif (cube === this)\n\t\t\t\tcontinue;\n\t\t\tif (center.distanceTo2(cube.center) < LIGHT_DISTANCE_THRESHOLD2)\n\t\t\t\trgLightingNeighbors.push(cube);\n\t\t}\n\n\t\tthis.rgLightingNeighbors = rgLightingNeighbors;\n\t\treturn rgLightingNeighbors;\n\t}\n\t*/\n\n\taddStaticLight(value: number) {\n\t\tif (!value) {\n\t\t\treturn;\n\t\t}\n\t\tthis.static_light += value;\n\n\t\tconst center = this.center;\n\t\tconst rgVisibleNeighbors = this.rgVisibleNeighbors;\n\t\tfor (let iVisible = rgVisibleNeighbors.length; iVisible--;) {\n\t\t\tconst cube = rgVisibleNeighbors[iVisible];\n\t\t\tlet distance = center.distanceTo(cube.center);\n\t\t\tif (distance < 1) {\n\t\t\t\tdistance = 1;\n\t\t\t}\n\t\t\tcube.static_light += value / distance;\n\t\t}\n\t}\n\tbounce(line: LineSegment, size: number): Bounce|null {\n\t\tlet bestBounce: Bounce|null = null;\n\t\tfor (let iSide = 6; iSide--;) {\n\t\t\tconst side = this.rgSides[iSide];\n\t\t\tconst bounce = side.bounce(line, size);\n\t\t\tif (bounce) {\n\t\t\t\tif (!bestBounce || bestBounce.distance > bounce.distance) {\n\t\t\t\t\tbestBounce = bounce;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (bestBounce) {\n\t\t\tbestBounce.cube = this;\n\t\t}\n\n\t\treturn bestBounce;\n\t}\n\tcheckExit(line: LineSegment): Side | null {\n\t\tfor (let iSide = 6; iSide--;) {\n\t\t\tconst side = this.rgSides[iSide];\n\t\t\tif (side.checkExit(line)) {\n\t\t\t\treturn side;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tcreateExplosion(time: number, pos: Vec3, size: number, vclip: number, duration?: number) {\n\t\tconst renderType: RenderTypes = (vclip >= 0) ? RenderTypes.FIREBALL : RenderTypes.NONE;\n\n\t\tconst obj = this.createObject(ItemTypes.FIREBALL, vclip, ControlTypes.EXPLOSION, renderType, MovementTypes.NONE, pos, size);\n\t\tobj.creationTime = time;\n\t\tif (vclip >= 0) {\n\t\t\tobj.renderInfo = new OneShotVClipRenderInfo(vclip);\n\t\t\tobj.deathTime = time + _ham.rgVClips[vclip].play_time;\n\t\t} else if (duration) {\n\t\t\tobj.deathTime = duration;\n\t\t} else {\n\t\t\t// TODO: huh?\n\t\t}\n\n\t\t// TODO: damage other objects\n\n\t\treturn obj;\n\t}\n\tcreateObject(type: ItemTypes, id: number, controlType: ControlTypes, renderType: RenderTypes, movementType: MovementTypes, pos: Vec3, size: number) {\n\t\tconst obj = new Item(type, id);\n\t\tobj.pos = pos;\n\t\tobj.size = size;\n\t\tobj.controlType = controlType;\n\t\tobj.renderType = renderType;\n\t\tobj.movementType = movementType;\n\t\tobj.link(this);\n\t\t_level.rgObjects.push(obj);\n\t\treturn obj;\n\t}\n}\nclass CubePos {\n\tpos: Vec3;\n\tF: number;\n\tG: number;\n\tH: number;\n\tprev: CubePos | null;\n\n\tconstructor(public cube: Cube, pos?: Vec3) {\n\t\tif (!cube) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tif (!pos) {\n\t\t\tthis.pos = cube.center;\n\t\t}\n\t}\n\n\tcreatePathTo(dest: CubePos): CubePos[]|null {\n\t\tconst queueNext = new BinaryHeap(comparePos);\n\t\tconst mapNext: { [index: string]: CubePos } = {};\n\t\tconst mapVisited: { [index: string]: CubePos } = {};\n\n\t\tthis.G = 0;\n\t\tthis.prev = null;\n\t\tqueueNext.push(this);\n\n\t\twhile (queueNext.length() > 0) {\n\t\t\tlet posCurrent: CubePos|null = queueNext.pop();\n\t\t\tconst cubeCurrent = posCurrent.cube;\n\n\t\t\tif (cubeCurrent === dest.cube) {\n\t\t\t\tconst result: CubePos[] = [];\n\t\t\t\tfor (; posCurrent; posCurrent = posCurrent.prev) {\n\t\t\t\t\tresult.push(posCurrent);\n\t\t\t\t}\n\t\t\t\tresult.reverse();\n\t\t\t\tresult.push(dest);\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tmapVisited[cubeCurrent._unique] = posCurrent;\n\t\t\tfor (let iSide = 6; iSide--;) {\n\t\t\t\tconst side = cubeCurrent.rgSides[iSide];\n\t\t\t\tconst cubeNeighbor = side.neighbor;\n\t\t\t\tif (cubeNeighbor) {\n\t\t\t\t\tif (mapVisited[cubeNeighbor._unique]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\t// TODO shorten path?\n\n\t\t\t\t\tif (side.getDoorwayFlags() & WID.FLY) {\n\t\t\t\t\t\tconst G = posCurrent.G + posCurrent.pos.distanceTo2(cubeNeighbor.center);\n\n\t\t\t\t\t\tlet posNeighbor = mapNext[cubeNeighbor._unique];\n\t\t\t\t\t\tif (posNeighbor) {\n\t\t\t\t\t\t\tif (posNeighbor.G > G) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tqueueNext.remove(posNeighbor);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tposNeighbor = new CubePos(cubeNeighbor, cubeNeighbor.center);\n\t\t\t\t\t\t\tposNeighbor.H = cubeNeighbor.center.distanceTo2(dest.pos);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tposNeighbor.prev = posCurrent;\n\t\t\t\t\t\tposNeighbor.G = G;\n\t\t\t\t\t\tposNeighbor.F = G + posNeighbor.H;\n\n\t\t\t\t\t\tqueueNext.push(posNeighbor);\n\t\t\t\t\t\tmapNext[cubeNeighbor._unique] = posNeighbor;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\n\t\tfunction comparePos(p1: CubePos, p2: CubePos) {\n\t\t\treturn p1.F - p2.F;\n\t\t}\n\t}\n\tbounce(to: Vec3, size = 0): Bounce|null {\n\t\tlet pos = this.pos;\n\t\tlet cube = this.cube;\n\t\twhile (true) {\n\t\t\tconst line = new LineSegment(pos, to);\n\t\t\tconst bounce = cube.bounce(line, size);\n\t\t\tif (!bounce || bounce.distance > line.length) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst side = bounce.side;\n\t\t\tif (side.isSolid()) {\n\t\t\t\treturn bounce;\n\t\t\t}\n\n\t\t\tcube = side.neighbor;\n\t\t\tpos = bounce.anchor;\n\t\t}\n\n\t\treturn null;\n\t}\n}\nenum WID {\n\tFLY = (1 << 0),\n\tRENDER = (1 << 1),\n\tRENDPAST = (1 << 2),\n\tEXTERNAL = (1 << 3),\n\tCLOAKED = (1 << 4),\n\n\tWALL = RENDER,                                // wall\n\tTRANSPARENT_WALL = RENDER | RENDPAST,         // transparent wall\n\tILLUSORY_WALL = RENDER | FLY,                 // illusory wall\n\tTRANSILLUSORY_WALL = RENDER | FLY | RENDPAST, // transparent illusory wall\n\tNO_WALL = RENDPAST | FLY,                     // no wall, can fly through\n\n}\nconst _rgOrientMatrices = [\n\tMat3.I,\n\tMat3.I.translate2d(-.5, -.5).rotate2d(-3 * Math.PI / 2).translate2d(.5, .5),\n\tMat3.I.translate2d(-.5, -.5).rotate2d(-Math.PI).translate2d(.5, .5),\n\tMat3.I.translate2d(-.5, -.5).rotate2d(-Math.PI / 2).translate2d(.5, .5),\n].map((m) => m.transpose());\n\nclass SideIndex {\n\tconstructor(public iCube: number, public iSide: number) {\n\t}\n}\n\n/*\ninterface WebGLRenderingContext\n{\n    uniform1fv(location: WebGLUniformLocation, v: number[]): void;\n    uniform1iv(location: WebGLUniformLocation, v: number[]): void;\n    uniform2fv(location: WebGLUniformLocation, v: number[]): void;\n    uniform2iv(location: WebGLUniformLocation, v: number[]): void;\n    uniform3fv(location: WebGLUniformLocation, v: number[]): void;\n    uniform3iv(location: WebGLUniformLocation, v: number[]): void;\n    uniform4fv(location: WebGLUniformLocation, v: number[]): void;\n    uniform4iv(location: WebGLUniformLocation, v: number[]): void;\n    uniformMatrix2fv(location: WebGLUniformLocation, transpose: boolean, value: number[]): void;\n    uniformMatrix3fv(location: WebGLUniformLocation, transpose: boolean, value: number[]): void;\n    uniformMatrix4fv(location: WebGLUniformLocation, transpose: boolean, value: number[]): void;\n}\n*/\n\nclass Side {\n\tstatic _updateBrightnessItems: Float32Array = new Float32Array(4);\n\tstatic _updateLightItems: Float32Array = new Float32Array(4 * 3);\n\n\tstatic_light = 1;\n\tdeltaLight = 1;\n\trgDeltaLight: number[] = [1, 1, 1, 1];\n\ttex2Orient = 0;\n\tbrightness = 1;\n\tupdateBrightness = false;\n\n\tvertexOffset: number;\n\trgTriangles: Triangle[];\n\tconvex: boolean;\n\tnormal: Vec3;\n\tcenter: Vec3;\n\n\tiSwitch: number;\n\n\totherSide: Side;\n\twall: Wall;\n\totherWall: Wall;\n\n\tprogram: WebGLProgram;\n\tiVertex: number;\n\trgUV: Vec2[];\n\trgL: Float32Array;\n\n\ttex1: number;\n\ttmi1: TMapInfo;\n\ttex2: number;\n\ttmi2: TMapInfo;\n\n\trgDeltaLights: DeltaLight[];\n\n\trgVertexLight = new Array<Vec3 | null>(4);\n\tupdateLight: boolean;\n\n\tlight: FlickeringLight;\n\trgLightingCubes: Cube[] = [];\n\n\t_unique: string;\n\n\tcubeIndex: { iCube: number, iSide: number };\n\n\tconstructor(public cube: Cube, public index: number, public neighbor: Cube, public vertices: Vec3[]) {\n\t\tthis._unique = (__unique++).toString();\n\n\t\t/*\n\t\t\tconst n1 = rgOtherVertices [0].planeNormal (rgOtherVertices [1], rgOtherVertices [2]);\n\t\t\tconst distToPlane = rgOtherVertices [3].distanceToPlane (rgOtherVertices [0], n1);\n\n\t\t\tif (distToPlane < 250)\n\t\t\t{\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t}\n\t\t*/\n\n\t\tlet sum = Vec3.Zero;\n\t\tfor (let i = 4; i--;) {\n\t\t\tsum = sum.add(vertices[i]);\n\t\t}\n\t\tthis.center = sum.scale(1 / 4);\n\t}\n\tgetIndex() {\n\t\treturn new SideIndex(this.cube.index, this.index);\n\t}\n\tload(stream: DataStream) {\n\t\tconst tex1 = stream.getUint16();\n\t\tif (tex1 & (1 << 15)) {\n\t\t\tthis.setTex2(stream.getUint16(), true);\n\t\t}\n\n\t\tthis.setTex1(tex1 & ~(1 << 15));\n\n\t\tthis.rgUV = new Array<Vec2>(4);\n\t\tthis.rgL = new Float32Array(4);\n\n\t\tfor (let iVertex = 0; iVertex < 4; ++iVertex) {\n\t\t\tthis.rgUV[iVertex] = new Vec2(fix(stream.getInt16()) * 32, fix(stream.getInt16()) * 32);\n\t\t\tthis.rgL[iVertex] = fix(stream.getUint16() << 1);\n\t\t}\n\n\t\t// this.createBuffers();\n\t}\n\t/*\n\tcreateBuffers ()\n\t{\n\t\tif (this.tex2 >= 0)\n\t\t\tthis.program = programDouble;\n\t\telse\n\t\t\tthis.program = programSingle;\n\n\t\tconst rgVertexPosition = [];\n\t\tconst rgVertexTextureCoord = [];\n\t\tconst rgVertexLight = [];\n\t\tconst rgVertexBrightness = [];\n\t\tfor (let iVertex = 0; iVertex < 4; ++iVertex)\n\t\t{\n\t\t\tthis.vertices[iVertex].pushTo(rgVertexPosition);\n\t\t\tif (this.rgUV)\n\t\t\t{\n\t\t\t\tthis.rgUV[iVertex].pushTo(rgVertexTextureCoord);\n\t\t\t\trgVertexLight.push(1, 1, 1);\t// TODO: single value\n\n\t\t\t\trgVertexBrightness.push(this.rgL[iVertex]);\n\t\t\t}\n\t\t}\n\n\t\tthis.bufferVertexPosition = createBuffer(rgVertexPosition, 3);\n\t\tthis.bufferVertexLight = createBuffer(rgVertexLight, 3);\n\t\tthis.bufferVertexTextureCoord = createBuffer(rgVertexTextureCoord, 2);\n\t\tthis.bufferVertexTextureBrightness = createDynamicBuffer(rgVertexBrightness, 1);\n\t}\n\t*/\n\n\tinitializeBuffers(rgVertexPosition: number[], rgVertexLight: number[], rgVertexTextureCoord: number[], rgVertexBrightness: number[]) {\n\t\tconst neighbor = this.neighbor;\n\t\tlet vertexOffset = 0;\n\n\t\tconst vertices = this.vertices;\n\n\t\tconst tri = new Triangle(vertices[0], vertices[1], vertices[2]);\n\t\tlet fConvex = tri.distanceTo(vertices[3]) >= 0;\n\n\t\tif (neighbor && neighbor.index !== -1) {\n\t\t\tlet otherSide = this.otherSide;\n\t\t\t// initialize otherSide pairs\n\t\t\tif (!otherSide) {\n\t\t\t\tfor (let iOtherSide = 6; iOtherSide--;) {\n\t\t\t\t\totherSide = neighbor.rgSides[iOtherSide];\n\t\t\t\t\tif (otherSide && otherSide.neighbor === this.cube) {\n\t\t\t\t\t\tif (otherSide.otherSide) {\n\t\t\t\t\t\t\tthrow new Error(\"otherSide.otherSide already set\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.otherSide = otherSide;\n\t\t\t\t\t\totherSide.otherSide = this;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!otherSide) {\n\t\t\t\t\tthrow new Error(\"otherSide not found!\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!otherSide.vertexOffset) {\n\t\t\t\t// ensure vertices align\n\t\t\t\tif (this.vertices[0] === otherSide.vertices[1] ||\n\t\t\t\t\tthis.vertices[0] === otherSide.vertices[3]) {\n\t\t\t\t\tvertexOffset = 1;\n\t\t\t\t\tfConvex = !fConvex;\n\t\t\t\t} else {\n\t\t\t\t\tif (this.vertices[0] !== otherSide.vertices[0] &&\n\t\t\t\t\t\tthis.vertices[0] !== otherSide.vertices[2]) {\n\t\t\t\t\t\tthrow new Error(\"otherSide vertex mismatch!\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// make convex\n\t\t\tif (!fConvex) {\n\t\t\t\tvertexOffset = 1;\n\t\t\t\tfConvex = true;\n\t\t\t}\n\t\t}\n\n\t\tthis.vertexOffset = vertexOffset;\n\t\tthis.convex = fConvex;\n\n\t\tthis.rgTriangles = [\n\t\t\tnew Triangle(vertices[vertexOffset + 0], vertices[vertexOffset + 1], vertices[vertexOffset + 2]),\n\t\t\tnew Triangle(vertices[vertexOffset + 2], vertices[(vertexOffset + 3) % 4], vertices[vertexOffset + 0]),\n\t\t];\n\n\t\tconst n1 = this.rgTriangles[0].normal;\n\t\tconst n2 = this.rgTriangles[1].normal;\n\n\t\tthis.normal = n1.add(n2).unit();\n\n\t\tif (this.rgUV) {\n\t\t\tthis.iVertex = rgVertexPosition.length / 3;\n\n\t\t\tif (this.tmi2) {\n\t\t\t\tthis.program = programDouble;\n\t\t\t} else {\n\t\t\t\tthis.program = programSingle;\n\t\t\t}\n\n\t\t\tfor (let iVertex = 0; iVertex < 4; ++iVertex) {\n\t\t\t\tthis.vertices[(vertexOffset + iVertex) % 4].pushTo(rgVertexPosition);\n\t\t\t\trgVertexLight.push(0, 0, 0);\t// TODO: single value\n\t\t\t\trgVertexBrightness.push(this.rgL[(vertexOffset + iVertex) % 4]);\n\t\t\t\tthis.rgUV[(vertexOffset + iVertex) % 4].pushTo(rgVertexTextureCoord);\n\t\t\t}\n\t\t}\n\t}\n\tisVisible() {\n\t\tif (!this.neighbor) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.wall) {\n\t\t\treturn this.wall.isVisible();\n\t\t}\n\t\treturn false;\n\t}\n\tisSolid() {\n\t\tif (!this.neighbor) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.wall) {\n\t\t\treturn this.wall.isSolid();\n\t\t}\n\t\treturn false;\n\t}\n\tisTransparent() {\n\t\tif (this.tmi2) {\n\t\t\treturn this.tmi2.isTransparent();\n\t\t}\n\t\treturn this.tmi1.isTransparent();\n\t}\n\tisPointInside(pt: Vec3) {\n\t\tif (this.convex) {\n\t\t\treturn this.rgTriangles[0].distanceTo(pt) > 0 && this.rgTriangles[1].distanceTo(pt) > 0;\n\t\t} else {\n\t\t\treturn this.rgTriangles[0].distanceTo(pt) > 0 || this.rgTriangles[1].distanceTo(pt) > 0;\n\t\t}\n\t}\n\trender(time: number, fWireframe: boolean) {\n\t\t// const fDebugSide = _iStep && cubeDebug && cubeDebug.rgDebug[_iStep] && cube.index === cubeDebug.rgDebug[_iStep].cube.index && iSide === cubeDebug.rgDebug[_iStep].this;\n\n\t\tif (this.neighbor && /*isNaN(this.iSwitch) &&*/ !this.isVisible() /*&& !fDebugSide*/) {\n\t\t\t/*\n\t\t\tif (fWireframe && this.cube.index === 26)\n\t\t\t{\n\t\t\t\tuseProgram(programFlat);\n\n\t\t\t\tconst rgVertexPosition = Array.prototype.concat.apply(this.vertices[(this.vertexOffset + 2) % 4].flatten(), Array_iterate(4, (i) => this.vertices[(this.vertexOffset + i) % 4].flatten()));\n\t\t\t\tconst bufferVertexPosition = createBuffer(rgVertexPosition, 3);\n\n\t\t\t\tconst rgVertexLight = Array.prototype.concat.apply(Vec3.One.flatten(), Array_iterate(4, (i) => Vec3.One.flatten()));\n\t\t\t\tconst bufferVertexLight = createBuffer(rgVertexLight, 3);\n\n\t\t\t\tloadAttribBuffer(programFlat['aVertexPosition'], bufferVertexPosition);\n\t\t\t\tloadAttribBuffer(programFlat['aVertexLight'], bufferVertexLight);\n\n\t\t\t\tgl.uniform4f(programFlat['light'], 1, 1, 1, 1);\n\t\t\t\tgl.drawArrays(gl.LINE_STRIP, this.iVertex, 5);\n\t\t\t\tgl.enable(gl.DEPTH_TEST);\n\n\t\t\t\tgl.deleteBuffer(bufferVertexPosition);\n\t\t\t\tgl.deleteBuffer(bufferVertexLight);\n\t\t\t}\n\t\t\t*/\n\t\t\treturn;\n\t\t}\n\n\t\t// fWireframe = false;\n\n\t\tif (!this.program) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst program = this.program;\n\n\t\t/*\n\t\tif (_cubeDebug)\n\t\t{\n\t\t\tif (_cubeDebug === this.cube)\n\t\t\t{\n\t\t\t\tif (this.index === _iTriView)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tprogram = programSingle;\n\t\t}\n\t\t*/\n\n\t\tuseProgram(program);\n\n\t\tlet alpha = 1;\n\t\tconst wall = this.wall;\n\t\tif (wall && wall.type === WallTypes.CLOAKED) {\n\t\t\talpha = 1 - wall.cloak_value;\n\t\t\tif (alpha === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (program.alphaValue !== alpha) {\n\t\t\tprogram.alphaValue = alpha;\n\t\t\tgl.uniform1f(program.alpha, alpha);\n\t\t}\n\n\t\tlet slideU = 0;\n\t\tlet slideV = 0;\n\t\tconst sideL = 0;\n\n\t\tconst tmi = this.tmi1;\n\t\tif (tmi) {\n\t\t\tslideU = (tmi.slide_u * time) % 4;\n\t\t\tslideV = (tmi.slide_v * time) % 4;\n\n\t\t\t/*\n\t\t\t// TODO check tex2\n\t\t\tif (tmi.lighting)\n\t\t\t{\n\t\t\t\tconst light = this.light;\n\t\t\t\tif (light && light.timer !== (1 << 31))\n\t\t\t\t{\n\t\t\t\t\tconst lightTime = time / light.delay;\n\t\t\t\t\tconst lightBit = lightTime % 31;\n\t\t\t\t\tconst fLit = light.mask & (1 << lightBit);\n\t\t\t\t\tif (fLit)\n\t\t\t\t\t\tsideL = .5;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*/\n\t\t}\n\n\t\tif (program.slideU !== slideU || program.slideV !== slideV) {\n\t\t\tprogram.slideU = slideU;\n\t\t\tprogram.slideV = slideV;\n\t\t\tgl.uniform2f(program.slide, slideU, slideV);\n\t\t}\n\t\tgl.uniform2f(program.slide, slideU, slideV);\n\n\t\tbindTexture(1, tmi.loadTexture(1).tex);\n\n\t\tconst tmi2 = this.tmi2;\n\t\tif (tmi2) {\n\t\t\tconst iOrient = this.tex2Orient;\n\t\t\tif (program._iOrient !== iOrient) {\n\t\t\t\tprogram._iOrient = iOrient;\n\t\t\t\tconst matOrient = _rgOrientMatrices[iOrient];\n\t\t\t\tgl.uniformMatrix3fv(program.matOrientTex2, false, matOrient.flatten());\n\t\t\t}\n\t\t\tbindTexture(2, tmi2.loadTexture(2).tex);\n\t\t}\n\n\t\tconst vertexOffset = this.vertexOffset;\n\n\t\tif (this.updateBrightness) {\n\t\t\tthis.updateBrightness = false;\n\n\t\t\tconst items = Side._updateBrightnessItems;\n\t\t\tfor (let iVertex = 4; iVertex--;) {\n\t\t\t\titems[iVertex] = this.rgDeltaLight[(vertexOffset + iVertex) % 4] * this.rgL[(vertexOffset + iVertex) % 4] * this.brightness;\n\t\t\t}\n\n\t\t\tupdateDynamicBuffer(_bufferVertexTextureBrightness, this.iVertex * 4, items);\n\t\t}\n\n\t\tif (this.updateLight) {\n\t\t\tthis.updateLight = false;\n\n\t\t\tconst items = Side._updateLightItems;\n\t\t\tfor (let iVertex = 4; iVertex--;) {\n\t\t\t\tconst light = this.rgVertexLight[(vertexOffset + iVertex) % 4];\n\t\t\t\tif (light) {\n\t\t\t\t\titems[iVertex * 3 + 0] = light.x;\n\t\t\t\t\titems[iVertex * 3 + 1] = light.y;\n\t\t\t\t\titems[iVertex * 3 + 2] = light.z;\n\t\t\t\t} else {\n\t\t\t\t\titems[iVertex * 3 + 0] = items[iVertex * 3 + 1] = items[iVertex * 3 + 2] = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tupdateDynamicBuffer(_bufferVertexLight, this.iVertex * 4 * 3, items);\n\t\t}\n\n\t\tif (fWireframe) {\n\t\t\tgl.drawArrays(gl.LINE_LOOP, this.iVertex, 4);\n\n\t\t\tgl.enable(gl.BLEND);\n\t\t\t// gl.disable(gl.DEPTH_TEST);\n\t\t\tgl.uniform1f(program.alpha, .4);\n\t\t\tgl.drawArrays(gl.TRIANGLE_FAN, this.iVertex, 4);\n\t\t\tgl.disable(gl.BLEND);\n\t\t\t// gl.enable(gl.DEPTH_TEST);\n\t\t\tgl.uniform1f(program.alpha, 1);\n\n\t\t\t/*\n\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\tuseProgram(programFlat);\n\t\t\tgl.uniform4f(programFlat['color'], 1, 1, 1, 1);\n\t\t\tgl.drawArrays(gl.LINE_STRIP, this.iVertex, 4);\n\t\t\tgl.enable(gl.DEPTH_TEST);\n\t\t\t*/\n\t\t} else {\n\t\t\tgl.drawArrays(gl.TRIANGLE_FAN, this.iVertex, 4);\n\t\t}\n\t}\n\tgetPixel(u: number, v: number) {\n\t\treturn this.tmi1.getPixel(u, v);\n\t}\n\tgetPixel2(u: number, v: number) {\n\t\tconst tmi2 = this.tmi2;\n\t\tif (!tmi2) {\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tconst iOrient = this.tex2Orient;\n\t\tconst matOrient = _rgOrientMatrices[iOrient];\n\t\tconst uv = matOrient.multiply(new Vec3(u, v, 1));\n\t\treturn tmi2.getPixel(uv.x, uv.y);\n\t}\n\tbounce(line: LineSegment, size: number) {\n\t\t/*\n\t\tif (this.neighbor && !this.isSolid())\n\t\t\treturn;\n\t\t*/\n\n\t\tif (!this.isSolid()) {\n\t\t\tsize = 0;\n\t\t}\n\n\t\tlet bestBounce: Bounce|null = null;\n\t\tfor (let iTri = 2; iTri--;) {\n\t\t\tconst tri = this.rgTriangles[iTri];\n\t\t\tconst bounce = tri.bounce(line, size);\n\t\t\tif (bounce) {\n\t\t\t\tif (!bestBounce || bestBounce.distance > bounce.distance) {\n\t\t\t\t\tbestBounce = bounce;\n\t\t\t\t\tbestBounce.iTri = iTri;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (bestBounce) {\n\t\t\tbestBounce.side = this;\n\t\t}\n\t\treturn bestBounce;\n\t}\n\tcheckExit(line: LineSegment): Bounce | null {\n\t\tif (!this.neighbor) {// || this.isVisible ())\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (let iTri = 2; iTri--;) {\n\t\t\tconst tri = this.rgTriangles[iTri];\n\t\t\tconst bounce = tri.bounce(line, 0);\n\t\t\tif (bounce) {\n\t\t\t\treturn bounce;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tgetTextureLighting() {\n\t\tlet lighting = 0;\n\n\t\tif (this.tmi1) {\n\t\t\tlighting += this.tmi1.lighting;\n\t\t}\n\n\t\tif (this.tmi2) {\n\t\t\tlighting += this.tmi2.lighting;\n\t\t}\n\n\t\treturn lighting;\n\t}\n\tsetTex1(tex: number) {\n\t\tthis.tex1 = tex;\n\t\tthis.tmi1 = _ham.rgTMapInfos[tex];\n\t}\n\tsetTex2(tex: number, fOrient?: boolean) {\n\t\tif (fOrient) {\n\t\t\tthis.tex2Orient = (tex >> 14) & 3;\n\t\t\ttex = tex & 0x3fff;\n\t\t}\n\n\t\tthis.tex2 = tex;\n\t\tthis.tmi2 = _ham.rgTMapInfos[tex];\n\n\t\t// const lighting = this.getTextureLighting();\n\t\t// this.setStaticLight(lighting);\n\t}\n\tsetStaticLight(value: number) {\n\t\tconst prev = this.static_light;\n\t\tthis.static_light = value;\n\t\tthis.cube.addStaticLight(value - prev);\n\t}\n\tsetDeltaLight(value: number) {\n\t\tconst light = this.deltaLight;\n\t\tconst diff = value - light;\n\t\tif (diff === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis.deltaLight = value;\n\n\t\tconst rgDeltaLights = this.rgDeltaLights;\n\t\tif (rgDeltaLights) {\n\t\t\tfor (let iDeltaLight = rgDeltaLights.length; iDeltaLight--;) {\n\t\t\t\tconst dl = rgDeltaLights[iDeltaLight];\n\t\t\t\tconst litSide = dl.side;\n\t\t\t\tlitSide.applyDeltaLight(dl, diff);\n\t\t\t}\n\t\t}\n\t}\n\tapplyDeltaLight(light: DeltaLight, diff: number) {\n\t\tconst rgDeltaLight = this.rgDeltaLight;\n\t\tlet sum = 0;\n\t\tfor (let iVertex = 4; iVertex--;) {\n\t\t\tconst vertLight = light.vert_light[iVertex];\n\t\t\tsum += vertLight;\n\t\t\trgDeltaLight[iVertex] += diff * vertLight;\n\t\t}\n\t\tconst avg = sum / 4;\n\t\tconsole.log(\"CUBE:\", this.cube.index, \"SIDE:\", this.index, \"light:\", avg * diff);\n\n\t\tthis.updateBrightness = true;\n\t}\n\tsetBrightness(value: number) {\n\t\tthis.brightness = value;\n\t\tthis.updateBrightness = true;\n\t}\n\tgetDoorwayFlags() {\n\t\tif (!this.neighbor) {\n\t\t\treturn WID.RENDER;\n\t\t}\n\n\t\tconst wall = this.wall;\n\t\tif (!wall) {\n\t\t\treturn WID.NO_WALL;\n\t\t}\n\n\t\treturn wall.getDoorwayFlags();\n\t}\n}\nclass FlickeringLight {\n\tsegnum: number;\n\tsidenum: number;\n\tmask: number;\n\ttimer: number;\n\tdelay: number;\n\n\tload(stream: DataStream) {\n\t\tthis.segnum = stream.getInt16();\n\t\tthis.sidenum = stream.getInt16();\n\t\tthis.mask = stream.getInt32();\n\t\tthis.timer = stream.getFixed();\n\t\tthis.delay = stream.getFixed();\n\n\t\treturn this;\n\t}\n}\nenum WallTypes {\n\tNORMAL = 0,   // Normal wall\n\tBLASTABLE = 1,   // Removable (by shooting) wall\n\tDOOR = 2,   // Door\n\tILLUSION = 3,   // Wall that appears to be there, but you can fly thru\n\tOPEN = 4,   // Just an open side. (Trigger)\n\tCLOSED = 5,   // Wall.  Used for transparent walls.\n\tOVERLAY = 6,   // Goes over an actual solid side.  For triggers\n\tCLOAKED = 7,   // Can see it, and see through it\n}\nenum WallFlags {\n\tBLASTED = (1 << 0), // Blasted out wall.\n\tDOOR_OPENED = (1 << 1), // Open door.\n\n\tDOOR_LOCKED = (1 << 3), // Door is locked.\n\tDOOR_AUTO = (1 << 4), // Door automatically closes after time.\n\tILLUSION_OFF = (1 << 5), // Illusionary wall is shut off.\n\tWALL_SWITCH = (1 << 6), // This wall is openable by a wall switch.\n\tBUDDY_PROOF = (1 << 7), // Buddy assumes he cannot get through this wall.\n}\nenum DoorStates {\n\tCLOSED = 0,       // Door is closed\n\tOPENING = 1,       // Door is opening.\n\tWAITING = 2,       // Waiting to close\n\tCLOSING = 3,       // Door is closing\n\tOPEN = 4,       // Door is open, and staying open\n\tCLOAKING = 5,       // Wall is going from closed -> open\n\tDECLOAKING = 6,       // Wall is going from open -> closed\n}\nenum DoorKeys {\n\tNONE = (1 << 0),\n\tBLUE = (1 << 1),\n\tRED = (1 << 2),\n\tGOLD = (1 << 3),\n}\nconst DOOR_WAIT_TIME = 5;\n\nclass Wall {\n\n\tsegnum: number;\n\tsidenum: number;\n\thps: number;\n\tlinked_wall: number;\n\ttype: WallTypes;\n\tflags: WallFlags;\n\tstate: DoorStates;\n\tiTrigger: number;\n\tclip_num: number;\n\tkeys: number;\n\tcontrolling_trigger: number;\n\tcloak_value: number;\n\n\tside: Side;\n\totherSide: Side;\n\totherWall: Wall;\n\ttime: number;\n\ttrigger: Trigger;\n\n\tcloakingWall: CloakingWall | null;\n\n\tprivate _unique: string;\n\n\tconstructor() {\n\t\tthis._unique = (__unique++).toString();\n\t}\n\tload(stream: DataStream) {\n\t\tthis.segnum = stream.getUint32();\n\t\tthis.sidenum = stream.getUint32();\n\t\tthis.hps = stream.getFixed();\n\t\tthis.linked_wall = stream.getInt32();\n\t\tthis.type = stream.getUint8();\n\t\tthis.flags = stream.getUint8();\n\t\tthis.state = stream.getUint8();\n\t\tthis.iTrigger = stream.getInt8();\n\t\tthis.clip_num = stream.getUint8();\n\t\tthis.keys = stream.getUint8();\n\t\tthis.controlling_trigger = stream.getUint8();\n\t\tthis.cloak_value = stream.getUint8();\n\n\t\treturn this;\n\t}\n\tisVisible(): boolean {\n\t\tswitch (this.type) {\n\t\t\tcase WallTypes.OPEN:\n\t\t\t\treturn false;\n\n\t\t\tcase WallTypes.ILLUSION:\n\t\t\t\treturn !(this.flags & WallFlags.ILLUSION_OFF);\n\n\t\t\t// case WallTypes.CLOAKED:\n\t\t\t// \treturn true;\t// TODO\n\t\t}\n\n\t\treturn true;\n\t}\n\tisSolid(): boolean {\n\t\tswitch (this.type) {\n\t\t\tcase WallTypes.OPEN:\n\t\t\t\treturn false;\n\n\t\t\tcase WallTypes.ILLUSION:\n\t\t\t\treturn !!(this.flags & WallFlags.ILLUSION_OFF);\n\n\t\t\tcase WallTypes.BLASTABLE:\n\t\t\t\treturn !(this.flags & WallFlags.BLASTED);\n\n\t\t\tcase WallTypes.DOOR:\n\t\t\t\treturn !(this.flags & WallFlags.DOOR_OPENED);\n\t\t}\n\t\treturn true;\n\t}\n\tgetDoorwayFlags() {\n\t\tswitch (this.type) {\n\t\t\tcase WallTypes.OPEN:\n\t\t\t\treturn WID.NO_WALL;\n\n\t\t\tcase WallTypes.ILLUSION:\n\t\t\t\tif (this.flags & WallFlags.ILLUSION_OFF) {\n\t\t\t\t\treturn WID.NO_WALL;\n\t\t\t\t}\n\n\t\t\t\tif (this.side.isTransparent()) {\n\t\t\t\t\treturn WID.TRANSILLUSORY_WALL;\n\t\t\t\t}\n\n\t\t\t\treturn WID.ILLUSORY_WALL;\n\n\t\t\tcase WallTypes.BLASTABLE:\n\t\t\t\tif (this.flags & WallFlags.BLASTED) {\n\t\t\t\t\treturn WID.TRANSILLUSORY_WALL;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase WallTypes.CLOAKED:\n\t\t\t\treturn WID.RENDER | WID.RENDPAST | WID.CLOAKED;\n\n\t\t\tcase WallTypes.DOOR:\n\t\t\t\tif (this.state === DoorStates.OPENING) {\n\t\t\t\t\treturn WID.TRANSPARENT_WALL;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this.flags & WallFlags.DOOR_OPENED) {\n\t\t\treturn WID.TRANSILLUSORY_WALL;\n\t\t}\n\n\t\tif (this.side.isTransparent()) {\n\t\t\treturn WID.TRANSPARENT_WALL;\n\t\t}\n\n\t\treturn WID.WALL;\n\t}\n\tdamage(time: number, damage: number) {\n\t\tif (this.type !== WallTypes.BLASTABLE) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.flags & WallFlags.BLASTED) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.hps < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hps -= damage;\n\n\t\tconst wclip = _ham.rgWClips[this.clip_num];\n\t\tconst cFrames = wclip.num_frames;\n\n\t\tif (this.hps < 100 / cFrames) {\n\t\t\t// blast blastable\n\t\t\tthis.blast(time);\n\t\t} else {\n\t\t\t// wall_set_tmap_num\n\t\t\tconst iFrame = Math.floor((cFrames - 1) * (100 - this.hps) / (100 - 100 / cFrames + 1));\n\t\t\twclip.apply(this.side, iFrame);\n\t\t}\n\t}\n\tblast(time: number) {\n\t\tthis.hps = -1;\n\n\t\tconst wclip = _ham.rgWClips[this.clip_num];\n\t\tif (wclip.flags & WClipFlags.EXPLODES) {\n\t\t\tthis.explode(time);\n\t\t} else {\n\t\t\tconst wclip = _ham.rgWClips[this.clip_num];\n\t\t\twclip.apply(this.side, wclip.num_frames - 1);\n\n\t\t\tthis.flags |= WallFlags.BLASTED;\n\t\t\tif (this.otherWall) {\n\t\t\t\tthis.otherWall.flags |= WallFlags.BLASTED;\n\t\t\t}\n\t\t}\n\t}\n\texplode(time: number) {\n\t\tExplodingWall.add(new ExplodingWall(time, this));\n\t\t_ham.playSound(SoundFile_Sounds.EXPLODING_WALL, this.side.center);\n\t}\n\topenDoor() {\n\t\tconst wclip = _ham.rgWClips[this.clip_num];\n\n\t\tswitch (this.state) {\n\t\t\tdefault:\n\t\t\t\tthis.time = 0;\n\t\t\t\t_rgActiveDoors.push(this);\n\t\t\t\tbreak;\n\n\t\t\tcase DoorStates.CLOSING:\n\t\t\t\tthis.time = wclip.play_time - this.time;\n\t\t\t\tbreak;\n\n\t\t\tcase DoorStates.OPENING:\n\t\t\tcase DoorStates.WAITING:\n\t\t\tcase DoorStates.OPEN:\n\t\t\t\treturn;\n\t\t}\n\n\t\tthis.state = this.side.otherSide.wall.state = DoorStates.OPENING;\n\n\t\tif (wclip.open_sound >= 0) {\n\t\t\t_ham.playSound(wclip.open_sound, this.side.center);\n\t\t}\n\t}\n\tupdateDoor(time: number, frameTime: number) {\n\t\tlet fActive = true;\n\t\tconst wclip = _ham.rgWClips[this.clip_num];\n\n\t\tswitch (this.state) {\n\t\t\tcase DoorStates.OPENING:\n\n\t\t\t\tthis.time += frameTime;\n\t\t\t\tif (this.time > wclip.play_time / 2) {\n\t\t\t\t\tthis.flags |= WallFlags.DOOR_OPENED;\n\t\t\t\t\tif (this.otherWall) {\n\t\t\t\t\t\tthis.otherWall.flags |= WallFlags.DOOR_OPENED;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst cFrames = wclip.num_frames;\n\t\t\t\tlet iFrame = Math.floor(cFrames * this.time / wclip.play_time);\n\n\t\t\t\tif (iFrame >= cFrames - 1) {\n\t\t\t\t\tiFrame = cFrames - 1;\n\n\t\t\t\t\tif (this.flags & WallFlags.DOOR_AUTO) {\n\t\t\t\t\t\tthis.state = DoorStates.WAITING;\n\t\t\t\t\t\tif (this.otherWall) {\n\t\t\t\t\t\t\tthis.otherWall.state = DoorStates.WAITING;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.time = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.state = DoorStates.OPEN;\n\t\t\t\t\t\tif (this.otherWall) {\n\t\t\t\t\t\t\tthis.otherWall.state = DoorStates.OPEN;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfActive = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twclip.apply(this.side, iFrame);\n\t\t\t\tbreak;\n\n\t\t\tcase DoorStates.CLOSING:\n\t\t\t\t{\n\t\t\t\t\tif (this.time === 0) {\n\t\t\t\t\t\tif (wclip.close_sound >= 0) {\n\t\t\t\t\t\t\t_ham.playSound(wclip.close_sound, this.side.center);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.time += frameTime;\n\t\t\t\t\tif (this.time > wclip.play_time / 2) {\n\t\t\t\t\t\tthis.flags &= ~WallFlags.DOOR_OPENED;\n\t\t\t\t\t\tif (this.otherWall) {\n\t\t\t\t\t\t\tthis.otherWall.flags &= ~WallFlags.DOOR_OPENED;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst cFrames = wclip.num_frames;\n\t\t\t\t\tlet iFrame = cFrames - 1 - Math.floor(cFrames * this.time / wclip.play_time);\n\n\t\t\t\t\tif (iFrame <= 0) {\n\t\t\t\t\t\tiFrame = 0;\n\t\t\t\t\t\tthis.state = DoorStates.CLOSED;\n\t\t\t\t\t\tif (this.otherWall) {\n\t\t\t\t\t\t\tthis.otherWall.state = DoorStates.CLOSED;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfActive = false;\n\t\t\t\t\t}\n\n\t\t\t\t\twclip.apply(this.side, iFrame);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\tcase DoorStates.WAITING:\n\n\t\t\t\tthis.time += frameTime;\n\t\t\t\tif (this.time > DOOR_WAIT_TIME) {\n\t\t\t\t\tthis.time = 0;\n\t\t\t\t\tthis.state = DoorStates.CLOSING;\n\t\t\t\t\tif (this.otherWall) {\n\t\t\t\t\t\tthis.otherWall.state = DoorStates.CLOSING;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase DoorStates.OPEN:\n\t\t\tcase DoorStates.CLOSED:\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"invalid door state: \" + this.state);\n\t\t}\n\n\t\treturn fActive;\n\t}\n}\nconst EXPL_WALL_TOTAL_FIREBALLS = 32;\nconst EXPL_WALL_FIREBALL_SIZE = fix(0x48000) * 6 / 10;\nconst EXPL_WALL_TIME = 1;\n\nclass ExplodingWall {\n\tstatic _rgExplodingWalls: ExplodingWall[] = [];\n\n\tstatic add(wall: ExplodingWall) {\n\t\tExplodingWall._rgExplodingWalls.push(wall);\n\t}\n\tstatic update(time: number) {\n\t\tfor (let iEffect = ExplodingWall._rgExplodingWalls.length; iEffect--;) {\n\t\t\tconst effect = ExplodingWall._rgExplodingWalls[iEffect];\n\t\t\tif (!effect.update(time)) {\n\t\t\t\tExplodingWall._rgExplodingWalls.swapOut(iEffect);\n\t\t\t}\n\t\t}\n\t}\n\n\tcFireballs = 0;\n\n\tconstructor(public startTime: number, public wall: Wall) {\n\t}\n\tupdate(time: number) {\n\t\tconst duration = Math.min(time - this.startTime, EXPL_WALL_TIME);\n\n\t\tconst cFireballs = EXPL_WALL_TOTAL_FIREBALLS * (duration / EXPL_WALL_TIME) * (duration / EXPL_WALL_TIME);\n\n\t\tconst wall = this.wall;\n\t\tconst side = wall.side;\n\t\tconst cube = side.cube;\n\t\tconst normal = side.rgTriangles[0].normal;\n\t\tconst v0 = side.vertices[1];\n\t\tconst u = side.vertices[0].sub(v0);\n\t\tconst v = side.vertices[2].sub(v0);\n\n\t\tif (!(wall.flags & WallFlags.BLASTED) && duration > EXPL_WALL_TIME * 3 / 4) {\n\t\t\twall.flags |= WallFlags.BLASTED;\n\t\t\tif (wall.otherWall) {\n\t\t\t\twall.otherWall.flags |= WallFlags.BLASTED;\n\t\t\t}\n\t\t\tconst wclip = _ham.rgWClips[wall.clip_num];\n\t\t\twclip.apply(side, wclip.num_frames - 1);\n\t\t}\n\n\t\tfor (let e = this.cFireballs; e < cFireballs; ++e) {\n\t\t\tconst size = EXPL_WALL_FIREBALL_SIZE + (2 * EXPL_WALL_FIREBALL_SIZE * e / EXPL_WALL_TOTAL_FIREBALLS);\n\n\t\t\tlet pos = v0.addScale(u, Math.random()).addScale(v, Math.random());\n\n\t\t\tlet scale = size * (EXPL_WALL_TOTAL_FIREBALLS - e) / EXPL_WALL_TOTAL_FIREBALLS;\n\t\t\tif (e & 1) {\n\t\t\t\tscale = -scale;\n\t\t\t}\n\n\t\t\tpos = pos.addScale(normal, scale);\n\n\t\t\tif (true || e & 3) {\n\t\t\t\tcube.createExplosion(time, pos, size, KnownVClips.SMALL_EXPLOSION);\n\t\t\t}\n\t\t}\n\n\t\tthis.cFireballs = cFireballs;\n\n\t\treturn duration < EXPL_WALL_TIME;\n\t}\n\n}\nconst MAX_WALLS_PER_LINK = 10;\n\nclass Trigger {\n\ttype: TriggerTypes;\n\tflags: TriggerFlags;\n\tnum_links: number;\n\tpad: number;\n\tvalue: number;\n\ttime: number;\n\n\tseg: number[];\n\tside: number[];\n\n\trgSides: Side[];\n\n\tload(stream: DataStream) {\n\t\tthis.type = stream.getUint8();\n\t\tthis.flags = stream.getUint8();\n\t\tthis.num_links = stream.getUint8();\n\t\tthis.pad = stream.getUint8();\n\t\tthis.value = stream.getFixed();\n\t\tthis.time = stream.getFixed();\n\n\t\tthis.seg = stream.getUint16Array(MAX_WALLS_PER_LINK);\n\t\tthis.side = stream.getUint16Array(MAX_WALLS_PER_LINK);\n\n\t\t// console.log(this.type);\n\n\t\treturn this;\n\t}\n\ttrigger(obj: Item, time: number, fShot?: boolean) {\n\t\tif (!(obj.type === ItemTypes.PLAYER /* || obj is companion */)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.flags & TriggerFlags.DISABLED) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.flags & TriggerFlags.ONE_SHOT) {\n\t\t\tthis.flags |= TriggerFlags.DISABLED;\n\t\t}\n\n\t\tswitch (this.type) {\n\t\t\tcase TriggerTypes.EXIT:\n\t\t\t\tbreak;\n\n\t\t\tcase TriggerTypes.OPEN_DOOR:\n\t\t\t\tfor (let iSide = this.rgSides.length; iSide--;) {\n\t\t\t\t\tconst side = this.rgSides[iSide];\n\t\t\t\t\tconst wall = side.wall;\n\t\t\t\t\tif (!wall) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (wall.type) {\n\t\t\t\t\t\tcase WallTypes.BLASTABLE:\n\t\t\t\t\t\t\twall.blast(time);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase WallTypes.DOOR:\n\t\t\t\t\t\t\tif (wall.state === DoorStates.CLOSED) {\n\t\t\t\t\t\t\t\twall.openDoor();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase TriggerTypes.OPEN_WALL:\n\t\t\t\tfor (let iSide = this.rgSides.length; iSide--;) {\n\t\t\t\t\tconst side = this.rgSides[iSide];\n\t\t\t\t\tconst wall = side.wall;\n\t\t\t\t\tif (side.tmi1.flags & TMapInfoFlags.FORCE_FIELD) {\n\t\t\t\t\t\twall.type = WallTypes.OPEN;\n\t\t\t\t\t\tif (wall.otherWall) {\n\t\t\t\t\t\t\twall.otherWall.type = WallTypes.OPEN;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_ham.playSound(SoundFile_Sounds.FORCEFIELD_OFF, side.center);\n\t\t\t\t\t} else if (wall.type !== WallTypes.OPEN) {\n\t\t\t\t\t\tswitch (wall.state) {\n\t\t\t\t\t\t\tcase DoorStates.CLOAKING:\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase DoorStates.DECLOAKING:\n\t\t\t\t\t\t\t\tconst cloakingWall = notNull(wall.cloakingWall);\n\t\t\t\t\t\t\t\tcloakingWall.reset(CLOAKING_WALL_TIME - cloakingWall.time);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase DoorStates.CLOSED:\n\t\t\t\t\t\t\t\twall.cloakingWall = new CloakingWall(wall);\n\t\t\t\t\t\t\t\t_rgCloakingWalls.push(wall.cloakingWall);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tthrow new Error(\"invalid door state\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_ham.playSound(SoundFile_Sounds.WALL_CLOAK_ON, side.center);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase TriggerTypes.LOCK_DOOR:\n\t\t\t\tfor (let iSide = this.rgSides.length; iSide--;) {\n\t\t\t\t\tconst wall = this.rgSides[iSide].wall;\n\t\t\t\t\tif (wall) {\n\t\t\t\t\t\twall.flags |= WallFlags.DOOR_LOCKED;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase TriggerTypes.UNLOCK_DOOR:\n\t\t\t\tfor (let iSide = this.rgSides.length; iSide--;) {\n\t\t\t\t\tconst wall = this.rgSides[iSide].wall;\n\t\t\t\t\tif (wall) {\n\t\t\t\t\t\twall.flags &= ~WallFlags.DOOR_LOCKED;\n\t\t\t\t\t\twall.keys = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(\"unsupported trigger type: \" + this.type);\n\n\t\t}\n\t}\n}\nenum TriggerTypes {\n\tOPEN_DOOR = 0,   // Open a door\n\tCLOSE_DOOR = 1,   // Close a door\n\tMATCEN = 2,   // Activate a matcen\n\tEXIT = 3,   // End the level\n\tSECRET_EXIT = 4,   // Go to secret level\n\tILLUSION_OFF = 5,   // Turn an illusion off\n\tILLUSION_ON = 6,   // Turn an illusion on\n\tUNLOCK_DOOR = 7,   // Unlock a door\n\tLOCK_DOOR = 8,   // Lock a door\n\tOPEN_WALL = 9,   // Makes a wall open\n\tCLOSE_WALL = 10,  // Makes a wall closed\n\tILLUSORY_WALL = 11,  // Makes a wall illusory\n\tLIGHT_OFF = 12,  // Turn a light off\n\tLIGHT_ON = 13,  // Turn a light on\n}\nenum TriggerFlags {\n\tNO_MESSAGE = (1 << 0),   // Don't show a message when triggered\n\tONE_SHOT = (1 << 1),   // Only trigger once\n\tDISABLED = (1 << 2),   // Set after one-shot fires\n}\nconst _rgCloakingWalls: CloakingWall[] = [];\n\nclass CloakingWall {\n\tstatic update(frameTime: number) {\n\t\tfor (let iCloakingWall = _rgCloakingWalls.length; iCloakingWall--;) {\n\t\t\tconst cloakingWall = _rgCloakingWalls[iCloakingWall];\n\t\t\tif (!cloakingWall.update(frameTime)) {\n\t\t\t\tcloakingWall.wall.cloakingWall = null;\n\t\t\t\t_rgCloakingWalls.swapOut(iCloakingWall);\n\t\t\t}\n\t\t}\n\t}\n\n\ttime: number;\n\n\tconstructor(public wall: Wall) {\n\t\twall.state = DoorStates.CLOAKING;\n\t\tif (wall.otherWall) {\n\t\t\twall.otherWall.state = DoorStates.CLOAKING;\n\t\t}\n\n\t\tthis.reset(0);\n\t}\n\treset(time: number) {\n\t\tthis.time = time;\n\t}\n\tupdateLight(scale: number) {\n\t\t// console.log(\"updateLight: \" + scale);\n\t\tconst wall = this.wall;\n\t\twall.side.setBrightness(scale);\n\t\tif (wall.otherWall) {\n\t\t\twall.otherWall.side.setBrightness(scale);\n\t\t}\n\t}\n\tupdate(frameTime: number) {\n\t\tthis.time += frameTime;\n\n\t\tconst wall = this.wall;\n\t\tconst otherWall = wall.otherWall;\n\n\t\t// console.log(\"time: \" + this.time);\n\n\t\tif (this.time > CLOAKING_WALL_TIME) {\n\t\t\tif (wall.state === DoorStates.CLOAKING) {\n\t\t\t\twall.type = WallTypes.OPEN;\n\t\t\t\tif (otherWall) {\n\t\t\t\t\totherWall.type = WallTypes.OPEN;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.updateLight(1);\n\n\t\t\twall.state = DoorStates.CLOSED;\n\t\t\tif (otherWall) {\n\t\t\t\totherWall.state = DoorStates.CLOSED;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else if (this.time > CLOAKING_WALL_TIME / 2) {\n\t\t\tlet light_scale = 2 * this.time / CLOAKING_WALL_TIME - 1;\n\t\t\tif (light_scale > 1) {\n\t\t\t\tlight_scale = 1;\n\t\t\t}\n\n\t\t\tif (wall.state === DoorStates.CLOAKING) {\n\t\t\t\twall.cloak_value = light_scale;\n\t\t\t\tif (otherWall) {\n\t\t\t\t\totherWall.cloak_value = light_scale;\n\t\t\t\t}\n\n\t\t\t\tif (wall.type !== WallTypes.CLOAKED) {\n\t\t\t\t\twall.type = WallTypes.CLOAKED;\n\t\t\t\t\tif (otherWall) {\n\t\t\t\t\t\totherWall.type = WallTypes.CLOAKED;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twall.type = WallTypes.OPEN;\n\t\t\t\tif (otherWall) {\n\t\t\t\t\totherWall.type = WallTypes.OPEN;\n\t\t\t\t}\n\n\t\t\t\tthis.updateLight(light_scale);\n\t\t\t}\n\t\t} else {\n\t\t\tlet light_scale = 1 - this.time * 2 / CLOAKING_WALL_TIME;\n\t\t\tif (light_scale < 0) {\n\t\t\t\tlight_scale = 0;\n\t\t\t}\n\n\t\t\tif (wall.state === DoorStates.CLOAKING) {\n\t\t\t\tthis.updateLight(light_scale);\n\t\t\t} else {\n\t\t\t\twall.cloak_value = light_scale;\n\t\t\t\tif (otherWall) {\n\t\t\t\t\totherWall.cloak_value = light_scale;\n\t\t\t\t}\n\n\t\t\t\twall.type = WallTypes.CLOAKED;\n\t\t\t\tif (otherWall) {\n\t\t\t\t\totherWall.type = WallTypes.CLOAKED;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n}\nconst CLOAKING_WALL_TIME = 1;\n\nconst White = Vec3.One;\n\nconst MAX_CONTROLCEN_LINKS = 10;\n\nclass ControlCenterTrigger {\n\tnum_links: number;\n\tseg: number[];\n\tside: number[];\n\n\tload(stream: DataStream) {\n\t\tthis.num_links = stream.getInt16();\n\t\tthis.seg = stream.getInt16Array(MAX_CONTROLCEN_LINKS);\n\t\tthis.side = stream.getInt16Array(MAX_CONTROLCEN_LINKS);\n\n\t\treturn this;\n\t}\n}\nclass RobotCenter {\n\trobot_flags: number[];\n\thit_points: number;\n\tinterval: number;\n\tsegnum: number;\n\tfuelcen_num: number;\n\n\tconstructor() {\n\t\tthis.robot_flags = [];\n\t}\n\tload(stream: DataStream) {\n\t\tthis.robot_flags = [\n\t\t\tstream.getInt32(),\n\t\t\tstream.getInt32(),\n\t\t];\n\n\t\tthis.hit_points = stream.getFixed();\n\t\tthis.interval = stream.getFixed();\n\t\tthis.segnum = stream.getInt16();\n\t\tthis.fuelcen_num = stream.getInt16();\n\n\t\treturn this;\n\t}\n}\nclass DeltaLightIndex {\n\tsegnum: number;\n\tsidenum: number;\n\tcount: number;\n\tindex: number;\n\n\tload(stream: DataStream) {\n\t\tthis.segnum = stream.getInt16();\n\t\tthis.sidenum = stream.getUint8();\n\t\tthis.count = stream.getUint8();\n\t\tthis.index = stream.getInt16();\n\n\t\treturn this;\n\t}\n}\nclass DeltaLight {\n\tsegnum: number;\n\tsidenum: number;\n\tvert_light: number[];\n\tside: Side;\n\n\tload(stream: DataStream) {\n\t\tthis.segnum = stream.getInt16();\n\t\tthis.sidenum = stream.getUint8();\n\t\tstream.position += 1;\t// dummy\n\n\t\tthis.vert_light = [\n\t\t\tstream.getUint8() / (256 >> 3),\n\t\t\tstream.getUint8() / (256 >> 3),\n\t\t\tstream.getUint8() / (256 >> 3),\n\t\t\tstream.getUint8() / (256 >> 3),\n\t\t];\n\n\t\treturn this;\n\t}\n}\n","/// <reference path=\"Math.ts\" />\n/// <reference path=\"Level.ts\" />\n\n//importScripts(\"Math.js\");\n\nlet _level: Level;\n//let LIGHT_DISTANCE_THRESHOLD: number;\n\ninterface Vec3 {\n\t__proto__: Vec3;\n}\n\ninterface Triangle {\n\t__proto__: Triangle;\n}\n\nself.onmessage = (event) => {\n\tconst data = event.data;\n\tif (data) {\n\t\tfor (const key in data) {\n\t\t\tif (!data.hasOwnProperty(key)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst value = data[key];\n\t\t\tswitch (key) {\n\t\t\t\tcase \"load\":\n\t\t\t\t\t_level = value.level;\n\t\t\t\t\tLIGHT_DISTANCE_THRESHOLD = value.LIGHT_DISTANCE_THRESHOLD;\n\n\t\t\t\t\tfor (let iCube = _level.cubes.length; iCube--;) {\n\t\t\t\t\t\tconst cube = _level.cubes[iCube];\n\t\t\t\t\t\tcube.center.__proto__ = Vec3.prototype;\n\t\t\t\t\t\tfor (let iSide = cube.rgSides.length; iSide--;) {\n\t\t\t\t\t\t\tconst side = cube.rgSides[iSide];\n\t\t\t\t\t\t\tside.cubeIndex = {\n\t\t\t\t\t\t\t\tiCube,\n\t\t\t\t\t\t\t\tiSide,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tside.index = {\n\t\t\t\t\t\t\t\tcube: iCube,\n\t\t\t\t\t\t\t\tside: iSide\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\tlet center = Vec3.Zero;\n\t\t\t\t\t\t\tfor (let iVertex = side.vertices.length; iVertex--;) {\n\t\t\t\t\t\t\t\tconst vertex = side.vertices[iVertex];\n\t\t\t\t\t\t\t\tvertex.__proto__ = Vec3.prototype;\n\t\t\t\t\t\t\t\tcenter = center.add(vertex);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tside.center = center.scale(0.25);\n\t\t\t\t\t\t\tfor (let iTriangle = side.rgTriangles.length; iTriangle--;) {\n\t\t\t\t\t\t\t\tconst tri = side.rgTriangles[iTriangle];\n\t\t\t\t\t\t\t\ttri.__proto__ = Triangle.prototype;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"getVisibility\":\n\t\t\t\t\tconst iCube: number = value;\n\t\t\t\t\tconst cube = _level.cubes[iCube];\n\n\t\t\t\t\tgetVisibleNeighbors(cube);\n\n\t\t\t\t\t(self as any).postMessage({\n\t\t\t\t\t\tsetVisibility: {\n\t\t\t\t\t\t\tiCube,\n\t\t\t\t\t\t\trgVisibleNeighbors: cube.rgVisibleNeighbors.map((c) => c.index),\n\t\t\t\t\t\t\trgLightingNeighbors: cube.rgLightingNeighbors.map((c) => c.index),\n\t\t\t\t\t\t\trgVisibleSides: cube.rgVisibleSides.map((s) => s.cubeIndex),\n\t\t\t\t\t\t\trgVisibleSidesBlended: cube.rgVisibleSidesBlended.map((s) => s.cubeIndex),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n};\nfunction getVisibleNeighbors(root: Cube) {\n\tconst rgVisible: Cube[] = [];\n\tconst rgLightingNeighbors: Cube[] = [];\n\tconst mapVisible: { [index: string]: Cube } = {};\n\n\tconst rgVisibleSides: Side[] = [];\n\tconst rgVisibleSidesBlended: Side[] = [];\n\tconst mapVisibleSides: { [index: string]: Side } = {};\n\n\tconst mapVisited: { [index: string]: boolean } = {};\n\tconst rgVisited: Side[] = [];\n\n\tconst LIGHT_DISTANCE_THRESHOLD2 = LIGHT_DISTANCE_THRESHOLD * LIGHT_DISTANCE_THRESHOLD;\n\tconst center = root.center;\n\n\tfor (let iSide = 6; iSide--;) {\n\t\tconst side = root.rgSides[iSide];\n\t\tconst rgVertices = side.vertices;\n\n\t\tconst rgEdges = new Array<LineSegment>(4);\n\t\tconst rgReverses = new Array<Plane3>(4);\n\n\t\tfor (let iEdge = 4; iEdge--;) {\n\t\t\tconst edge = new LineSegment(rgVertices[iEdge], rgVertices[(iEdge + 1) % 4]);\n\t\t\trgEdges[iEdge] = edge;\n\t\t\trgReverses[iEdge] = Plane3.fromPoints(edge.start, rgVertices[(iEdge + 3) % 4], edge.end);\n\t\t\trgReverses[iEdge].normal = rgReverses[iEdge].normal.unit();\n\t\t}\n\n\t\tconst recurse = (cube: Cube, rgPlanes: Plane3[], depth: number): void => {\n\t\t\tif (depth > 25) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmapVisited[cube._unique] = true;\n\n\t\t\tif (!mapVisible[cube.index]) {\n\t\t\t\tmapVisible[cube.index] = cube;\n\t\t\t\trgVisible.push(cube);\n\t\t\t\tif (center.distanceTo(cube.center) < LIGHT_DISTANCE_THRESHOLD2) {\n\t\t\t\t\trgLightingNeighbors.push(cube);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let iOtherSide = 6; iOtherSide--;) {\n\t\t\t\tconst otherSide = cube.rgSides[iOtherSide];\n\t\t\t\tconst neighbor = otherSide.neighbor;\n\n\t\t\t\tif (neighbor) {\n\t\t\t\t\tif (mapVisited[neighbor._unique]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!neighbor.center) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (mapVisibleSides[otherSide._unique]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trgVisited.push(otherSide);\n\n\t\t\t\tconst minPlanes = new Array<Plane3>(4);\n\n\t\t\t\tconst rgOtherVertices = otherSide.vertices;\n\t\t\t\tconst rgOtherTriangles = otherSide.rgTriangles;\n\t\t\t\tlet fOutside = false;\n\t\t\t\tconst fFrontSide = false;\n\t\t\t\tfor (let iEdge = 4; iEdge--;) {\n\t\t\t\t\tconst edge = rgEdges[iEdge];\n\t\t\t\t\tconst vertex = edge.start;\n\t\t\t\t\tif (true || rgOtherTriangles[0].distanceTo(vertex) >= 0 || rgOtherTriangles[1].distanceTo(vertex) >= 0) {\n\t\t\t\t\t\tlet minPlane = rgReverses[iEdge];\n\n\t\t\t\t\t\tconst plane = rgPlanes[iEdge];\n\t\t\t\t\t\tlet extent: Vec3;\n\n\t\t\t\t\t\tlet fFront = false;\n\t\t\t\t\t\tlet fBehind = false;\n\n\t\t\t\t\t\tfor (let iVertex = 4; iVertex--;) {\n\t\t\t\t\t\t\tconst vertexOther = rgOtherVertices[iVertex];\n\n\t\t\t\t\t\t\tif (plane.distanceTo(vertexOther) < 0) {\n\t\t\t\t\t\t\t\tfBehind = true;\n\t\t\t\t\t\t\t\tif (fFront) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfFront = true;\n\t\t\t\t\t\t\t\tif (fBehind) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (minPlane.distanceTo(vertexOther) < -.0001) {\n\t\t\t\t\t\t\t\t\tminPlane = new Plane3(vertex, edge.direction.cross(vertexOther.sub(vertex)).unit());\n\t\t\t\t\t\t\t\t\textent = vertexOther;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (fBehind) {\n\t\t\t\t\t\t\tif (fFront) {\n\t\t\t\t\t\t\t\tminPlane = plane;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfOutside = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tminPlanes[iEdge] = minPlane;\n\t\t\t\t\t}/* else {\n\t\t\t\t\t\tconst newStart = edge.intersectPlane(rgOtherTriangles[0]);\n\t\t\t\t\t\tif (newStart) {\n\t\t\t\t\t\t\tminPlanes[iEdge] = new Plane3(newStart, rgOtherTriangles[0].normal.unit().neg());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tminPlanes[iEdge] = rgReverses[iEdge].reverse();\n\t\t\t\t\t\t}\n\t\t\t\t\t}*/\n\t\t\t\t}\n\n\t\t\t\tif (!fOutside) {\n\t\t\t\t\tif (!mapVisibleSides[otherSide._unique]) {\n\t\t\t\t\t\tmapVisibleSides[otherSide._unique] = otherSide;\n\t\t\t\t\t\tif (neighbor) {\n\t\t\t\t\t\t\trgVisibleSidesBlended.push(otherSide);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trgVisibleSides.push(otherSide);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (neighbor) {\n\t\t\t\t\t\trecurse(neighbor, minPlanes, depth + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trgVisited.pop();\n\t\t\t}\n\n\t\t\tdelete mapVisited[cube._unique];\n\t\t};\n\n\t\tconst rgInits = rgReverses.map((p) => p.reverse());\n\t\trecurse(root, rgInits, 1);\n\t}\n\t// console.log(rgVisibleSides.length);\n\n\tfunction compareSides(side1: Side, side2: Side): number {\n\t\tif (side1.tex1 !== side2.tex1) {\n\t\t\treturn side1.tex1 - side2.tex1;\n\t\t}\n\t\treturn side1.tex2 - side2.tex2;\n\t}\n\t// rgVisibleSides.sort(compareSides);\n\t// rgVisibleSidesBlended.sort(compareSides);\n\n\trgVisibleSides.sort((s1, s2) => {\n\t\tconst d1 = s1.center.distanceTo2(root.center);\n\t\tconst d2 = s2.center.distanceTo2(root.center);\n\t\treturn d2 - d1;\n\t});\n\n\trgVisibleSidesBlended.sort((s1, s2) => {\n\t\tconst d1 = s1.center.distanceTo2(root.center);\n\t\tconst d2 = s2.center.distanceTo2(root.center);\n\t\treturn d1 - d2;\n\t});\n\n\troot.rgVisibleNeighbors = rgVisible;\n\troot.rgLightingNeighbors = rgLightingNeighbors;\n\troot.rgVisibleSides = rgVisibleSides;\n\troot.rgVisibleSidesBlended = rgVisibleSidesBlended;\n\n\treturn rgVisible;\n}\n"],"sourceRoot":"/source/"}